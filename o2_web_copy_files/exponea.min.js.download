!function(){"use strict";var t;!function(t){t.Anonymize="br.anonymize",t.GetAbTest="br.getAbTest",t.GetHtml="br.getHtml",t.GetRecommendation="br.getRecommendation",t.Identify="br.identify",t.LoadDependency="br.loadDependency",t.Notifications_isAvailable="br.notifications.isAvailable",t.Notifications_isSubscribed="br.notifications.isSubscribed",t.Notifications_subscribe="br.notifications.subscribe",t.Notifications_unsubscribe="br.notifications.unsubscribe",t.Ping="br.ping",t.ReloadWebLayers="br.reloadWebLayers",t.Segments_getSegments="br.segments.getSegments",t.Segments_subscribe="br.segments.subscribe",t.ShowHtml="br.showHtml",t.ShowWebLayer="br.showWebLayer",t.Start="br.start",t.Track="br.track",t.TrackEnhancedECommerce="br.trackEnhancedECommerce",t.TrackLink="br.trackLink",t.Update="br.update"}(t||(t={}));const e="v3.26.0",i="true"===String(!0),r="__exponea_etc__",n="__exponea_time2__",o="__exponea_tracking_definition__",s="__exponea_banner_event__",a="__exponea_last_session_ping_timestamp__",c="__exponea_last_session_start_timestamp__",u="exponea",h="Exponea",l="__exponea_ab_",d="__exponea_safari_push_subscribed__",p="__exponea__sync_modifications__",g="browser_push_notification",m="browser_push_notification_vapid_key",f="snippetVersion",b="exponea-editor-params",y="exponea-experiments-editor",v="/editor/index.html?timestamp=",w="/editor/",k=["runtime","polyfills","vendor","main"],_="webxpClient";class S{constructor(t,e,i,r){this.config=t,this.location=e,this.logger=i,this.storageUtils=r}error(t,...e){"string"==typeof t?this.print("error",t,...e):this.print("error",t)}log(t,...e){this.print("log",t,...e)}warn(t,...e){this.print("warn",t,...e)}debug(t,...e){this.print("debug",t,...e)}canPrintMessages(t="production",e=i){return"production"!==t&&e||this.config.getOptions().debug||this.location.search.includes(`${u}_debug=true`)||!!this.storageUtils.readBooleanFromStorage("localStorage",`${u}_debug`)}print(t,...e){this.canPrintMessages()&&this.logger[t](...e.filter((t=>void 0!==t)))}}const T=console,E={log:T.log,warn:T.warn,debug:T.debug};function x(t,e,i){t._&&t._.forEach((t=>{const r=t[0],n=t[1];if(r.includes(".")){const t=r.split("."),o=t[0],s=t[1];if(!(o in e))return i.error(`Failed to replay function call ${r}`),void i.error(`${o} does not exist on the object`);try{e[o][s].apply(e[o],n)}catch(t){i.error(`Failed to replay function call ${r}`,t)}}else try{e[r].apply(e,n)}catch(t){i.error(`Failed to replay function call ${r}`,t)}}))}function C(t,e,i){t.forEach((t=>{e[t]=i[t].bind(i)}))}var O=function(t,e,i){for(var r=-1,n=Object(t),o=i(t),s=o.length;s--;){var a=o[++r];if(!1===e(n[a],a,n))break}return t};var A="object"==typeof global&&global&&global.Object===Object&&global,P="object"==typeof self&&self&&self.Object===Object&&self,j=A||P||Function("return this")(),L=j.Symbol,z=Object.prototype,I=z.hasOwnProperty,B=z.toString,F=L?L.toStringTag:void 0;var R=Object.prototype.toString;var D="[object Null]",M="[object Undefined]",U=L?L.toStringTag:void 0;function N(t){return null==t?void 0===t?M:D:U&&U in Object(t)?function(t){var e=I.call(t,F),i=t[F];try{t[F]=void 0;var r=!0}catch(t){}var n=B.call(t);return r&&(e?t[F]=i:delete t[F]),n}(t):function(t){return R.call(t)}(t)}function W(t){return null!=t&&"object"==typeof t}function q(t){return W(t)&&"[object Arguments]"==N(t)}var $=Object.prototype,H=$.hasOwnProperty,V=$.propertyIsEnumerable,G=q(function(){return arguments}())?q:function(t){return W(t)&&H.call(t,"callee")&&!V.call(t,"callee")},K=Array.isArray;var Q="object"==typeof exports&&exports&&!exports.nodeType&&exports,J=Q&&"object"==typeof module&&module&&!module.nodeType&&module,Z=J&&J.exports===Q?j.Buffer:void 0,X=(Z?Z.isBuffer:void 0)||function(){return!1},Y=9007199254740991,tt=/^(?:0|[1-9]\d*)$/;function et(t,e){var i=typeof t;return!!(e=null==e?Y:e)&&("number"==i||"symbol"!=i&&tt.test(t))&&t>-1&&t%1==0&&t<e}var it=9007199254740991;function rt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=it}var nt={};function ot(t){return function(e){return t(e)}}nt["[object Float32Array]"]=nt["[object Float64Array]"]=nt["[object Int8Array]"]=nt["[object Int16Array]"]=nt["[object Int32Array]"]=nt["[object Uint8Array]"]=nt["[object Uint8ClampedArray]"]=nt["[object Uint16Array]"]=nt["[object Uint32Array]"]=!0,nt["[object Arguments]"]=nt["[object Array]"]=nt["[object ArrayBuffer]"]=nt["[object Boolean]"]=nt["[object DataView]"]=nt["[object Date]"]=nt["[object Error]"]=nt["[object Function]"]=nt["[object Map]"]=nt["[object Number]"]=nt["[object Object]"]=nt["[object RegExp]"]=nt["[object Set]"]=nt["[object String]"]=nt["[object WeakMap]"]=!1;var st="object"==typeof exports&&exports&&!exports.nodeType&&exports,at=st&&"object"==typeof module&&module&&!module.nodeType&&module,ct=at&&at.exports===st&&A.process,ut=function(){try{var t=at&&at.require&&at.require("util").types;return t||ct&&ct.binding&&ct.binding("util")}catch(t){}}(),ht=ut&&ut.isTypedArray,lt=ht?ot(ht):function(t){return W(t)&&rt(t.length)&&!!nt[N(t)]},dt=Object.prototype.hasOwnProperty;function pt(t,e){var i=K(t),r=!i&&G(t),n=!i&&!r&&X(t),o=!i&&!r&&!n&&lt(t),s=i||r||n||o,a=s?function(t,e){for(var i=-1,r=Array(t);++i<t;)r[i]=e(i);return r}(t.length,String):[],c=a.length;for(var u in t)!e&&!dt.call(t,u)||s&&("length"==u||n&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||et(u,c))||a.push(u);return a}var gt=Object.prototype;function mt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||gt)}function ft(t,e){return function(i){return t(e(i))}}var bt=ft(Object.keys,Object),yt=Object.prototype.hasOwnProperty;function vt(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var wt="[object AsyncFunction]",kt="[object Function]",_t="[object GeneratorFunction]",St="[object Proxy]";function Tt(t){if(!vt(t))return!1;var e=N(t);return e==kt||e==_t||e==wt||e==St}function Et(t){return null!=t&&rt(t.length)&&!Tt(t)}function xt(t){return Et(t)?pt(t):function(t){if(!mt(t))return bt(t);var e=[];for(var i in Object(t))yt.call(t,i)&&"constructor"!=i&&e.push(i);return e}(t)}function Ct(t,e){return t&&O(t,e,xt)}function Ot(t,e){return t===e||t!=t&&e!=e}function At(t,e){for(var i=t.length;i--;)if(Ot(t[i][0],e))return i;return-1}var Pt=Array.prototype.splice;function jt(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}jt.prototype.clear=function(){this.__data__=[],this.size=0},jt.prototype.delete=function(t){var e=this.__data__,i=At(e,t);return!(i<0)&&(i==e.length-1?e.pop():Pt.call(e,i,1),--this.size,!0)},jt.prototype.get=function(t){var e=this.__data__,i=At(e,t);return i<0?void 0:e[i][1]},jt.prototype.has=function(t){return At(this.__data__,t)>-1},jt.prototype.set=function(t,e){var i=this.__data__,r=At(i,t);return r<0?(++this.size,i.push([t,e])):i[r][1]=e,this};var Lt,zt=j["__core-js_shared__"],It=(Lt=/[^.]+$/.exec(zt&&zt.keys&&zt.keys.IE_PROTO||""))?"Symbol(src)_1."+Lt:"";var Bt=Function.prototype.toString;function Ft(t){if(null!=t){try{return Bt.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var Rt=/^\[object .+?Constructor\]$/,Dt=Function.prototype,Mt=Object.prototype,Ut=Dt.toString,Nt=Mt.hasOwnProperty,Wt=RegExp("^"+Ut.call(Nt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function qt(t){return!(!vt(t)||(e=t,It&&It in e))&&(Tt(t)?Wt:Rt).test(Ft(t));var e}function $t(t,e){var i=function(t,e){return null==t?void 0:t[e]}(t,e);return qt(i)?i:void 0}var Ht=$t(j,"Map"),Vt=$t(Object,"create");var Gt=Object.prototype.hasOwnProperty;var Kt=Object.prototype.hasOwnProperty;function Qt(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}function Jt(t,e){var i,r,n=t.__data__;return("string"==(r=typeof(i=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==i:null===i)?n["string"==typeof e?"string":"hash"]:n.map}function Zt(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}Qt.prototype.clear=function(){this.__data__=Vt?Vt(null):{},this.size=0},Qt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Qt.prototype.get=function(t){var e=this.__data__;if(Vt){var i=e[t];return"__lodash_hash_undefined__"===i?void 0:i}return Gt.call(e,t)?e[t]:void 0},Qt.prototype.has=function(t){var e=this.__data__;return Vt?void 0!==e[t]:Kt.call(e,t)},Qt.prototype.set=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=Vt&&void 0===e?"__lodash_hash_undefined__":e,this},Zt.prototype.clear=function(){this.size=0,this.__data__={hash:new Qt,map:new(Ht||jt),string:new Qt}},Zt.prototype.delete=function(t){var e=Jt(this,t).delete(t);return this.size-=e?1:0,e},Zt.prototype.get=function(t){return Jt(this,t).get(t)},Zt.prototype.has=function(t){return Jt(this,t).has(t)},Zt.prototype.set=function(t,e){var i=Jt(this,t),r=i.size;return i.set(t,e),this.size+=i.size==r?0:1,this};function Xt(t){var e=this.__data__=new jt(t);this.size=e.size}Xt.prototype.clear=function(){this.__data__=new jt,this.size=0},Xt.prototype.delete=function(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i},Xt.prototype.get=function(t){return this.__data__.get(t)},Xt.prototype.has=function(t){return this.__data__.has(t)},Xt.prototype.set=function(t,e){var i=this.__data__;if(i instanceof jt){var r=i.__data__;if(!Ht||r.length<199)return r.push([t,e]),this.size=++i.size,this;i=this.__data__=new Zt(r)}return i.set(t,e),this.size=i.size,this};function Yt(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new Zt;++e<i;)this.add(t[e])}function te(t,e){for(var i=-1,r=null==t?0:t.length;++i<r;)if(e(t[i],i,t))return!0;return!1}Yt.prototype.add=Yt.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Yt.prototype.has=function(t){return this.__data__.has(t)};var ee=1,ie=2;function re(t,e,i,r,n,o){var s=i&ee,a=t.length,c=e.length;if(a!=c&&!(s&&c>a))return!1;var u=o.get(t),h=o.get(e);if(u&&h)return u==e&&h==t;var l=-1,d=!0,p=i&ie?new Yt:void 0;for(o.set(t,e),o.set(e,t);++l<a;){var g=t[l],m=e[l];if(r)var f=s?r(m,g,l,e,t,o):r(g,m,l,t,e,o);if(void 0!==f){if(f)continue;d=!1;break}if(p){if(!te(e,(function(t,e){if(s=e,!p.has(s)&&(g===t||n(g,t,i,r,o)))return p.push(e);var s}))){d=!1;break}}else if(g!==m&&!n(g,m,i,r,o)){d=!1;break}}return o.delete(t),o.delete(e),d}var ne=j.Uint8Array;function oe(t){var e=-1,i=Array(t.size);return t.forEach((function(t,r){i[++e]=[r,t]})),i}function se(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=t})),i}var ae=1,ce=2,ue="[object Boolean]",he="[object Date]",le="[object Error]",de="[object Map]",pe="[object Number]",ge="[object RegExp]",me="[object Set]",fe="[object String]",be="[object Symbol]",ye="[object ArrayBuffer]",ve="[object DataView]",we=L?L.prototype:void 0,ke=we?we.valueOf:void 0;function _e(t,e){for(var i=-1,r=e.length,n=t.length;++i<r;)t[n+i]=e[i];return t}function Se(t,e,i){var r=e(t);return K(t)?r:_e(r,i(t))}function Te(){return[]}var Ee=Object.prototype.propertyIsEnumerable,xe=Object.getOwnPropertySymbols,Ce=xe?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var i=-1,r=null==t?0:t.length,n=0,o=[];++i<r;){var s=t[i];e(s,i,t)&&(o[n++]=s)}return o}(xe(t),(function(e){return Ee.call(t,e)})))}:Te;function Oe(t){return Se(t,xt,Ce)}var Ae=1,Pe=Object.prototype.hasOwnProperty;var je=$t(j,"DataView"),Le=$t(j,"Promise"),ze=$t(j,"Set"),Ie=$t(j,"WeakMap"),Be="[object Map]",Fe="[object Promise]",Re="[object Set]",De="[object WeakMap]",Me="[object DataView]",Ue=Ft(je),Ne=Ft(Ht),We=Ft(Le),qe=Ft(ze),$e=Ft(Ie),He=N;(je&&He(new je(new ArrayBuffer(1)))!=Me||Ht&&He(new Ht)!=Be||Le&&He(Le.resolve())!=Fe||ze&&He(new ze)!=Re||Ie&&He(new Ie)!=De)&&(He=function(t){var e=N(t),i="[object Object]"==e?t.constructor:void 0,r=i?Ft(i):"";if(r)switch(r){case Ue:return Me;case Ne:return Be;case We:return Fe;case qe:return Re;case $e:return De}return e});var Ve=1,Ge="[object Arguments]",Ke="[object Array]",Qe="[object Object]",Je=Object.prototype.hasOwnProperty;function Ze(t,e,i,r,n,o){var s=K(t),a=K(e),c=s?Ke:He(t),u=a?Ke:He(e),h=(c=c==Ge?Qe:c)==Qe,l=(u=u==Ge?Qe:u)==Qe,d=c==u;if(d&&X(t)){if(!X(e))return!1;s=!0,h=!1}if(d&&!h)return o||(o=new Xt),s||lt(t)?re(t,e,i,r,n,o):function(t,e,i,r,n,o,s){switch(i){case ve:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case ye:return!(t.byteLength!=e.byteLength||!o(new ne(t),new ne(e)));case ue:case he:case pe:return Ot(+t,+e);case le:return t.name==e.name&&t.message==e.message;case ge:case fe:return t==e+"";case de:var a=oe;case me:var c=r&ae;if(a||(a=se),t.size!=e.size&&!c)return!1;var u=s.get(t);if(u)return u==e;r|=ce,s.set(t,e);var h=re(a(t),a(e),r,n,o,s);return s.delete(t),h;case be:if(ke)return ke.call(t)==ke.call(e)}return!1}(t,e,c,i,r,n,o);if(!(i&Ve)){var p=h&&Je.call(t,"__wrapped__"),g=l&&Je.call(e,"__wrapped__");if(p||g){var m=p?t.value():t,f=g?e.value():e;return o||(o=new Xt),n(m,f,i,r,o)}}return!!d&&(o||(o=new Xt),function(t,e,i,r,n,o){var s=i&Ae,a=Oe(t),c=a.length;if(c!=Oe(e).length&&!s)return!1;for(var u=c;u--;){var h=a[u];if(!(s?h in e:Pe.call(e,h)))return!1}var l=o.get(t),d=o.get(e);if(l&&d)return l==e&&d==t;var p=!0;o.set(t,e),o.set(e,t);for(var g=s;++u<c;){var m=t[h=a[u]],f=e[h];if(r)var b=s?r(f,m,h,e,t,o):r(m,f,h,t,e,o);if(!(void 0===b?m===f||n(m,f,i,r,o):b)){p=!1;break}g||(g="constructor"==h)}if(p&&!g){var y=t.constructor,v=e.constructor;y==v||!("constructor"in t)||!("constructor"in e)||"function"==typeof y&&y instanceof y&&"function"==typeof v&&v instanceof v||(p=!1)}return o.delete(t),o.delete(e),p}(t,e,i,r,n,o))}function Xe(t,e,i,r,n){return t===e||(null==t||null==e||!W(t)&&!W(e)?t!=t&&e!=e:Ze(t,e,i,r,Xe,n))}var Ye=1,ti=2;function ei(t){return t==t&&!vt(t)}function ii(t,e){return function(i){return null!=i&&(i[t]===e&&(void 0!==e||t in Object(i)))}}function ri(t){var e=function(t){for(var e=xt(t),i=e.length;i--;){var r=e[i],n=t[r];e[i]=[r,n,ei(n)]}return e}(t);return 1==e.length&&e[0][2]?ii(e[0][0],e[0][1]):function(i){return i===t||function(t,e,i,r){var n=i.length,o=n;if(null==t)return!o;for(t=Object(t);n--;){var s=i[n];if(s[2]?s[1]!==t[s[0]]:!(s[0]in t))return!1}for(;++n<o;){var a=(s=i[n])[0],c=t[a],u=s[1];if(s[2]){if(void 0===c&&!(a in t))return!1}else{var h=new Xt;if(!Xe(u,c,Ye|ti,r,h))return!1}}return!0}(i,0,e)}}var ni="[object Symbol]";function oi(t){return"symbol"==typeof t||W(t)&&N(t)==ni}var si=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ai=/^\w*$/;function ci(t,e){if(K(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!oi(t))||(ai.test(t)||!si.test(t)||null!=e&&t in Object(e))}var ui="Expected a function";function hi(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(ui);var i=function(){var r=arguments,n=e?e.apply(this,r):r[0],o=i.cache;if(o.has(n))return o.get(n);var s=t.apply(this,r);return i.cache=o.set(n,s)||o,s};return i.cache=new(hi.Cache||Zt),i}hi.Cache=Zt;var li,di,pi,gi=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,mi=/\\(\\)?/g,fi=(li=function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(gi,(function(t,i,r,n){e.push(r?n.replace(mi,"$1"):i||t)})),e},di=hi(li,(function(t){return 500===pi.size&&pi.clear(),t})),pi=di.cache,di);var bi=1/0,yi=L?L.prototype:void 0,vi=yi?yi.toString:void 0;function wi(t){if("string"==typeof t)return t;if(K(t))return function(t,e){for(var i=-1,r=null==t?0:t.length,n=Array(r);++i<r;)n[i]=e(t[i],i,t);return n}(t,wi)+"";if(oi(t))return vi?vi.call(t):"";var e=t+"";return"0"==e&&1/t==-bi?"-0":e}function ki(t,e){return K(t)?t:ci(t,e)?[t]:fi(function(t){return null==t?"":wi(t)}(t))}var _i=1/0;function Si(t){if("string"==typeof t||oi(t))return t;var e=t+"";return"0"==e&&1/t==-_i?"-0":e}function Ti(t,e){for(var i=0,r=(e=ki(e,t)).length;null!=t&&i<r;)t=t[Si(e[i++])];return i&&i==r?t:void 0}function Ei(t,e){return null!=t&&e in Object(t)}function xi(t,e){return null!=t&&function(t,e,i){for(var r=-1,n=(e=ki(e,t)).length,o=!1;++r<n;){var s=Si(e[r]);if(!(o=null!=t&&i(t,s)))break;t=t[s]}return o||++r!=n?o:!!(n=null==t?0:t.length)&&rt(n)&&et(s,n)&&(K(t)||G(t))}(t,e,Ei)}var Ci=1,Oi=2;function Ai(t,e){return ci(t)&&ei(e)?ii(Si(t),e):function(i){var r=function(t,e,i){var r=null==t?void 0:Ti(t,e);return void 0===r?i:r}(i,t);return void 0===r&&r===e?xi(i,t):Xe(e,r,Ci|Oi)}}function Pi(t){return t}function ji(t){return ci(t)?(e=Si(t),function(t){return null==t?void 0:t[e]}):function(t){return function(e){return Ti(e,t)}}(t);var e}function Li(t){return"function"==typeof t?t:null==t?Pi:"object"==typeof t?K(t)?Ai(t[0],t[1]):ri(t):ji(t)}var zi=function(){try{var t=$t(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();function Ii(t,e,i){"__proto__"==e&&zi?zi(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}class Bi{constructor(t){this.cookies=t}getAbTest(t,e){const i=`${l}${t}__`;let r=this.cookies.getCookie(i);return r||(r=this._selectAbTestVariant(e)),this.cookies.setCookie(i,r,"ab_test"),r}_selectAbTestVariant(t,e=Math.random()){let i=0;const r=function(t,e){var i={};return e=Li(e),Ct(t,(function(t,r,n){Ii(i,r,e(t,r,n))})),i}(t,(t=>(i+=t,i))),n=e*i;return function(t,e,i){var r;return i(t,(function(t,i,n){if(e(t,i,n))return r=i,!1})),r}(r,Li((t=>n<t)),Ct)}}function Fi(t,e){return e||(e=document.documentElement),Array.from(e.querySelectorAll(t))}class Ri{constructor(t,e){this.reporter=t,this.documentContentLoaded=e}materializeValue(t,e){if("constant"===t.type)return t.value;try{let i,r;if(r="string"==typeof t.selector?{selector:t.selector,type:"css"}:t.selector,"target"===r.type){if(null==e)return null;i=[e]}else if("target_css"===r.type){if(null==e)return null;i=Fi(r.selector,e)}else i=Fi(r.selector);if(0===i.length)return null;const n=this._fetchRawValueFromElementList(t,i);return this._applyValueConverter(n,t.converter)}catch(t){if(!(t instanceof Error))throw t}return null}materializeProperties(t,e,i){this.reporter.reportPromiseError(this.documentContentLoaded.whenLoaded()).then((()=>{const r={};t.forEach((({key:t,value:i})=>{r[t]=this.materializeValue(i,e)})),i(r)}))}materializeIds(t,e,i){this.reporter.reportPromiseError(this.documentContentLoaded.whenLoaded()).then((()=>{if("anonymous"===t.type)i({});else if("registered"===t.type){const r=this.materializeValue(t.id,e);i(null===r?{}:{registered:r})}}))}_fetchRawValueFromElementList(t,e){const i=e[0];return i instanceof Element?"from_html"===t.type?i.innerHTML:"value"===t.attribute&&i instanceof HTMLInputElement?""!==i.value?i.value:null:i.getAttribute(t.attribute):null}_applyValueConverter(t,e){return t&&e&&"replace"===e.type?t.replace(new RegExp(e.regex,"gm"),e.replace):t}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function Di(t,e,i,r){var n,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o<3?n(s):o>3?n(e,i,s):n(e,i))||s);return o>3&&s&&Object.defineProperty(e,i,s),s}function Mi(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function Ui(t,e,i,r){return new(i||(i=Promise))((function(e,n){function o(t){try{a(r.next(t))}catch(t){n(t)}}function s(t){try{a(r.throw(t))}catch(t){n(t)}}function a(t){t.done?e(t.value):new i((function(e){e(t.value)})).then(o,s)}a((r=r.apply(t,[])).next())}))}var Ni=Object.prototype.hasOwnProperty;function Wi(t,e,i){var r=t[e];Ni.call(t,e)&&Ot(r,i)&&(void 0!==i||e in t)||Ii(t,e,i)}function qi(t,e,i,r){var n=!i;i||(i={});for(var o=-1,s=e.length;++o<s;){var a=e[o],c=void 0;void 0===c&&(c=t[a]),n?Ii(i,a,c):Wi(i,a,c)}return i}var $i=Object.prototype.hasOwnProperty;function Hi(t){if(!vt(t))return function(t){var e=[];if(null!=t)for(var i in Object(t))e.push(i);return e}(t);var e=mt(t),i=[];for(var r in t)("constructor"!=r||!e&&$i.call(t,r))&&i.push(r);return i}function Vi(t){return Et(t)?pt(t,!0):Hi(t)}var Gi="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ki=Gi&&"object"==typeof module&&module&&!module.nodeType&&module,Qi=Ki&&Ki.exports===Gi?j.Buffer:void 0,Ji=Qi?Qi.allocUnsafe:void 0;function Zi(t,e){if(e)return t.slice();var i=t.length,r=Ji?Ji(i):new t.constructor(i);return t.copy(r),r}function Xi(t,e){var i=-1,r=t.length;for(e||(e=Array(r));++i<r;)e[i]=t[i];return e}var Yi=ft(Object.getPrototypeOf,Object),tr=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)_e(e,Ce(t)),t=Yi(t);return e}:Te;function er(t){return Se(t,Vi,tr)}var ir=Object.prototype.hasOwnProperty;function rr(t){var e=new t.constructor(t.byteLength);return new ne(e).set(new ne(t)),e}var nr=/\w*$/;var or=L?L.prototype:void 0,sr=or?or.valueOf:void 0;function ar(t,e){var i=e?rr(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}var cr="[object Boolean]",ur="[object Date]",hr="[object Map]",lr="[object Number]",dr="[object RegExp]",pr="[object Set]",gr="[object String]",mr="[object Symbol]",fr="[object ArrayBuffer]",br="[object DataView]",yr="[object Float32Array]",vr="[object Float64Array]",wr="[object Int8Array]",kr="[object Int16Array]",_r="[object Int32Array]",Sr="[object Uint8Array]",Tr="[object Uint8ClampedArray]",Er="[object Uint16Array]",xr="[object Uint32Array]";function Cr(t,e,i){var r,n=t.constructor;switch(e){case fr:return rr(t);case cr:case ur:return new n(+t);case br:return function(t,e){var i=e?rr(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}(t,i);case yr:case vr:case wr:case kr:case _r:case Sr:case Tr:case Er:case xr:return ar(t,i);case hr:return new n;case lr:case gr:return new n(t);case dr:return function(t){var e=new t.constructor(t.source,nr.exec(t));return e.lastIndex=t.lastIndex,e}(t);case pr:return new n;case mr:return r=t,sr?Object(sr.call(r)):{}}}var Or=Object.create,Ar=function(){function t(){}return function(e){if(!vt(e))return{};if(Or)return Or(e);t.prototype=e;var i=new t;return t.prototype=void 0,i}}();function Pr(t){return"function"!=typeof t.constructor||mt(t)?{}:Ar(Yi(t))}var jr=ut&&ut.isMap,Lr=jr?ot(jr):function(t){return W(t)&&"[object Map]"==He(t)};var zr=ut&&ut.isSet,Ir=zr?ot(zr):function(t){return W(t)&&"[object Set]"==He(t)},Br=1,Fr=2,Rr=4,Dr="[object Arguments]",Mr="[object Function]",Ur="[object GeneratorFunction]",Nr="[object Object]",Wr={};function qr(t,e,i,r,n,o){var s,a=e&Br,c=e&Fr,u=e&Rr;if(void 0!==s)return s;if(!vt(t))return t;var h=K(t);if(h){if(s=function(t){var e=t.length,i=new t.constructor(e);return e&&"string"==typeof t[0]&&ir.call(t,"index")&&(i.index=t.index,i.input=t.input),i}(t),!a)return Xi(t,s)}else{var l=He(t),d=l==Mr||l==Ur;if(X(t))return Zi(t,a);if(l==Nr||l==Dr||d&&!n){if(s=c||d?{}:Pr(t),!a)return c?function(t,e){return qi(t,tr(t),e)}(t,function(t,e){return t&&qi(e,Vi(e),t)}(s,t)):function(t,e){return qi(t,Ce(t),e)}(t,function(t,e){return t&&qi(e,xt(e),t)}(s,t))}else{if(!Wr[l])return n?t:{};s=Cr(t,l,a)}}o||(o=new Xt);var p=o.get(t);if(p)return p;o.set(t,s),Ir(t)?t.forEach((function(r){s.add(qr(r,e,i,r,t,o))})):Lr(t)&&t.forEach((function(r,n){s.set(n,qr(r,e,i,n,t,o))}));var g=h?void 0:(u?c?er:Oe:c?Vi:xt)(t);return function(t,e){for(var i=-1,r=null==t?0:t.length;++i<r&&!1!==e(t[i],i,t););}(g||t,(function(r,n){g&&(r=t[n=r]),Wi(s,n,qr(r,e,i,n,t,o))})),s}Wr[Dr]=Wr["[object Array]"]=Wr["[object ArrayBuffer]"]=Wr["[object DataView]"]=Wr["[object Boolean]"]=Wr["[object Date]"]=Wr["[object Float32Array]"]=Wr["[object Float64Array]"]=Wr["[object Int8Array]"]=Wr["[object Int16Array]"]=Wr["[object Int32Array]"]=Wr["[object Map]"]=Wr["[object Number]"]=Wr[Nr]=Wr["[object RegExp]"]=Wr["[object Set]"]=Wr["[object String]"]=Wr["[object Symbol]"]=Wr["[object Uint8Array]"]=Wr["[object Uint8ClampedArray]"]=Wr["[object Uint16Array]"]=Wr["[object Uint32Array]"]=!0,Wr["[object Error]"]=Wr[Mr]=Wr["[object WeakMap]"]=!1;var $r,Hr,Vr;function Gr(t){return qr(t,5)}function Kr(t){Object.keys(t).forEach((e=>{switch(typeof t[e]){case"object":t[e]&&Kr(t[e]);break;case"function":t[e]=String(t[e])}}))}function Qr(t){return("0"+t.toString(16)).slice(-2)}function Jr(t,e=window){if(t%2)throw new Error("The length of the random string should be an even number!");const i=e.crypto||e.msCrypto;if(i&&i.getRandomValues&&Array.from){const e=new Uint8Array(t/2);return i.getRandomValues(e),Array.from(e,Qr).join("")}let r="";for(let e=0;e<t/2;e++)r+=Qr(Math.round(256*Math.random()));return r}function Zr(t,e,i=void 0){const r=(n=/[\[\]\.]/,e.split(n).filter(Boolean).reduce(((t,e)=>null!=t?t[e]:t),t));var n;return void 0===r?i:r}function Xr(t){return!Object.entries(t||{}).length&&!(null==t?void 0:t.length)&&!(null==t?void 0:t.size)}function Yr(t,e,i=!1){let r;return function(){const n=this,o=arguments;clearTimeout(r),!i||r?r=setTimeout((function(){r=null,t.apply(n,o)}),e):t.apply(n,o)}}function tn(t){return null!=t&&"string"==typeof t.valueOf()}function en(t){return"function"==typeof t}function rn(t,e,i,r=""){if(!i)return"Other";const n=!!t.opr&&!!t.opr.addons||!!t.opera||/ OPR\//.test(i),o=!!!e.documentMode&&!!t.StyleMedia;
// @cc_on!@
if(n)return/Mini/.test(i)?"Opera Mini":"Opera";if(o)return"Microsoft Edge";return/SAMSUNG|SGH-[I|N|T]|GT-[I|P|N]|SM-[N|P|T|Z|G]|SHV-E|SCH-[I|J|R|S]|SPH-L/i.test(i)?"Samsung Browser":/Chrome/.test(i)?"Chrome":/Apple/.test(r)?/Mobile/.test(i)?"Mobile Safari":"Safari":/Android/.test(i)?"Android Mobile":/Konqueror/.test(i)?"Konqueror":/Firefox/.test(i)?"Firefox":/MSIE/.test(i)||/Trident/.test(i)?"Internet Explorer":/Gecko/.test(i)?"Mozilla":"Other"}function nn(t){if(!t)return"Other";const e={iPhone:"iPhone",iPad:"iPad",iPod:"iPod","Windows Phone":"Windows Phone",Android:"Android",BlackBerry:"(BlackBerry|BB10|PlayBook)"};for(const i in e){if(!e.hasOwnProperty(i))continue;if(new RegExp(e[i],"i").test(t))return i}return"Other"}function on(t,e){return{os:(i=t.navigator.userAgent,i?/Windows/i.test(i)?/Phone/.test(i)?"Windows Mobile":"Windows":/(iPhone|iPad|iPod)/.test(i)?"iOS":/Android/.test(i)?"Android":/Mac/i.test(i)?"Mac OS X":/Linux/.test(i)?"Linux":"Other":"Other"),browser:rn(t,e,t.navigator.userAgent,t.navigator.vendor),device:nn(t.navigator.userAgent)};var i}!function(t){t.str2ab8=function(t){const e=new ArrayBuffer(t.length),i=new Uint8Array(e);for(let e=0,r=t.length;e<r;e++)i[e]=t.charCodeAt(e);return e},t.str2ab16=function(t){const e=new ArrayBuffer(2*t.length),i=new Uint16Array(e);for(let e=0,r=t.length;e<r;e++)i[e]=t.charCodeAt(e);return e}}($r||($r={})),function(t){t.Handler=class{constructor(t,e){this.window=t,this.debug=e,this.isInitialized=new Promise((t=>{this.resolveInitialization=t}))}initialize(){return Ui(this,0,void 0,(function*(){if(!this.window.crypto||!this.window.crypto.subtle)return this.debug.log("Crypto API is not available in this browser, browser extension communication is disabled"),void this.resolveInitialization(!1);const t=$r.str2ab8(this.window.atob("MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEApOsQPnGejMMA3SWpmByzZaXlSla2IK2NLV11r4/Qd8MgjvT63cNkM/j3w2E/fCJ1C+cdDPTCZcXgUVFdSXvVAEmNscx/3SZBCvAfXVYUj3fkk00XPO425cSQ6368/fEoa8ocqFtHwSlHyaWZBerp6tfawkhvzJSk8sSfQB0slMyy/IsPQU/jwE9sCKjvPO3QcSTvslTyKSIVeVrxOMULA7HT2u9XaVzGd45l8KxdLfTd7o1XHBw2meA566tQ65Po/wy/3ycM7b8LXG6e+I7xCrHudTlLRVISkSx4Uh4XLJF47EwRIVCvtosY7AENjzLV56D9INCeVBv8GraYPtXJQ3iF65v4bPq8kjm+RNUWxzzLYpJ/tt5Utx5ZVogtN18iObVmw+sR+yY3rJOohUyPwSEhNRfQ9qGEJAImUuqOU6HSUHDD2QDfonsHKPwfEN1l5q3oyMIe73yjtulTUkk0MVPvV0F/v7kwLGZDyoskZ6aDuhSDJf/UTxCjzpbtuYX6VUQyid0X3Dr7fswvFn9ucZydNTW1ZOC/nszmu7Rl+Fk+OsEcTLM0CfZP+1n+bd17+UtIAl4rChmJGhEyz4c4/TFuACcaz8vlIeNZ+9MbXZ1VbI9kOB6roQzGQ2qpirKk1dtrV1Lb/6ODixSGtJ0ShcH7y0icxR8HK71j+oT4mN0CAwEAAQ==".trim())),e=this.window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["wrapKey"]),i=this.window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt"]),r=Promise.all([e,i]).then((([t,e])=>this.window.crypto.subtle.wrapKey("raw",e,t,{name:"RSA-OAEP"})));this.keys=Promise.all([i,r]).then((([t,e])=>({aes:t,aesEncrypted:e}))),e.catch((t=>{this.debug.error("Failed to import the encryption key used in BrowserExtension.Handler:",t)})),i.catch((t=>{this.debug.error("Failed to generate the encryption key used in BrowserExtension.Handler:",t)})),r.catch((t=>{this.debug.error("Failed to wrap the encryption key used in BrowserExtension.Handler:",t)})),yield this.keys.then((()=>this.resolveInitialization(!0)),(t=>{throw this.resolveInitialization(!1),t}))}))}sendPayload(t,e={type:"success"},i=Date.now()){const r=Jr(32,this.window),n=this.sendMessage({type:"payload",id:r,timestamp:i,state:e,payload:t});return t=>{(()=>{Ui(this,0,void 0,(function*(){yield n,yield this.updateState(r,t)}))})()}}updateState(t,e){return Ui(this,0,void 0,(function*(){yield this.sendMessage({type:"stateupdate",target:t,state:e})}))}sendMessage(t){return Ui(this,0,void 0,(function*(){if(!(yield this.isInitialized))return;if(!this.keys)throw new Error("BrowserExtension.Handler's keys must be assigned when initialization is resolved!");const e=Gr(t);Kr(e);const i=$r.str2ab16(JSON.stringify(e)),r=this.window.crypto.getRandomValues(new Uint8Array(16)).buffer;let n,o,s;try{({aes:n,aesEncrypted:o}=yield this.keys)}catch(t){return}try{s=yield this.window.crypto.subtle.encrypt({name:"AES-GCM",iv:r},n,i)}catch(t){return void this.debug.error("Failed to encrypt the data before sending it to the extension:",t)}try{this.window.postMessage({data:s,key:o,iv:r,version:"webxp-js-client-message:v2"},"*")}catch(t){this.debug.error("Failed to send the encrypted data:",t)}}))}}}(Hr||(Hr={})),function(t){t.Ids="system/ids",t.Time="system/time",t.Tracking="system/tracking",t.Clicks="campaigns/clicks",t.Customers="crm/customers",t.Events="crm/events",t.PushNotificationsVapidKey="system/push-notifications-vapid-key"}(Vr||(Vr={}));const sn=new RegExp("[?&]+xnpe_cmp=([^&]*)","gi");class an{constructor(t,e,i,r,n,o,s,a){this.location=t,this.queue=e,this.config=i,this.timestamp=r,this.time=n,this.debug=o,this.window=s,this.document=a}parseUrlAndTrackCampaignClick(){const t=this.getCampaignClickTokenFromUrl();t&&this.trackClickEventWithToken(t)}getCampaignClickTokenFromUrl(){if(this.debug.log("Getting campaign click token from the URL"),this.location.search){const t=this.location.search.match(sn);if(t)return t[0].split("=")[1]}return null}trackClickEventWithToken(t){const e=this.timestamp.getTimestamp();this.debug.log("Tracking campaign click with token",t),this.queue.enqueue({name:Vr.Clicks,prepareData:t=>({data:{company_id:this.config.getToken(),age:t-e,url:this.location.href,timestamp:this.time.isTimeInitialized()?this.timestamp.getTimestampWithOffset():void 0,properties:on(this.window,this.document)}})})}}function cn(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}var un=Math.max;var hn=zi?function(t,e){return zi(t,"toString",{configurable:!0,enumerable:!1,value:(i=e,function(){return i}),writable:!0});var i}:Pi,ln=Date.now;var dn=function(t){var e=0,i=0;return function(){var r=ln(),n=16-(r-i);if(i=r,n>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(hn);function pn(t,e){return dn(function(t,e,i){return e=un(void 0===e?t.length-1:e,0),function(){for(var r=arguments,n=-1,o=un(r.length-e,0),s=Array(o);++n<o;)s[n]=r[e+n];n=-1;for(var a=Array(e+1);++n<e;)a[n]=r[n];return a[e]=i(s),cn(t,this,a)}}(t,e,Pi),t+"")}function gn(t,e,i){(void 0!==i&&!Ot(t[e],i)||void 0===i&&!(e in t))&&Ii(t,e,i)}var mn="[object Object]",fn=Function.prototype,bn=Object.prototype,yn=fn.toString,vn=bn.hasOwnProperty,wn=yn.call(Object);function kn(t){if(!W(t)||N(t)!=mn)return!1;var e=Yi(t);if(null===e)return!0;var i=vn.call(e,"constructor")&&e.constructor;return"function"==typeof i&&i instanceof i&&yn.call(i)==wn}function _n(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}function Sn(t,e,i,r,n,o,s){var a=_n(t,i),c=_n(e,i),u=s.get(c);if(u)gn(t,i,u);else{var h,l=o?o(a,c,i+"",t,e,s):void 0,d=void 0===l;if(d){var p=K(c),g=!p&&X(c),m=!p&&!g&&lt(c);l=c,p||g||m?K(a)?l=a:W(h=a)&&Et(h)?l=Xi(a):g?(d=!1,l=Zi(c,!0)):m?(d=!1,l=ar(c,!0)):l=[]:kn(c)||G(c)?(l=a,G(a)?l=function(t){return qi(t,Vi(t))}(a):vt(a)&&!Tt(a)||(l=Pr(c))):d=!1}d&&(s.set(c,l),n(l,c,r,o,s),s.delete(c)),gn(t,i,l)}}function Tn(t,e,i,r,n){t!==e&&O(e,(function(o,s){if(n||(n=new Xt),vt(o))Sn(t,e,s,i,Tn,r,n);else{var a=r?r(_n(t,s),o,s+"",t,e,n):void 0;void 0===a&&(a=o),gn(t,s,a)}}),Vi)}function En(t,e,i,r,n,o){return vt(t)&&vt(e)&&(o.set(e,t),Tn(t,e,void 0,En,o),o.delete(e)),t}function xn(t,e,i){if(!vt(i))return!1;var r=typeof e;return!!("number"==r?Et(i)&&et(e,i.length):"string"==r&&e in i)&&Ot(i[e],t)}var Cn,On=(Cn=function(t,e,i,r){Tn(t,e,i,r)},pn((function(t,e){var i=-1,r=e.length,n=r>1?e[r-1]:void 0,o=r>2?e[2]:void 0;for(n=Cn.length>3&&"function"==typeof n?(r--,n):void 0,o&&xn(e[0],e[1],o)&&(n=r<3?void 0:n,r=1),t=Object(t);++i<r;){var s=e[i];s&&Cn(t,s,i,n)}return t}))),An=pn((function(t){return t.push(void 0,En),cn(On,void 0,t)}));const Pn=94608e3,jn=94608e3,Ln=Object.freeze({hide_class:"xnpe_async_hide",timeout:4e3,mode:"async"});class zn{constructor(t,e={}){this.logger=t,this.options=zn.DEFAULT_OPTIONS,this.extendOptions(e)}getOptions(){return this.options}getToken(){if("string"!=typeof this.options.token)throw new Error("The token in config object is not set!");return this.options.token}getNewExperimentsOptions(){const t=this.getOptions().new_experiments;return!!t&&(!0===t?Ln:Object.assign({},Ln,t))}getActivityHandlerOptions(){const t=this.getOptions().ping.activity;return"object"==typeof t?t:{click:!0,key:!0,scroll:!0,move:!0}}extendOptions(t){void 0!==t.track_hash_changes&&this.logger.warn("Configuration option track_hash_changes is deprecated, use the spa_reloading.on_hash_change option instead"),this.options=An({},t,this.options)}setNewCustomerIds(t){this.options.customer=t}isSpaReloadingEnabled(t){return!0===this.getOptions().spa_reloading||!1!==this.getOptions().spa_reloading[t]}}zn.DEFAULT_OPTIONS=Object.freeze({target:"//api.exponea.com",token:null,utm_always:!1,customer:{},ping:{enabled:!0,interval:120,activity:!1,properties:{}},lazy_merge:!1,track:{auto:!0,visits:!1,visits_query_params:["pers_position","pers_content"],activity:!1,unloads:!1,exits:!0,default_properties:{},google_analytics:!0},modify:{enabled:!0,overlay:!1,delay:500},cookies:{cross_subdomain:!0,retrieve_callback:null,expires:{tracking:Pn,ab_test:jn,time:3600}},track_hash_changes:!0,transfer_identity:!0,error_reporting:"errors_only",debug:!1,utm_params:["utm_source","utm_medium","utm_campaign","utm_term","utm_content","gclid","campaign_id"],dependencies:{},webOptimization:!0,push:{safari:{websitePushID:null}},spa_reloading:!0,feature_flags:null,service_worker_path:"/service-worker.js",exposed_segments:{ttl:3e5,prefetch:!1,notify:!1,segmentation_processing_delay:5e3},compliance:{opt_in:!1},link_cookie:!1,data_layer:!1});class In{constructor(t,e){this.config=t,this.http=e}rewardBandit(t,e,i,r){const n=this.config.getOptions().target;this.http.post(`${n}/webxp/bandits/reward`,{reward_token:t,value:e},{credentials:"omit",responseType:"text"}).then((t=>t.body)).then(i,r)}}var Bn,Fn,Rn,Dn;function Mn(t){return function(i,r,n){try{const o=n.type,s=n.operator,a=n.operands;if(Bn.whitelist.indexOf(s)>-1)return function(t,e,i,r){const n=t[i];switch(r){case Bn.isSet:return null!=n;case Bn.isNotSet:return null==n;case Bn.hasValue:return Un(e)?(null==n?void 0:n.length)>0:n+""!="";case Bn.hasNoValue:return Un(e)?0===(null==n?void 0:n.length):n+""==""}return!1}(i,o,r,s);if(function(t){return"string"===t}(o))return function(t,i,r,n){if(-1===Fn.whitelist.indexOf(r))return e(r,"string"),!1;const o=t[i]+"";let s;switch(r){case Fn.equals:return o===n[0].value;case Fn.doesNotEqual:return o!==n[0].value;case Fn.isIn:return s=n.map((t=>t.value)),s.indexOf(o)>-1;case Fn.isNotIn:return s=n.map((t=>t.value)),-1===s.indexOf(o);case Fn.contains:return o.indexOf(n[0].value)>-1;case Fn.doesNotContain:return-1===o.indexOf(n[0].value);case Fn.startsWith:return o.startsWith(n[0].value);case Fn.endsWith:return o.endsWith(n[0].value);case Fn.matchesRegex:return null!==new RegExp(n[0].value).exec(o)}return!1}(i,r,s,a);if(function(t){return"number"===t}(o))return function(t,i,r,n){if(-1===Rn.whitelist.indexOf(r))return e(r,"number"),!1;const o=parseFloat(t[i]+""),s=parseFloat(n[0].value);switch(r){case Rn.equalTo:return o===s;case Rn.inBetween:return s<=o&&o<=parseFloat(n[1].value);case Rn.lessThan:return o<s;case Rn.greaterThan:return o>s}return!1}(i,r,s,a);if(function(t){return"boolean"===t}(o))return function(t,i,r,n){if(-1===Dn.whitelist.indexOf(r))return e(r,"boolean"),!1;const o=t[i]+"",s=n.value+"";if(r===Dn.is)return o===s;return!1}(i,r,s,n);(function(t){return"date"===t})(o)&&t.error("Value filter: Date type is not supported."),Un(o)&&t.error("Value filter: List type is not supported.")}catch(e){t.debug("Value filter error:",e)}return t.debug("Invalid value filter:",n.operator),!1};function e(e,i){t.error("Contextual Bandits: operation "+e+" not suported for type "+i+".")}}function Un(t){return"list"===t}!function(t){t.isSet="is set",t.isNotSet="is not set",t.hasValue="has value",t.hasNoValue="has no value",t.whitelist=[t.isSet,t.isNotSet,t.hasValue,t.hasNoValue]}(Bn||(Bn={})),function(t){t.equals="equals",t.doesNotEqual="does not equal",t.isIn="in",t.isNotIn="not in",t.contains="contains",t.doesNotContain="does not contain",t.startsWith="starts with",t.endsWith="ends with",t.matchesRegex="regex",t.whitelist=[t.equals,t.doesNotEqual,t.isIn,t.isNotIn,t.contains,t.doesNotContain,t.startsWith,t.endsWith,t.matchesRegex]}(Fn||(Fn={})),function(t){t.equalTo="equal to",t.inBetween="in between",t.lessThan="less than",t.greaterThan="greater than",t.whitelist=[t.equalTo,t.inBetween,t.lessThan,t.greaterThan]}(Rn||(Rn={})),function(t){t.is="is",t.whitelist=[t.is]}(Dn||(Dn={}));class Nn{constructor(t,e){this.contextualBandit=t,this.debug=e,this.optimizationTargets=[],this.eventFilterMatcher=Mn(this.debug)}put(t,e,i,r){if(""===t)throw new Error("Event type can't be an empty string");if(""===i)throw new Error("Reward token can't be an empty string");this.optimizationTargets.push({eventType:t,valueFilters:e,rewardToken:i,rewardWeight:r})}reward(t,e){const{matchingTargets:i,remainingTargets:r}=this.optimizationTargets.reduce(function(t,e,i){return function(r,n){return n.eventType!==i?(r.remainingTargets.push(n),r):n.valueFilters.reduce(((i,r)=>i&&e(t,r.attribute.property,r.constraint)),!0)?(r.matchingTargets.push(n),r):(r.remainingTargets.push(n),r)}}(t,this.eventFilterMatcher,e),{matchingTargets:[],remainingTargets:[]});i.forEach((t=>{this.contextualBandit.rewardBandit(t.rewardToken,t.rewardWeight)})),this.optimizationTargets=r}}var Wn=4;function qn(t){return qr(t,Wn)}var $n,Hn=ut&&ut.isDate,Vn=Hn?ot(Hn):function(t){return W(t)&&"[object Date]"==N(t)};!function(t){t.cookie="bre.cookie"}($n||($n={}));let Gn=class{constructor(t,e,i){this.debug=t,this.window=e,this.config=i}get isEnabled(){return!1!==this.config.getOptions().data_layer}get name(){const t=this.config.getOptions().data_layer;if("string"==typeof t){if(!t.length)throw this.debug.error("Data layer name is an empty string"),new Error("Data layer name is an empty string");return t}if(!0===t)return"dataLayer";throw this.debug.error("Data layer not configured properly"),new Error("Data layer not configured properly")}push(t){this.isEnabled&&(this.window[this.name]=this.window[this.name]||[],this.window[this.name].push(t))}};var Kn;function Qn(t){if("number"!=typeof t)return t;const e=new Date;return new Date(e.getTime()+1e3*t)}!function(t){t[t.defer=0]="defer",t[t.immediate=1]="immediate"}(Kn||(Kn={}));class Jn{constructor(t,e,i,r,n,o,s,a){this.config=t,this.debug=e,this.logger=i,this.queue=r,this.location=n,this.document=o,this.segments=s,this.dataLayer=a,this.lastSetCookie=""}getCookie(t){const e=this.document.cookie?this.document.cookie.split("; "):[];for(let i=0,r=e.length;i<r;i++){const r=e[i].split("="),n=r.shift();if(n){const e=decodeURIComponent(n),i=r.join("=");if(t===e)return this.parseCookieValue(i)}}}setCookie(t,e,i){let r=this.config.getOptions().cookies.expires[i];r=Qn(r);const n=function(t,e=document.location.hostname){if(!t)return"";if(tn(t))return t;const i=e.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i),r=i?i[0]:"";return r||""}(this.config.getOptions().cookies.cross_subdomain);this.document.cookie=[encodeURIComponent(t),"=",encodeURIComponent(e),"; expires="+r.toUTCString(),"; path=/",n?"; domain="+n:"","https:"===this.location.protocol?"; secure; samesite=none":"; samesite=lax"].join("")}sendCustomerCookieToServer(t){this.queue.enqueue({name:Vr.Ids,isBlocking:!0,prepareData:()=>Zn(this.config,{cookie:t}),processResponse:t=>{this.debug.log("received customer ids response",t);const e=t.data,i=e.cookie;this.debug.log("cookie received from server is "+i),this.setTrackingCookie(i),this.config.extendOptions({customer:e}),this.segments.prefetch()}},{process:Kn.immediate})}setTrackingCookie(t){this.setCookie(r,t,"tracking"),this.lastSetCookie!==t&&this.dataLayer.push({event:$n.cookie,cookie:t,opt_in:this.config.getOptions().compliance.opt_in}),this.lastSetCookie=t}setFreshTrackingCookie(){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}));return this.setTrackingCookie(t),t}sanitizeCookieOptions(){let t=this.config.getOptions().cookies.expires;function e(t,e,i,r,n){"number"==typeof e&&e>0||Vn(e)&&e>new Date||("number"==typeof e?r.warn(`When specifying the number of seconds for cookies.expires.${t}, you have to use a positive number. You passed in '${e}'. The SDK will use the default value of ${i}. Read more at\nhttps://docs.exponea.com/docs/configuration#cookies-options`):Vn(e)?r.warn(`When specifying a Date for cookies.expires.${t}, you have to use a date in the future. You passed in '${e}'. The SDK will use the default value of ${i}. Read more at\nhttps://docs.exponea.com/docs/configuration#cookies-options`):r.warn(`You can only use a number or a Date object for cookies.expires.${t}, not '${typeof e}'. The SDK will use the default value of ${i}. Read more at\nhttps://docs.exponea.com/docs/configuration#cookies-options`),n.extendOptions({cookies:{expires:{[t]:i}}}))}vt(t)&&!Vn(t)||(t={tracking:t,ab_test:t,time:t},this.config.extendOptions({cookies:{expires:t}})),e("tracking",t.tracking,Pn,this.logger,this.config),e("ab_test",t.ab_test,jn,this.logger,this.config),e("time",t.time,3600,this.logger,this.config)}parseCookieValue(t){0===t.indexOf('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return t=decodeURIComponent(t.replace(/\+/g," "))}catch(e){return this.debug.error("error while parsing cookie value, ignoring",e),t}}}function Zn(t,e){const i=t.getOptions().cookies.expires,r=qn(t.getOptions().customer);return delete r.cookie,{data:{project_id:t.getToken(),cookie:e.cookie,tifc:e.tifc,customer:r,expires:Math.floor(Qn(i.tracking).getTime()/1e3)}}}function Xn(t){setTimeout(t)}function Yn(){return function(t,e,i){const r=i.value,n=Date.now(),o=r.name;return i.value=function(){try{return r.apply(this,arguments)}catch(t){throw this.reporter.sendErrorReport(t,o,n),t}},i}}const to=Object.freeze({immediate:!1});class eo{constructor(t,e,i,r,n,o,s,a,c,u,h,l,d){this.reporter=t,this.config=e,this.contextualBanditEventFilter=i,this.time=r,this.timestamp=n,this.queue=o,this.debug=s,this.document=a,this.location=c,this.initializeState=u,this.window=h,this.url=l,this.browserExtension=d,this.eventTrackingListeners=[]}track(t,e={},i={},r=!1){const n=this.timestamp.getTimestamp();this.reporter.reportPromiseError(this.initializeState.whenInitialized()).then((()=>{const r=Object.assign({},to,i),o=Object.assign(Object.assign(Object.assign(Object.assign({location:this.location.href},on(this.window,this.document)),this.getUtmParamsIfEnabled()),this.getTrackDefaultPropertiesIfEnabled()),e);this.contextualBanditEventFilter.reward(o,t);const s=this.browserExtension.sendPayload({type:"event",eventType:t,eventProperties:o},{type:"pending"});this.queue.enqueue({name:Vr.Events,prepareData:e=>{const i=this.config.getOptions().customer;this.debug.log("Tracking event: "+t,o);const r={customer_ids:i,company_id:this.config.getToken(),type:t,age:e-n,properties:o};this.time.isTimeInitialized()&&(r.timestamp=this.timestamp.getTimestampWithOffset());try{this.triggerEventTrackingListeners(t,o)}catch(t){this.debug.error("Error triggering event tracking listeners",t)}return{data:r}},processResponse:(t,e,i)=>{Xn((()=>{var n;return null===(n=r.successCallback)||void 0===n?void 0:n.call(r,t,e,i)})),s({type:"success"})},processError:t=>{Xn((()=>{var e;return null===(e=r.errorCallback)||void 0===e?void 0:e.call(r,t)})),s({type:"error",error:String(t)})}},{process:r.immediate?Kn.immediate:Kn.defer})})).then((()=>{("web_unload"===t||"user_active"===t&&r)&&this.queue.sendBulkWithBeacon()}))}getUtmParamsIfEnabled(){const t=this.config.getOptions();if(t.utm_always){return t.utm_params?this.url.getParams(t.utm_params):{}}return{}}getTrackDefaultPropertiesIfEnabled(){const t=this.config.getOptions();return t.track&&t.track.default_properties?t.track.default_properties:{}}registerEventTrackingListener(t){this.eventTrackingListeners.push(t)}trackPageVisitEventIfEnabled(){const t=this.config.getOptions().track;t&&t.visits&&(this.trackPageVisitEvent(),this.config.isSpaReloadingEnabled("visits")&&this.url.onChange("trackPageVisitOnUrlChange",(()=>{this.trackPageVisitEvent()})))}trackPageVisitEvent(){this.track("page_visit",Object.assign({referrer:this.document.referrer,location:this.location.href,path:this.location.pathname},this.url.getParams(this.config.getOptions().track.visits_query_params)))}triggerEventTrackingListeners(t,e){for(let i=0;i<this.eventTrackingListeners.length;i++)try{this.eventTrackingListeners[i](t,e)}catch(t){this.debug.error(`Error when processing event listener ${this.eventTrackingListeners[i].name||i}`,t)}}}Di([Yn(),Mi("design:type",Function),Mi("design:paramtypes",[String,Object,Object,Object]),Mi("design:returntype",void 0)],eo.prototype,"track",null);function io(t,e,i,r=0){if(r>10)throw new Error(`Maximum number of retries reached while waiting for window.ga to appear (already waited for ${500*r}ms). window.gtag is available but it does not appear to load window.ga anymore!`);if(e.ga)return t.log(`window.ga is available after ${r} retries`),void e.ga(i);if(e.gtag)return t.log(`window.gtag is available, trying ${r} retry`),void e.setTimeout(io.bind(void 0,t,e,i,r+1),500);throw new Error("No window.ga nor window.gtag is available in waitForGoogleAnalyticsSdkToLoad!")}var ro,no;!function(t){t.BannersShow="campaigns/banners/show",t.ExperimentsShow="campaigns/experiments/show",t.HtmlGet="campaigns/html/get",t.ManagedTagsShow="managed-tags/show",t.Recommendation="optimization/recommend/user",t.WebOptimization="webxp/projects/<project_id>/bundle",t.Segments="webxp/projects/<project_id>/segments?cookie=<cookie>",t.LinkIds="webxp/projects/<project_id>/cookies/<cookie>/link-ids"}(ro||(ro={})),function(t){t.Internal="internal"}(no||(no={}));class oo{constructor(t,e,i,r,n,o,s,a,c){this.reporter=t,this.config=e,this.queue=i,this.debug=r,this.initializeState=n,this.window=o,this.cookies=s,this.browserExtension=a,this.segments=c}requestCustomerIdsFromServer(t,e=(()=>{})){this.queue.enqueue({name:Vr.Ids,isBlocking:!0,prepareData:()=>Zn(this.config,t),processResponse:t=>{this.debug.log("received customer ids response",t);const i=t.data,r=i.cookie;this.debug.log("cookie received from server is "+r),this.cookies.setTrackingCookie(r),this.config.extendOptions({customer:i}),e(i),this.segments.prefetch(),this.segments.notify()}},{first:!0})}filterEmptyCustomerIds(t){const e={};for(const i in t)!t.hasOwnProperty(i)||null!==t[i]&&void 0!==t[i]&&""!==t[i]?e[i]=t[i]:this.debug.log("Removed empty customer id: "+i,t[i]);return e}identifyCustomerWithGoogleAnalyticsId(){const t=this.config.getOptions();t.customer&&t.customer.google_analytics||t.track.google_analytics&&(!function(t){return"ga"in t||"gtag"in t}(this.window)?this.debug.warn("Missing Google Analytics SDK (window.ga and window.gtag are not defined). Either integrate Google Analytics with your website or disable Google Analytics integration in the SDK config:\nhttps://docs.exponea.com/docs/config-object"):!function(t){return"ga"in t&&"function"!=typeof t.ga}(this.window)?io(this.debug,this.window,(()=>{if(!this.window.ga||!this.window.ga.getAll)throw new Error("window.ga is missing the getAll function");const e=this.window.ga.getAll();if(!e)return;const i=function(t){var e;const i=t.find((t=>{var e;return null===(e=t.get)||void 0===e?void 0:e.call(t,"clientId")}));return null===(e=null==i?void 0:i.get)||void 0===e?void 0:e.call(i,"clientId")}(e);i&&(this.config.extendOptions({customer:Object.assign(Object.assign({},t.customer),{google_analytics:i})}),this.updateCustomer({}))})):this.debug.warn("Incorrect Google Analytics SDK detected (window.ga is "+typeof this.window.ga+"). Are you using an old Google Analytics SDK? This is not supported in the SDK so Google Analytics integration will not work. Either upgrade the Google Analytics SDK or disable Google Analytics integration in the SDK config:\nhttps://docs.exponea.com/docs/config-object"))}updateCustomer(t,e=(()=>{}),i=(()=>{}),r=!1){this.reporter.reportPromiseError(this.initializeState.whenInitialized()).then((()=>{this.queue.enqueue({name:Vr.Customers,prepareData:()=>{const e=Object.assign({},t);return{data:{ids:this.config.getOptions().customer,company_id:this.config.getToken(),properties:e}}},processResponse:e,processError:i},{process:r?Kn.immediate:Kn.defer})}))}linkCustomerIds(t=(()=>{}),e=(()=>{}),i=!1){this.reporter.reportPromiseError(this.initializeState.whenInitialized()).then((()=>{this.queue.enqueue({name:ro.LinkIds,allowedToFail:!0,noBulk:!0,prepareData:()=>({data:{external_ids:this.config.getOptions().customer}}),processResponse:t,processError:e},{process:i?Kn.immediate:Kn.defer})}))}identifyCustomer(t,e={},i=(()=>{}),r=(()=>{}),n=!1,o,s){"string"!=typeof t&&"number"!=typeof t||(t={registered:t});const a=this.config.getOptions().customer,c=this.filterEmptyCustomerIds(t);c.cookie=a.cookie,a.google_analytics&&(c.google_analytics=a.google_analytics),this.debug.log("Identifying customer: ",c),this.browserExtension.sendPayload({type:"ids",ids:c}),this.config.extendOptions({customer:c}),this.updateCustomer(e,i,r,n),o&&this.linkCustomerIds(o,s,n)}}class so{constructor(t){this.config=t,this.DEFAULT_DEPENDENCIES={exp:"https://exp-framework.exponea.com/exp.js"},this.loadedDependencies=new Map}get options(){return this.config.getOptions()}loadDependency(t){let e;e="[object Array]"===Object.prototype.toString.call(t)?t:[t];try{const t=this.getDependencyUrls(e);return this.getDependencyLoadingChain(t)}catch(t){return Promise.reject(t)}}getDependencyUrls(t){const e=[];for(const i of t){let t=this.DEFAULT_DEPENDENCIES[i];if(this.options.dependencies&&this.options.dependencies[i]&&(t=this.options.dependencies[i]),!t)throw new Error(`unknown dependency named '${i}'`);e.push(t)}return e}getDependencyLoadingChain(t){let e=Promise.resolve();for(const i of t)e=e.then((()=>this.loadDependencyFromUrl(i)));return e}loadDependencyFromUrl(t){const e=this.loadedDependencies.get(t);if(e)return e;const i=new Promise(((e,i)=>{const r=document.getElementsByTagName("head")[0]||document.documentElement,n=document.createElement("script");n.src=t;let o=!1;n.onload=n.onreadystatechange=function(){o||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(o=!0,e(),n.onload=n.onreadystatechange=null,r&&n.parentNode&&r.removeChild(n))},n.onerror=function(e){const r="message"in e?`: ${e.message}`:"";i(new Error(`Loading of dependency '${t}' failed${r}`))},n.onabort=function(){i(new Error(`Loading of dependency '${t}' was aborted`))},r.insertBefore(n,r.firstChild)}));return this.loadedDependencies.set(t,i),i}}class ao{constructor(t,e){this.window=t,this.document=e}whenLoaded(){return this.loadedPromise||(this.loadedPromise=new Promise((t=>function(t,e,i){let r=!1,n=!0;const o=e.documentElement,s="addEventListener"in e?"addEventListener":"attachEvent",a="removeEventListener"in e?"removeEventListener":"detachEvent",c="addEventListener"in e?"":"on";if("complete"===e.readyState)i.call(t,"lazy");else{if(e.createEventObject&&o.doScroll){try{n=!t.frameElement}catch(t){}n&&function e(){try{o.doScroll("left")}catch(t){return void setTimeout(e,50)}r=!0,i.call(t,"poll")}()}e[s](c+"DOMContentLoaded",u,!1),e[s](c+"readystatechange",u,!1),t[s](c+"load",u,!1)}function u(n){if("readystatechange"===n.type&&"complete"!==e.readyState)return;const o="load"===n.type?t:e;o[a].bind(o)(c+n.type,u,!1),r||(r=!0,i.call(t,n.type))}}(this.window,this.document,t)))),this.loadedPromise}}var co,uo;!function(t){const e=["id","name","price","brand","category","variant","list","position"],i=["product_id","name","price","brand","category","variant","list","position"],r=["currencyCode"],n=["currency_code"],o=["id","name","brand","category","variant","price","quantity","coupon","position"],s=["product_id","name","brand","category","variant","price","quantity","coupon","position"],a=["id","affiliation","revenue","tax","shipping","coupon","list","step","option"],c=["transaction_id","affiliation","revenue","tax","shipping","coupon","list","step","option"],u=["id","name","creative","position"],h=["promo_id","name","creative","position"];function l(t,e,i,r=i){i.forEach(((i,n)=>{const o=r[n];e.hasOwnProperty(i)&&e[i]&&(t[o]=e[i])}))}function d(t,e){l(t,e,r,n)}function p(t,e){l(t,e,a,c)}t.Tracker=class{constructor(t,e){this.debug=t,this.eventTracker=e}trackEnhancedEcommerce(t,e="all"){kn(t)?("impressions"!==e&&"all"!==e||this.trackProductImpressions(t),"click"!==e&&"all"!==e||this.trackProductAction(t,"click","product_click"),"detail"!==e&&"all"!==e||this.trackProductAction(t,"detail","product_detail"),"add"!==e&&"all"!==e||this.trackProductAction(t,"add","product_add_to_cart"),"remove"!==e&&"all"!==e||this.trackProductAction(t,"remove","product_remove_from_cart"),"promoView"!==e&&"all"!==e||this.trackPromotionAction(t,"promoView","promo_impression"),"promoClick"!==e&&"all"!==e||this.trackPromotionAction(t,"promoClick","promo_click"),"checkout"!==e&&"all"!==e||this.trackCheckout(t),"checkout_option"!==e&&"all"!==e||this.trackCheckoutOption(t),"purchase"!==e&&"all"!==e||this.trackPurchase(t),"refund"!==e&&"all"!==e||this.trackRefund(t)):this.debug.error("Ecommerce parameter is not a plain object")}trackProductImpressions(t){t.impressions?t.impressions.forEach((r=>{const n={};d(n,t),l(n,r,e,i),this.trackEnhancedEcommerceEvent("product_impression",n)})):this.debug.warn("There are no impressions in the ecommerce object")}trackProductAction(t,e,i){var r;const n=t[e];if(!n)return void this.debug.debug(`${e} not found in the ecommerce object`);if(!n.products)return void this.debug.debug(`${e} in the ecommerce object does not have any products`);const a=null!==(r=n.actionField)&&void 0!==r?r:{};n.products.forEach((e=>{const r={};d(r,t),p(r,a),l(r,e,o,s),this.trackEnhancedEcommerceEvent(i,r)}))}trackPromotionAction(t,e,i){const r=t[e];r?r.promotions?r.promotions.forEach((e=>{const r={};d(r,t),l(r,e,u,h),this.trackEnhancedEcommerceEvent(i,r)})):this.debug.debug(`${e} in the ecommerce object does not have any promotions`):this.debug.debug(`${e} not found in the ecommerce object`)}trackCheckout(t){var e;if(!t.checkout)return void this.debug.debug("There is no checkout in the ecommerce object");this.trackProductAction(t,"checkout","product_checkout");const i=null!==(e=t.checkout.actionField)&&void 0!==e?e:{},r={};d(r,t),p(r,i),this.trackEnhancedEcommerceEvent("checkout",r)}trackCheckoutOption(t){var e;if(!t.checkout_option)return void this.debug.debug("There is no checkout option in the ecommerce object");const i=null!==(e=t.checkout_option.actionField)&&void 0!==e?e:{},r={};d(r,t),p(r,i),this.trackEnhancedEcommerceEvent("checkout_option",r)}trackPurchase(t){var e;if(!t.purchase)return void this.debug.debug("There is no purchase in the ecommerce object");this.trackProductAction(t,"purchase","product_purchase");const i=null!==(e=t.purchase.actionField)&&void 0!==e?e:{},r={};d(r,t),p(r,i),this.trackEnhancedEcommerceEvent("transaction",r)}trackRefund(t){var e;if(!t.refund)return void this.debug.debug("There is no refund in the ecommerce object");const i=null!==(e=t.refund.actionField)&&void 0!==e?e:{},r={};d(r,t),p(r,i),t.refund.products?(r.refund_type="partial",this.trackProductAction(t,"refund","product_refund")):r.refund_type="full",this.trackEnhancedEcommerceEvent("refund",r)}trackEnhancedEcommerceEvent(t,e){this.eventTracker.track(t,Object.assign({tracked_via:"eecommerce"},e))}}}(co||(co={}));class ho{constructor(t,e,i){this.debug=e,this.reporter=i,this.reportablePromise=t.then((t=>t)).catch((t=>Promise.reject(t)))}then(t){const e=this.reportablePromise.then((e=>{const i=Date.now();let r;try{r=t(e)}catch(t){throw this.debug.error(t),this.reporter.sendErrorReport(t,"promise",i),t}return r instanceof ho?r.reportablePromise:r}));return new ho(e,this.debug,this.reporter)}catch(t){const e=this.reportablePromise.catch((e=>{const i=Date.now();let r;try{r=t(e)}catch(t){throw this.debug.error(t),this.reporter.sendErrorReport(t,"promise",i),t}return r instanceof ho?r.reportablePromise:r}));return new ho(e,this.debug,this.reporter)}}class lo{constructor(t,e,i){this.debug=t,this._target="//sdk-tracing.exponea.com/webxp-trace/record/browser/v1",this.config=e,this.http=i}reportError(t,e){return this._reportError(t,e)}sendErrorReport(t,e,i=Date.now(),r={}){const n=this.serialize(t,e,i,r);this.debug.log("Sending error report",n),this._sendErrorReport(n).then((()=>{this.debug.log("Error report was successfully sent")})).catch((t=>{this.debug.error("Error while sending the error report",t)}))}serialize(t,i,r,n={}){let o;return o=t instanceof Error?t:new Error(String(t)),{id:Jr(32),instance_id:"OTU",sdk_version:e,company_id:this.config.getToken(),spans:[{id:Jr(16),start_time:r/1e3,duration:(Date.now()-r)/1e3,operation:i,error:{message:o.message,name:o.name,stack:o.stack||""},tags:Object.assign({url:location.href.split(/[?#]/)[0],host:location.hostname},n)}]}}reportPromiseError(t){return new ho(t,this.debug,this)}_reportError(t,e){const i=this;return function(){const r=Date.now();try{return t(...arguments)}catch(n){const o=e||t.name||"transientOperation";throw i.sendErrorReport(n,o,r),n}}}_sendErrorReport(t){return this.http.post(this._target,t,{responseType:"text",headers:{"Content-type":"application/json"},credentials:"omit"})}}class po{constructor(t,e,i,r,n,o,s){this.reporter=t,this.config=e,this.queue=i,this.debug=r,this.newExperiments=n,this.url=o,this.window=s}loadFlickeringExperimentsScript(t){if(this.newExperiments.areAlreadyApplied())return void this.debug.log("Not applying experiments with the SDK because new_experiments are enabled.");this.queue.enqueue({httpMethod:void 0,noBulk:!0,name:no.Internal,action:()=>{go(t,this.config)},prepareData:()=>{},processResponse:()=>{},processError:()=>{}});let e=!1;this.config.isSpaReloadingEnabled("experiments")&&this.url.onChange("onUrlChangeBeforeWebxpClient",(()=>{var t;(null===(t=this.window[_])||void 0===t?void 0:t.config)||(e=!0)})),t.promise.then((t=>{let i=!1;this.config.isSpaReloadingEnabled("experiments")&&(e&&t.reset&&(t.reset(),e=!1),this.url.onChange("onUrlChangeFilterAndApplyExperiments",(()=>{var e;if(i)return;const r=!(null===(e=this.window[u])||void 0===e?void 0:e.configuration),n=t!==this.window[_];if(r||n)return t.revert&&t.revert(),void(i=!0);t.reset&&t.reset("page_load")})))}))}}function go(t,e){const i=e.getOptions();i.customer.cookie||t.reject(new Error("Can't load flickering experiments - missing cookie."));const r=encodeURIComponent(window.location.href),n=function(t){let e;t.cookies&&t.cookies.expires&&("number"==typeof t.cookies.expires||mo(t.cookies.expires)?e=Qn(t.cookies.expires):t.cookies.expires.tracking&&("number"==typeof t.cookies.expires.tracking||mo(t.cookies.expires.tracking))&&(e=Qn(t.cookies.expires.tracking)));e&&e<new Date&&(e=void 0);return e}(i),o="webxpClient",s=e.getToken(),a=`${i.target}/webxp/script/${s}/${i.customer.cookie}/modifications.min.js?http-referer=${r}${n?"&cookie-expires="+Math.floor(n.getTime()/1e3):""}`;window[_]||(window[_]={}),window[_].skipExperiments=!0,window[_].legacyFlickeringMode=!0,window[o].sdk=window[u],window[o].sdkObjectName=u,window[o].sign=`${s}/${i.customer.cookie}`,window[o].path=i.target;const c=document.createElement("script");c.src=a,c.onload=()=>{var e;"function"==typeof(null===(e=window[_])||void 0===e?void 0:e.reset)?t.resolve(window[_]):t.reject("webxpClient.reset doesn't exist or not a function")},c.onerror=e=>t.reject(e);const h=document.getElementsByTagName("script")[0];h&&h.parentNode&&h.parentNode.insertBefore(c,h)}function mo(t){return"[object Date]"===Object.prototype.toString.call(t)}class fo{constructor(t,e,i,r,n,o,s,a){this.http=t,this.config=e,this.location=i,this.document=r,this.history=n,this.window=o,this.debug=s,this.storageUtils=a,this.urlParamsMatch=null,this.urlParamsMatchBase64=null}matchUrlWithParams(){this.urlParamsMatch=this.location.href.match("(#|\\?)?exponea-editor-params=((%7B|{).*(%7D|}))"),this.urlParamsMatchBase64=this.location.href.match("(?:#|\\?)?exponea-editor-params=([a-zA-Z0-9-_=]+)")}areEditorParamsInURL(){return!!this.urlParamsMatch||!!this.urlParamsMatchBase64}placeParamsFromURLToStorage(){let t="";if(this.urlParamsMatch&&(t=decodeURIComponent(this.urlParamsMatch[2])),this.urlParamsMatchBase64){const e=this.urlParamsMatchBase64[1].replace(/-/g,"+").replace(/_/g,"/");t=atob(e)}t&&(this.storageUtils.writeToStorage("sessionStorage",b,t)||this.debug.warn("The editor is not supported in this browser"))}removeParamsFromURL(){let t="";this.urlParamsMatch&&(t=this.urlParamsMatch[0]),this.urlParamsMatchBase64&&(t=this.urlParamsMatchBase64[0]),t&&(this.history&&this.history.replaceState?this.history.replaceState(null,this.document.title,this.location.href.replace(t,"")):this.location.href=this.location.href.replace(t,""))}shouldStartEditor(){return!!this.storageUtils.readStringFromStorage("sessionStorage",b)}bootstrapEditor(){return this.isEditorRunning()?(this.debug.log("The editor is already running"),Promise.resolve()):this.location.host.indexOf("localhost")>=0?(this.debug.log("Auto-launching of the editor is disabled in development environments"),Promise.resolve()):this._waitForPageToLoad().then((()=>{var t;this._insertEditorLoadingElement();const e=this._insertEditorIframe();let i=this.config.getOptions().target+v+(new Date).getTime(),r=`${this.config.getOptions().target}${w}`;try{const e=null!==(t=this.storageUtils.readStringFromStorage("sessionStorage",b))&&void 0!==t?t:"",n=JSON.parse(e);n.trackingTarget&&(i=`https:${n.trackingTarget}${v}${(new Date).getTime()}`,r=`https:${n.trackingTarget}${w}`)}catch(t){this.debug.warn("No or invalid editor params found in session storage")}return this.http.get(i,{responseType:"text"}).then((t=>t.body)).then((t=>{e?e.srcdoc=t.replace(/base\shref=".*"/,`base href="${r}"`):this.debug.error("The created iframe's content document is null! Is the iframe in the DOM?")})).catch((()=>this.http.get(this.config.getOptions().target+"/editor/version.txt?timestamp="+(new Date).getTime(),{responseType:"text"}).then((t=>{const i=t.body.trim();this.debug.log(`Fetching editor version ${i}`);const r=k.map((t=>`<script type="text/javascript" src="${this.config.getOptions().target+w+i+`/${t}.js`}"><\/script>`)).join();e?e.srcdoc=`<html><head><title>Exponea Web Optimization Editor</title><meta charset="utf-8"></head><body>${r}</body></html>`:this.debug.error("The created iframe's content document is null! Is the iframe in the DOM?")})).catch((t=>this.debug.error("Failed to fetch the editor version",t)))))}))}_waitForPageToLoad(){return new Promise((t=>{this.document.body?t():this.window.addEventListener("load",(()=>t()))}))}isEditorRunning(){return!!this.document.getElementById(y)}_insertEditorLoadingElement(){this.debug.log("Inserting experiments editor loading element");const t=this.document.createElement("style");t.textContent=".exponea-loading-backdrop{margin:0;padding:0;position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(87,91,154,.5);display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;z-index:2147483642}.exponea-loading-icon{width:50px;height:50px;border:4px solid #ffd500;border-right-color:transparent;border-radius:50%;-webkit-animation:rotate .8s infinite linear;animation:rotate .8s infinite linear}@-webkit-keyframes rotate{from{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes rotate{from{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}";const e=this.document.createElement("div");e.innerHTML='<div class="exponea-loading-backdrop"><div class="exponea-loading-icon"></div></div>',this.document.head.appendChild(t),e.childNodes.forEach((t=>this.document.body.appendChild(t)))}_insertEditorIframe(){const t=this.document.createElement("div"),e=this.document.createElement("iframe");return t.id=y,t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.right="0",t.style.bottom="0",t.style.border="none",t.style.width="auto",t.style.height="auto",t.style.margin="0",t.style.padding="0",t.style.backgroundColor="transparent",t.style.zIndex="2147483647",e.src="about:blank",e.frameBorder="0",e.style.left="0",e.style.top="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="transparent",e.style.margin="0",e.style.padding="0",e.style.display="block",e.style.visibility="visible",this.document.body.appendChild(t),t.appendChild(e),e}}function bo(t,e){return t&&Ct(t,"function"==typeof(i=e)?i:Pi);var i}!function(t){t.ewx_279_invalid_integration_monitor="ewx_279_invalid_integration_monitor"}(uo||(uo={}));const yo=Object.freeze({[uo.ewx_279_invalid_integration_monitor]:!1});class vo{constructor(t,e,i=yo,r="eyJleHA3MjhfcmVtb3ZlX3dlYnhwX2NvbmZpZ19mcm9tX2FzeW5jX2FwaSI6IHRydWUsICJld3hfMjc5X2ludmFsaWRfaW50ZWdyYXRpb25fbW9uaXRvciI6IHRydWV9Cg=="){this.debug=t,this.window=e;try{this.flagConfig=Object.freeze(Object.assign(Object.assign({},i),function(t,e,i,r){const n=t.match(/^%%%%.+%%%%$/)?"e30=":t,o=JSON.parse(r.atob(n)),s={};return bo(o,((t,r)=>{r in e?"boolean"==typeof t?s[r]=t:i.error(`Incorrect value '${t}' for feature flag '${r}', expected a boolean but received '${typeof t}'`):i.error(`Feature '${r}' is not a feature flag supported by this SDK version`)})),s}(r,i,this.debug,this.window)))}catch(t){this.debug.error("Failed to parse feature flags",t),this.flagConfig=Object.freeze(i)}this.debug.debug("Initialized feature flags",this.flags)}get flags(){return this.flagConfig}setFlags(t){this.flagConfig=Object.freeze(Object.assign(Object.assign({},this.flagConfig),t)),this.debug.debug("Overwritten feature flags",this.flags)}}class wo{constructor(t,e,i,r){this.config=t,this.debug=e,this.documentContentLoaded=i,this.queue=r}getHtml(t,e){this.queue.enqueue({name:ro.HtmlGet,noBulk:!0,prepareData:()=>(this.debug.log("Get html: ",t),{data:{company_id:this.config.getToken(),customer_ids:this.config.getOptions().customer,html_campaign_name:t}}),processResponse:t=>{Xn((()=>{e(t.data)}))}})}showHtml(t,e){this.getHtml(e,(e=>{""!==e&&this.documentContentLoaded.whenLoaded().then((()=>{const i=Fi(t);for(let t=0;t<i.length;t++)i[t].innerHTML=e}),(t=>{this.debug.error("Failed to show HTML",t)}))}))}}var ko;!function(t){t[t.Fetch=0]="Fetch"}(ko||(ko={}));class _o extends Error{constructor(t){super(),this.response=t}}class So{constructor(t=t){this.window=t,this.type=ko.Fetch,this.fetch=(t,e)=>this.window.fetch(t,e)}static isSupported(){if(!XMLHttpRequest)return!1;return"withCredentials"in new XMLHttpRequest}post(t,e,i){return this.fetch(t,Object.assign(Object.assign({},i),{headers:Object.assign({Accept:"application/json"},i.headers||{}),method:"POST",body:JSON.stringify(e),credentials:i.credentials?i.credentials:"include"})).then(To).then(Eo)}get(t,e){return this.fetch(t,{headers:Object.assign({Accept:"application/json"},e.headers||{}),method:"GET"}).then(To).then(Eo)}}function To(t){const{status:e}=t;return{json:function(){return i().then((t=>{try{return JSON.parse(t)}catch(e){return t}}))},text:i,status:e};function i(){return t.text()}}function Eo(t){if(t.status>=200&&t.status<300)return t;throw new _o(t)}class xo extends Error{constructor(t){super(t.message),this.name="HttpNetworkError"}}class Co extends Error{constructor(t){super(function(t){const{body:e}=t;if("string"==typeof e)return e;return JSON.stringify(e)}(t)),this.name="HttpServerError",this.response=t}}const Oo={responseType:"json"};class Ao{constructor(t){So.isSupported()&&(this.transport=new So(t))}hasTransport(){return void 0!==this.transport}get(t,e=Oo){if(e=Object.assign({},Oo,e),void 0===this.transport)throw new Error("Can't do a get request since no http transport is available!");return this.transport.get(t,e).catch(jo(e)).then(Po(e))}post(t,e,i=Oo){if(i=Object.assign({},Oo,i),void 0===this.transport)throw new Error("Can't do a post request since no http transport is available!");return this.transport.post(t,e,i).catch(jo(i)).then(Po(i))}}function Po(t){return function(e){return function(t,e){if("text"===t)return e.text();return e.json()}(t.responseType,e).then((t=>{const{status:i}=e;return{body:t,status:i}}))}}function jo(t){return function(e){return e instanceof _o?function(t,e){const i=Po(e);return i(t.response).then((t=>Promise.reject(new Co(t))))}(e,t):e instanceof TypeError?Promise.reject(new xo(e)):Promise.reject(e)}}var Lo,zo,Io;function Bo(t){return new Promise(((e,i)=>{t.execute({name:ro.WebOptimization,noBulk:!0,httpMethod:Lo.get,processResponse(t){e(t)},processError:t=>{i(t)}})}))}function Fo(t,e,i,r,n,o,s){Ro(t,"experiments")&&!t.getOptions().new_experiments&&s.finally((()=>{i.loadFlickeringExperimentsScript(o)})),Ro(t,"webLayers")&&e.processDefinition(n.webLayers,Io.personalized,n.vars),Ro(t,"tagManager")&&r.processDefinition(n.constantManagedTags)}function Ro(t,e){const i=t.getOptions();return!1!==i.webOptimization&&!(i.webOptimization&&!1===i.webOptimization[e])}function Do(t){let e,i;const r=new Promise(((t,r)=>{e=t,i=r}));return e&&i?(r.catch((e=>{t.debug("Handling promise rejection",e)})),{promise:r,resolve:e,reject:i}):(t.error("Error building promise remote: Promise executor has not been called synchronously"),{promise:Promise.reject(),resolve:()=>{},reject:()=>{}})}function Mo(t){const e=t[u];return e?e[f]?e[f]:e.start?"v2.0.0":"v1.0.0":"v0.0.0-unknown"}!function(t){t[t.post=0]="post",t[t.get=1]="get"}(Lo||(Lo={})),function(t){t.automatic="automatic",t.manual="manual"}(zo||(zo={})),function(t){t.personalized="personalized",t.nonPersonalized="nonPersonalized"}(Io||(Io={}));class Uo extends Error{constructor(t){super(t)}}class No{constructor(t,e,i,r,n,o,s,a,c,u,h,l,d,p,g,m,f,b,y,v,w,k,_,S,T,E,x,C=Bo,O=Fo){this.reporter=t,this.debug=e,this.config=i,this.time=r,this.cookies=n,this.ping=o,this.customer=s,this.userActivityTracking=a,this.experimentsEditor=c,this.experiments=u,this.webLayers=h,this.managedTags=l,this.campaignClicks=d,this.eventTracker=p,this.queryTracking=g,this.window=m,this.unloader=f,this.initializeState=b,this.queue=y,this.pushWebApi=v,this.pushSafariApi=w,this.transferIdentity=k,this.http=_,this.logger=S,this.newExperiments=T,this.featureFlags=E,this.browserExtension=x,this.getDefinitions=C,this.applyPersonalizationFn=O,this.webxpClientReadyRemote=Do(this.logger),this.initializeCookieLinked=Do(this.logger)}get isWebxpClientReady(){return this.webxpClientReadyRemote.promise}initialize(t){var e,i,n;if(!this.http.hasTransport())return void this.logger.warn(`${u} sdk won't be initialized because no supported HTTP transport method was found in this browser!`);if(this.initializeState.isInitializing())return void this.debug.log("The SDK is already being initialized");if(this.initializeState.isInitialized())return void this.debug.log("The SDK is already initialized");this.debug.log("Starting to initialize the SDK"),this.debug.log("Checking the cookie first"),this.debug.log("attempting to get cookie from browser");let o=this.cookies.getCookie(r);const s=this.window[_];if(s&&s.skipExperiments){if(!o&&(this.debug.log("The SDK does not have a cookie yet, communicating with webxp client to get one"),t&&!s.init)){if("boolean"==typeof t)throw new Uo("Invalid type of argument 0 - initialize, expected object but got boolean");return this.storedOptions=t,this.window.setTimeout(this.initialize.bind(this,!1),500),void this.debug.log("Initialization was postponed until the modifications script loads")}if(!t){if(!this.storedOptions)return;t=this.storedOptions}if(!o){if("boolean"==typeof t)throw new Uo("Invalid type of argument 0 - initialize, expected object but got boolean");if(s.config&&s.config.cookie){let r=this.config.getOptions().cookies.cross_subdomain;t&&t.cookies&&void 0!==t.cookies.cross_subdomain&&(r=t.cookies.cross_subdomain),this.config.extendOptions({cookies:{cross_subdomain:r},data_layer:t.data_layer}),o=s.config.cookie;!0===(null===(e=t.compliance)||void 0===e?void 0:e.opt_in)||!0===(null===(n=null===(i=t.compliance)||void 0===i?void 0:i.opt_in)||void 0===n?void 0:n.new_customer_profile)||this.cookies.setTrackingCookie(o)}}}if("boolean"==typeof t)throw new Uo("Invalid type of argument 0 - initialize, expected object but got boolean");if(this.debug.log('Webxp client communication handled, continuing with initialization - SDK is marked as "initializing" now'),!tn(t.token))throw new Uo("Invalid type of project token, expected string but got "+typeof t.token);if(""===t.token)throw new Uo("Invalid value of project token, the token cannot be an empty string");if(this.isComplianceConfigurationChanged(t))throw new Uo("It is disallowed to change `compliance` configuration during SDK initialization. Please set the `compliance` option in the snippet");this.errorReportInitialize(t,o)}extendOptions(t){"boolean"!=typeof t&&this.config.extendOptions({token:t.token,target:t.target,compliance:t.compliance,experimental:t.experimental,spa_reloading:t.spa_reloading})}errorReportInitialize(t,i){const r=Date.now();this.preProcessCustomerIds(t),this.config.extendOptions(t);const n=this.config.getOptions();try{this.initializeState.markInitializing(),this.browserExtension.initialize(),this.browserExtension.sendPayload({type:"versions",sdkVersion:e,snippetVersion:Mo(this.window)}),this.browserExtension.sendPayload({type:"config",config:t});(!0===n.compliance.opt_in||!0===n.compliance.opt_in.new_customer_profile)&&(i=this.cookies.setFreshTrackingCookie(),this.config.setNewCustomerIds({cookie:i}),this.browserExtension.sendPayload({type:"ids",ids:{cookie:i}})),this.cookies.sanitizeCookieOptions(),n.feature_flags&&this.featureFlags.setFlags(n.feature_flags),this.experimentsEditor.matchUrlWithParams(),this.experimentsEditor.areEditorParamsInURL()&&(this.experimentsEditor.placeParamsFromURLToStorage(),this.experimentsEditor.removeParamsFromURL()),this.time.queryTime(),this.pushWebApi.initialize(),i&&(this.config.extendOptions({customer:Object.assign(Object.assign({},n.customer),{cookie:i})}),this.debug.log("cookie retrieved from browser: "+i),Xn((()=>{en(n.cookies.retrieve_callback)&&(n.cookies.retrieve_callback(i),n.cookies.retrieve_callback=null)})));const r=n.transfer_identity?this.transferIdentity.getTransferIdentityFirstClickToken():void 0;if(this.customer.requestCustomerIdsFromServer({cookie:i,tifc:r},(t=>{this.browserExtension.sendPayload({type:"ids",ids:t}),i||Xn((()=>{en(n.cookies.retrieve_callback)&&(n.cookies.retrieve_callback(t.cookie),n.cookies.retrieve_callback=null)})),r&&n.link_cookie&&Xn((()=>{this.executeLinkCookies(n.link_cookie)}))})),n.transfer_identity&&(this.debug.log("transferring identity from URL"),this.config.extendOptions({customer:Object.assign(Object.assign({},n.customer),this.transferIdentity.getCustomerIdentityFromUrl())})),this.experimentsEditor.shouldStartEditor())return this.config.getOptions().new_experiments||go(this.webxpClientReadyRemote,this.config),void this.experimentsEditor.bootstrapEditor();n.track&&n.track.google_analytics&&this.customer.identifyCustomerWithGoogleAnalyticsId(),this.userActivityTracking.trackExitsWithDataAttribute(),this.campaignClicks.parseUrlAndTrackCampaignClick(),n.ping&&(n.ping.enabled||n.lazy_merge)||this.customer.identifyCustomer(n.customer),!r&&n.link_cookie&&Xn((()=>{this.executeLinkCookies(n.link_cookie)})),n.link_cookie||Xn((()=>{this.executeLinkCookies(n.link_cookie)})),this.ping.setOptions(this.config.getOptions().ping),this.ping.restartPinging(),this.userActivityTracking.startActivityTracking(),this.eventTracker.trackPageVisitEventIfEnabled(),this.queryTracking.initialize(),this.reporter.reportPromiseError(this.getDefinitions(this.queue)).then((t=>{this.applyPersonalizationFn(this.config,this.webLayers,this.experiments,this.managedTags,t,this.webxpClientReadyRemote,this.initializeCookieLinked.promise)})),Ro(this.config,"experiments")&&this.newExperiments.initialize(),Ro(this.config,"tagManager")&&this.managedTags.queryNonConstantManagedTagsAndShowOnUrlChange(),this.unloader.initialize(),this.pushSafariApi.handleDeniedSubscription(),this.ping.initializeWebUnloadTracking(),this.debug.log('The SDK initialization is finished, SDK is marked as "initialized" now'),this.initializeState.markInitialized()}catch(t){if(this.queue.clear(),this.initializeState.markFailedInitialization(),t instanceof Uo)throw t;this.debug.error(t),this.reporter.sendErrorReport(t,"initialize",r)}}preProcessCustomerIds(t){"number"!=typeof t.customer&&"string"!=typeof t.customer||(t.customer={registered:t.customer}),t.customer&&("cookie"in t.customer&&delete t.customer.cookie,t.customer=this.customer.filterEmptyCustomerIds(t.customer),this.config.extendOptions(t))}isComplianceConfigurationChanged(t){const e=t.compliance;if(void 0===e)return!1;const i=this.config.getOptions().compliance;return!Xe(e,i)}executeLinkCookies(t){let e=()=>{},i=()=>{};"object"==typeof t&&en(t.link_cookie_initialize_success)&&(e=t.link_cookie_initialize_success,en(t.link_cookie_initialize_error)&&(i=t.link_cookie_initialize_error)),this.customer.linkCustomerIds(((...t)=>{e(...t),this.initializeCookieLinked.resolve(!0)}),((...t)=>{i(...t),this.initializeCookieLinked.reject()}))}}class Wo{constructor(){this.initializing=!1,this.initialized=!1,this.initializedPromiseResolve=()=>{},this.initializedPromiseReject=()=>{},this.initializedPromise=new Promise(((t,e)=>{this.initializedPromiseResolve=t,this.initializedPromiseReject=e}))}markInitializing(){this.initializing=!0,this.initialized=!1}markInitialized(){this.initializing=!1,this.initialized=!0,this.initializedPromiseResolve()}markFailedInitialization(){this.initializing=!1,this.initialized=!1,this.initializedPromiseReject()}isInitializing(){return this.initializing}isInitialized(){return this.initialized}whenInitialized(){return this.initializedPromise}}const qo="sendBeacon"in navigator;var $o;!function(t){t[t.Ready=0]="Ready",t[t.Sending=1]="Sending",t[t.Sent=2]="Sent"}($o||($o={}));class Ho{constructor(t,e,i,r,n=qo){this.reporter=t,this.debug=e,this.eventTracker=i,this.eventTypeAndPropertiesGetter=r,this.isSendBeaconSupported=n,this.EVENT_TRIGGERED_DEADLINE=300,this.phase=$o.Ready,this.lockedUntil=0,this.timeoutID=void 0}trackClick(t){const e=t.target,i=this.eventTypeAndPropertiesGetter(e);this.isSendBeaconSupported?this._trackClickWithBeacon(i):(this.phase===$o.Ready&&(t.preventDefault(),t.stopImmediatePropagation()),this._trackClickWithoutBeacon(e,i))}_trackClickWithBeacon({type:t,properties:e}){this.eventTracker.track(t,e)}_trackClickWithoutBeacon(t,{type:e,properties:i}){if(this.phase===$o.Ready){const r=this.reporter.reportError((()=>{t.click()}),"click");if((new Date).getTime()<this.lockedUntil)return void this.debug.log("Ignoring apparent duplicate click");this.phase=$o.Sending,this.timeoutID=setTimeout((()=>{this.debug.log("Click timed out"),this.phase===$o.Sending&&r()}),this.EVENT_TRIGGERED_DEADLINE),this.eventTracker.track(e,i,{successCallback:()=>{this.debug.log("Click tracked successfully"),clearTimeout(this.timeoutID),delete this.timeoutID,this.phase=$o.Sent,r()},errorCallback:()=>{this.debug.error("Cannot connect to server."),clearTimeout(this.timeoutID),delete this.timeoutID,this.phase=$o.Sent,r()}})}else this.phase===$o.Sending?(clearTimeout(this.timeoutID),delete this.timeoutID,this.phase=$o.Ready,this.lockedUntil=(new Date).getTime()+500):this.phase===$o.Sent&&(this.phase=$o.Ready,this.lockedUntil=(new Date).getTime()+500)}}class Vo{constructor(t,e,i,r){this.reporter=t,this.eventTracker=e,this.debug=i,this.documentContentLoaded=r}trackLink(t,e,i){const r=new Ho(this.reporter,this.debug,this.eventTracker,(t=>{if(en(e)){return e(t)}return{type:e,properties:i||{}}}));tn(t)?this.reporter.reportPromiseError(this.documentContentLoaded.whenLoaded()).then((()=>{const e=Fi(t);for(let t=0;t<e.length;t++)e[t].onclick=t=>r.trackClick(t)})):t.onclick=t=>r.trackClick(t)}}class Go{constructor(t,e){this.reporter=t,this.document=e,this._liveEventListeners={click:[],submit:[]}}initialize(){this._registerLiveEventListener("submit"),this._registerLiveEventListener("click")}_handleLiveEventListeners(t,e){t.forEach((t=>{try{e.matches(t.selector)&&t.callback(e)}catch(t){if(!(t instanceof Error))throw t}}))}addLiveEventListener(t,e,i){this._liveEventListeners[t].push({selector:e,callback:i})}clearLiveEventListeners(){this._liveEventListeners={click:[],submit:[]}}_registerLiveEventListener(t){this.document.addEventListener(t,(e=>this._handleLiveEventListeners(this._liveEventListeners[t],e.target)))}}Di([Yn(),Mi("design:type",Function),Mi("design:paramtypes",[]),Mi("design:returntype",void 0)],Go.prototype,"initialize",null),Di([Yn(),Mi("design:type",Function),Mi("design:paramtypes",[Array,Element]),Mi("design:returntype",void 0)],Go.prototype,"_handleLiveEventListeners",null);class Ko{constructor(t,e){this.console=t,this.logPrefix=e}getMessagePrefix(){const t=(new Date).toUTCString();return`${this.logPrefix} [${t}]`}error(...t){this.print("error",t)}log(...t){this.print("log",t)}warn(...t){this.print("warn",t)}debug(...t){this.print("debug",t)}print(t,e){this.isConsoleSupported(t)&&0!==e.length&&("string"==typeof e[0]?e[0]=`${this.getMessagePrefix()} ${e[0]}`:e.unshift(this.getMessagePrefix()),this.console[t](...e))}isConsoleSupported(t){return void 0!==this.console&&"function"==typeof this.console[t]}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function Qo(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Jo={exports:{}};
/**
     * @file postscribe
     * @description Asynchronously write javascript, even with document.write.
     * @version v2.0.8
     * @see {@link https://krux.github.io/postscribe}
     * @license MIT
     * @author Derek Brans
     * @copyright 2016 Krux Digital, Inc
     */!function(t,e){var i;i=function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={exports:{},id:r,loaded:!1};return t[r].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}return i.m=t,i.c=e,i.p="",i(0)}([function(t,e,i){var r,n=i(1),o=(r=n)&&r.__esModule?r:{default:r};t.exports=o.default},function(t,e,i){e.__esModule=!0;var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t};e.default=m;var n,o=i(2),s=(n=o)&&n.__esModule?n:{default:n},a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(4));function c(){}var u={afterAsync:c,afterDequeue:c,afterStreamStart:c,afterWrite:c,autoFix:!0,beforeEnqueue:c,beforeWriteToken:function(t){return t},beforeWrite:function(t){return t},done:c,error:function(t){throw new Error(t.msg)},releaseAsync:!1},h=0,l=[],d=null;function p(){var t=l.shift();if(t){var e=a.last(t);e.afterDequeue(),t.stream=g.apply(void 0,t),e.afterStreamStart()}}function g(t,e,i){(d=new s.default(t,i)).id=h++,d.name=i.name||d.id,m.streams[d.name]=d;var n=t.ownerDocument,o={close:n.close,open:n.open,write:n.write,writeln:n.writeln};function a(t){t=i.beforeWrite(t),d.write(t),i.afterWrite(t)}r(n,{close:c,open:c,write:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return a(e.join(""))},writeln:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return a(e.join("")+"\n")}});var u=d.win.onerror||c;return d.win.onerror=function(t,e,r){i.error({msg:t+" - "+e+": "+r}),u.apply(d.win,[t,e,r])},d.write(e,(function(){r(n,o),d.win.onerror=u,i.done(),d=null,p()})),d}function m(t,e,i){if(a.isFunction(i))i={done:i};else if("clear"===i)return l=[],d=null,void(h=0);i=a.defaults(i,u);var r=[t=/^#/.test(t)?window.document.getElementById(t.substr(1)):t.jquery?t[0]:t,e,i];return t.postscribe={cancel:function(){r.stream?r.stream.abort():r[1]=c}},i.beforeEnqueue(r),l.push(r),d||p(),t.postscribe}r(m,{streams:{},queue:l,WriteStream:s.default})},function(t,e,i){e.__esModule=!0;var r,n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},o=i(3),s=(r=o)&&r.__esModule?r:{default:r},a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(4)),c="data-ps-",u="ps-style",h="ps-script";function l(t,e){var i=c+e,r=t.getAttribute(i);return a.existy(r)?String(r):r}function d(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=c+e;a.existy(i)&&""!==i?t.setAttribute(r,i):t.removeAttribute(r)}var p=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.root=e,this.options=i,this.doc=e.ownerDocument,this.win=this.doc.defaultView||this.doc.parentWindow,this.parser=new s.default("",{autoFix:i.autoFix}),this.actuals=[e],this.proxyHistory="",this.proxyRoot=this.doc.createElement(e.nodeName),this.scriptStack=[],this.writeQueue=[],d(this.proxyRoot,"proxyof",0)}return t.prototype.write=function(){var t;for((t=this.writeQueue).push.apply(t,arguments);!this.deferredRemote&&this.writeQueue.length;){var e=this.writeQueue.shift();a.isFunction(e)?this._callFunction(e):this._writeImpl(e)}},t.prototype._callFunction=function(t){var e={type:"function",value:t.name||t.toString()};this._onScriptStart(e),t.call(this.win,this.doc),this._onScriptDone(e)},t.prototype._writeImpl=function(t){this.parser.append(t);for(var e=void 0,i=void 0,r=void 0,n=[];(e=this.parser.readToken())&&!(i=a.isScript(e))&&!(r=a.isStyle(e));)(e=this.options.beforeWriteToken(e))&&n.push(e);n.length>0&&this._writeStaticTokens(n),i&&this._handleScriptToken(e),r&&this._handleStyleToken(e)},t.prototype._writeStaticTokens=function(t){var e=this._buildChunk(t);return e.actual?(e.html=this.proxyHistory+e.actual,this.proxyHistory+=e.proxy,this.proxyRoot.innerHTML=e.html,this._walkChunk(),e):null},t.prototype._buildChunk=function(t){for(var e=this.actuals.length,i=[],r=[],n=[],o=t.length,s=0;s<o;s++){var a=t[s],l=a.toString();if(i.push(l),a.attrs){if(!/^noscript$/i.test(a.tagName)){var d=e++;r.push(l.replace(/(\/?>)/," "+c+"id="+d+" $1")),a.attrs.id!==h&&a.attrs.id!==u&&n.push("atomicTag"===a.type?"":"<"+a.tagName+" "+c+"proxyof="+d+(a.unary?" />":">"))}}else r.push(l),n.push("endTag"===a.type?l:"")}return{tokens:t,raw:i.join(""),actual:r.join(""),proxy:n.join("")}},t.prototype._walkChunk=function(){for(var t=void 0,e=[this.proxyRoot];a.existy(t=e.shift());){var i=1===t.nodeType;if(!i||!l(t,"proxyof")){i&&(this.actuals[l(t,"id")]=t,d(t,"id"));var r=t.parentNode&&l(t.parentNode,"proxyof");r&&this.actuals[r].appendChild(t)}e.unshift.apply(e,a.toArray(t.childNodes))}},t.prototype._handleScriptToken=function(t){var e=this,i=this.parser.clear();i&&this.writeQueue.unshift(i),t.src=t.attrs.src||t.attrs.SRC,(t=this.options.beforeWriteToken(t))&&(t.src&&this.scriptStack.length?this.deferredRemote=t:this._onScriptStart(t),this._writeScriptToken(t,(function(){e._onScriptDone(t)})))},t.prototype._handleStyleToken=function(t){var e=this.parser.clear();e&&this.writeQueue.unshift(e),t.type=t.attrs.type||t.attrs.TYPE||"text/css",(t=this.options.beforeWriteToken(t))&&this._writeStyleToken(t),e&&this.write()},t.prototype._writeStyleToken=function(t){var e=this._buildStyle(t);this._insertCursor(e,u),t.content&&(e.styleSheet&&!e.sheet?e.styleSheet.cssText=t.content:e.appendChild(this.doc.createTextNode(t.content)))},t.prototype._buildStyle=function(t){var e=this.doc.createElement(t.tagName);return e.setAttribute("type",t.type),a.eachKey(t.attrs,(function(t,i){e.setAttribute(t,i)})),e},t.prototype._insertCursor=function(t,e){this._writeImpl('<span id="'+e+'"/>');var i=this.doc.getElementById(e);i&&i.parentNode.replaceChild(t,i)},t.prototype._onScriptStart=function(t){t.outerWrites=this.writeQueue,this.writeQueue=[],this.scriptStack.unshift(t)},t.prototype._onScriptDone=function(t){t===this.scriptStack[0]?(this.scriptStack.shift(),this.write.apply(this,t.outerWrites),!this.scriptStack.length&&this.deferredRemote&&(this._onScriptStart(this.deferredRemote),this.deferredRemote=null)):this.options.error({msg:"Bad script nesting or script finished twice"})},t.prototype._writeScriptToken=function(t,e){var i=this._buildScript(t),r=this._shouldRelease(i),n=this.options.afterAsync;t.src&&(i.src=t.src,this._scriptLoadHandler(i,r?n:function(){e(),n()}));try{this._insertCursor(i,h),i.src&&!r||e()}catch(t){this.options.error(t),e()}},t.prototype._buildScript=function(t){var e=this.doc.createElement(t.tagName);return a.eachKey(t.attrs,(function(t,i){e.setAttribute(t,i)})),t.content&&(e.text=t.content),e},t.prototype._scriptLoadHandler=function(t,e){function i(){t=t.onload=t.onreadystatechange=t.onerror=null}var r=this.options.error;function o(){i(),null!=e&&e(),e=null}function s(t){i(),r(t),null!=e&&e(),e=null}function a(t,e){var i=t["on"+e];null!=i&&(t["_on"+e]=i)}a(t,"load"),a(t,"error"),n(t,{onload:function(){if(t._onload)try{t._onload.apply(this,Array.prototype.slice.call(arguments,0))}catch(e){s({msg:"onload handler failed "+e+" @ "+t.src})}o()},onerror:function(){if(t._onerror)try{t._onerror.apply(this,Array.prototype.slice.call(arguments,0))}catch(e){return void s({msg:"onerror handler failed "+e+" @ "+t.src})}s({msg:"remote script failed "+t.src})},onreadystatechange:function(){/^(loaded|complete)$/.test(t.readyState)&&o()}})},t.prototype._shouldRelease=function(t){return!/^script$/i.test(t.nodeName)||!!(this.options.releaseAsync&&t.src&&t.hasAttribute("async"))},t}();e.default=p},function(t,e,i){
/**
    		 * @file prescribe
    		 * @description Tiny, forgiving HTML parser
    		 * @version vundefined
    		 * @see {@link https://github.com/krux/prescribe/}
    		 * @license MIT
    		 * @author Derek Brans
    		 * @copyright 2016 Krux Digital, Inc
    		 */
var r;r=function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={exports:{},id:r,loaded:!1};return t[r].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}return i.m=t,i.c=e,i.p="",i(0)}([function(t,e,i){var r,n=i(1),o=(r=n)&&r.__esModule?r:{default:r};t.exports=o.default},function(t,e,i){e.__esModule=!0;var r,n=u(i(2)),o=u(i(3)),s=i(6),a=(r=s)&&r.__esModule?r:{default:r},c=i(5);function u(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}var h={comment:/^<!--/,endTag:/^<\//,atomicTag:/^<\s*(script|style|noscript|iframe|textarea)[\s\/>]/i,startTag:/^</,chars:/^[^<]/},l=function(){function t(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.stream=i;var o=!1,s={};for(var c in n)n.hasOwnProperty(c)&&(r.autoFix&&(s[c+"Fix"]=!0),o=o||s[c+"Fix"]);o?(this._readToken=(0,a.default)(this,s,(function(){return e._readTokenImpl()})),this._peekToken=(0,a.default)(this,s,(function(){return e._peekTokenImpl()}))):(this._readToken=this._readTokenImpl,this._peekToken=this._peekTokenImpl)}return t.prototype.append=function(t){this.stream+=t},t.prototype.prepend=function(t){this.stream=t+this.stream},t.prototype._readTokenImpl=function(){var t=this._peekTokenImpl();if(t)return this.stream=this.stream.slice(t.length),t},t.prototype._peekTokenImpl=function(){for(var t in h)if(h.hasOwnProperty(t)&&h[t].test(this.stream)){var e=o[t](this.stream);if(e)return"startTag"===e.type&&/script|style/i.test(e.tagName)?null:(e.text=this.stream.substr(0,e.length),e)}},t.prototype.peekToken=function(){return this._peekToken()},t.prototype.readToken=function(){return this._readToken()},t.prototype.readTokens=function(t){for(var e=void 0;e=this.readToken();)if(t[e.type]&&!1===t[e.type](e))return},t.prototype.clear=function(){var t=this.stream;return this.stream="",t},t.prototype.rest=function(){return this.stream},t}();for(var d in e.default=l,l.tokenToString=function(t){return t.toString()},l.escapeAttributes=function(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[i]=(0,c.escapeQuotes)(t[i],null));return e},l.supports=n,n)n.hasOwnProperty(d)&&(l.browserHasFlaw=l.browserHasFlaw||!n[d]&&d)},function(t,e){e.__esModule=!0;var i=!1,r=!1,n=window.document.createElement("div");try{var o="<P><I></P></I>";n.innerHTML=o,e.tagSoup=i=n.innerHTML!==o}catch(t){e.tagSoup=i=!1}try{n.innerHTML="<P><i><P></P></i></P>",e.selfClose=r=2===n.childNodes.length}catch(t){e.selfClose=r=!1}n=null,e.tagSoup=i,e.selfClose=r},function(t,e,i){e.__esModule=!0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.comment=function(t){var e=t.indexOf("--\x3e");if(e>=0)return new n.CommentToken(t.substr(4,e-1),e+3)},e.chars=function(t){var e=t.indexOf("<");return new n.CharsToken(e>=0?e:t.length)},e.startTag=s,e.atomicTag=function(t){var e=s(t);if(e){var i=t.slice(e.length);if(i.match(new RegExp("</\\s*"+e.tagName+"\\s*>","i"))){var r=i.match(new RegExp("([\\s\\S]*?)</\\s*"+e.tagName+"\\s*>","i"));if(r)return new n.AtomicTagToken(e.tagName,r[0].length+e.length,e.attrs,e.booleanAttrs,r[1])}}},e.endTag=function(t){var e=t.match(o.endTag);if(e)return new n.EndTagToken(e[1],e[0].length)};var n=i(4),o={startTag:/^<([\-A-Za-z0-9_]+)((?:\s+[\w\-]+(?:\s*=?\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,endTag:/^<\/([\-A-Za-z0-9_]+)[^>]*>/,attr:/(?:([\-A-Za-z0-9_]+)\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))|(?:([\-A-Za-z0-9_]+)(\s|$)+)/g,fillAttr:/^(checked|compact|declare|defer|disabled|ismap|multiple|nohref|noresize|noshade|nowrap|readonly|selected)$/i};function s(t){var e,i,s;if(-1!==t.indexOf(">")){var a=t.match(o.startTag);if(a){var c=(e={},i={},s=a[2],a[2].replace(o.attr,(function(t,r){arguments[2]||arguments[3]||arguments[4]||arguments[5]?arguments[5]?(e[arguments[5]]="",i[arguments[5]]=!0):e[r]=arguments[2]||arguments[3]||arguments[4]||o.fillAttr.test(r)&&r||"":e[r]="",s=s.replace(t,"")})),{v:new n.StartTagToken(a[1],a[0].length,e,i,!!a[3],s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""))});if("object"===(void 0===c?"undefined":r(c)))return c.v}}}},function(t,e,i){e.__esModule=!0,e.EndTagToken=e.AtomicTagToken=e.StartTagToken=e.TagToken=e.CharsToken=e.CommentToken=e.Token=void 0;var r=i(5);function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.Token=function t(e,i){n(this,t),this.type=e,this.length=i,this.text=""},e.CommentToken=function(){function t(e,i){n(this,t),this.type="comment",this.length=i||(e?e.length:0),this.text="",this.content=e}return t.prototype.toString=function(){return"\x3c!--"+this.content},t}(),e.CharsToken=function(){function t(e){n(this,t),this.type="chars",this.length=e,this.text=""}return t.prototype.toString=function(){return this.text},t}();var o=e.TagToken=function(){function t(e,i,r,o,s){n(this,t),this.type=e,this.length=r,this.text="",this.tagName=i,this.attrs=o,this.booleanAttrs=s,this.unary=!1,this.html5Unary=!1}return t.formatTag=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i="<"+t.tagName;for(var n in t.attrs)if(t.attrs.hasOwnProperty(n)){i+=" "+n;var o=t.attrs[n];void 0!==t.booleanAttrs&&void 0!==t.booleanAttrs[n]||(i+='="'+(0,r.escapeQuotes)(o)+'"')}return t.rest&&(i+=" "+t.rest),t.unary&&!t.html5Unary?i+="/>":i+=">",null!=e&&(i+=e+"</"+t.tagName+">"),i},t}();e.StartTagToken=function(){function t(e,i,r,o,s,a){n(this,t),this.type="startTag",this.length=i,this.text="",this.tagName=e,this.attrs=r,this.booleanAttrs=o,this.html5Unary=!1,this.unary=s,this.rest=a}return t.prototype.toString=function(){return o.formatTag(this)},t}(),e.AtomicTagToken=function(){function t(e,i,r,o,s){n(this,t),this.type="atomicTag",this.length=i,this.text="",this.tagName=e,this.attrs=r,this.booleanAttrs=o,this.unary=!1,this.html5Unary=!1,this.content=s}return t.prototype.toString=function(){return o.formatTag(this,this.content)},t}(),e.EndTagToken=function(){function t(e,i){n(this,t),this.type="endTag",this.length=i,this.text="",this.tagName=e}return t.prototype.toString=function(){return"</"+this.tagName+">"},t}()},function(t,e){e.__esModule=!0,e.escapeQuotes=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t?t.replace(/([^"]*)"/g,(function(t,e){return/\\/.test(e)?e+'"':e+'\\"'})):e}},function(t,e){e.__esModule=!0,e.default=function(t,e,i){var s=function(){var t=[];return t.last=function(){return this[this.length-1]},t.lastTagNameEq=function(t){var e=this.last();return e&&e.tagName&&e.tagName.toUpperCase()===t.toUpperCase()},t.containsTagName=function(t){for(var e,i=0;e=this[i];i++)if(e.tagName===t)return!0;return!1},t}(),a={startTag:function(i){var n=i.tagName;"TR"===n.toUpperCase()&&s.lastTagNameEq("TABLE")?(t.prepend("<TBODY>"),c()):e.selfCloseFix&&r.test(n)&&s.containsTagName(n)?s.lastTagNameEq(n)?o(t,s):(t.prepend("</"+i.tagName+">"),c()):i.unary||s.push(i)},endTag:function(r){s.last()?e.tagSoupFix&&!s.lastTagNameEq(r.tagName)?o(t,s):s.pop():e.tagSoupFix&&(i(),c())}};function c(){var e=function(t,e){var i=t.stream,r=n(e());return t.stream=i,r}(t,i);e&&a[e.type]&&a[e.type](e)}return function(){return c(),n(i())}};var i=/^(AREA|BASE|BASEFONT|BR|COL|FRAME|HR|IMG|INPUT|ISINDEX|LINK|META|PARAM|EMBED)$/i,r=/^(COLGROUP|DD|DT|LI|OPTIONS|P|TD|TFOOT|TH|THEAD|TR)$/i;function n(t){return t&&"startTag"===t.type&&(t.unary=i.test(t.tagName)||t.unary,t.html5Unary=!/\/>$/.test(t.text)),t}function o(t,e){var i=e.pop();t.prepend("</"+i.tagName+">")}}])},t.exports=r()},function(t,e){e.__esModule=!0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function r(t){return null!=t}function n(t,e,i){var r=void 0,n=t&&t.length||0;for(r=0;r<n;r++)e.call(i,t[r],r)}function o(t,e,i){for(var r in t)t.hasOwnProperty(r)&&e.call(i,r,t[r])}function s(t,e){return!(!t||"startTag"!==t.type&&"atomicTag"!==t.type||!("tagName"in t)||!~t.tagName.toLowerCase().indexOf(e))}e.existy=r,e.isFunction=function(t){return"function"==typeof t},e.each=n,e.eachKey=o,e.defaults=function(t,e){return t=t||{},o(e,(function(e,i){r(t[e])||(t[e]=i)})),t},e.toArray=function(t){try{return Array.prototype.slice.call(t)}catch(o){var e=(r=[],n(t,(function(t){r.push(t)})),{v:r});if("object"===(void 0===e?"undefined":i(e)))return e.v}var r},e.last=function(t){return t[t.length-1]},e.isTag=s,e.isScript=function(t){return s(t,"script")},e.isStyle=function(t){return s(t,"style")}}])},t.exports=i()}(Jo);var Zo,Xo=Qo(Jo.exports);class Yo{static matches(t,e){if("page"in e)return this.matchesURLFilter(t,e.page);if(e.exclude_pages)for(const i of e.exclude_pages)if(this.matchesURLFilter(t,i))return!1;if(e.include_pages)for(const i of e.include_pages)if(this.matchesURLFilter(t,i))return!0;return!1}static parseURL(t){const e={source:t};let i;const r=/^(.{1,5}?):\/\//;(i=r.exec(t))&&(e.protocol=i[1],t=t.replace(r,"")),t.startsWith("//")&&(t=t.substr(2));const n=/(.*?)(\/|$)/;if(i=n.exec(t)){const r=i[1].split(":");""!==r[0]&&(e.host=r[0]),r.length>1&&(e.port=r[1]),t=t.replace(n,"/")}const o=/(.*?)(\?|$|#)/;(i=o.exec(t))&&(e.path=i[1],t=t.replace(o,i[2]));const s=/^\?(.*?)($|#)/;(i=s.exec(t))&&(e.query=i[1],t=t.replace(s,i[2]));if((i=/^#(.*)/.exec(t))&&(e.hash=i[1]),e.withoutHost=e.path,e.query&&(e.withoutHost+=`?${e.query}`),e.hash&&(e.withoutHost+=`#${e.hash}`),e.host){const t=e.port?`:${e.port}`:"";e.withoutProtocol=`//${e.host}${t}${e.withoutHost}`}return e}static escapeRegex(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}static wildcardToRegex(t){const e=("^"+this.escapeRegex(t)+"$").replace(new RegExp("\\\\\\*","g"),".*");return new RegExp(e)}static matchesExactURL(t,e){const i=this.parseURL(t),r=this.parseURL(e);return!(r.host||!r.withoutHost||!i.withoutHost||!i.withoutHost.match(this.wildcardToRegex(r.withoutHost)))||(!(r.protocol||!r.withoutProtocol||!i.withoutProtocol||!i.withoutProtocol.match(this.wildcardToRegex(r.withoutProtocol)))||!!i.source.match(this.wildcardToRegex(r.source)))}static matchesContainsURL(t,e){return t.includes(e)}static matchesRegexURL(t,e){try{const i=new RegExp(e);if(t.match(i))return!0;const r=this.parseURL(t);return!(!r.withoutProtocol||!r.withoutProtocol.match(i))||!(!r.withoutHost||!r.withoutHost.match(i))}catch(t){if(t instanceof Error)return!1;throw t}}static matchesURLFilter(t,e){return"any"===e.type||("exact"===e.type?this.matchesExactURL(t,e.url):"contains"===e.type?this.matchesContainsURL(t,e.url):"regex"===e.type&&this.matchesRegexURL(t,e.regex))}}function ts(t,e){return(i,r)=>function(t,e,i,r){return n=>{const o=r(n);return o||e.log(function(t,e,i){return`${t}${i?" "+i:""} was filtered out by ${e} filter`}(t,i,"_id"in n?n._id:void 0),n),o}}(t,e,i,r)}!function(t){t.WebLayer="Weblayer",t.Experiment="Experiment",t.ManagedTag="Managed tag"}(Zo||(Zo={}));class es{constructor(t,e,i,r,n,o,s,a){this.reporter=t,this.config=e,this.queue=i,this.location=r,this.document=n,this.debug=o,this.url=s,this.documentContentLoaded=a}queryNonConstantManagedTagsAndShowOnUrlChange(){this.queryNonConstantManagedTagsAndShow(!0),this.config.isSpaReloadingEnabled("tags")&&this.url.onChange("onUrlChangeQueryNonConstantManagedTagsAndShow",(()=>{this.queryNonConstantManagedTagsAndShow(!1)}))}showManagedTag(t){return Ui(this,0,void 0,(function*(){yield this.documentContentLoaded.whenLoaded(),this.debug.log("Showing managed tag...",t);const e="definition"in t?t.definition:t.parametrized_definition;if("js"===t.type){let t;try{t=new Function(e)}catch(t){return this.debug.error("Syntax error in the managed tag javascript code.\n\nThis is not an SDK error but rather an error in a managed tag javascript code.\nCheck managed tags javascript code for syntax errors, such errors are usually\nhighlighted in the UI. The first line of the stack trace below should give you\na clue.\n\n",t)}try{t()}catch(t){this.debug.error("Error when executing the managed tag javascript code.\n\nThis is not an SDK error but rather an error in a managed tag javascript code.\nCheck managed tags javascript code for errors. This is not a syntax error and\nmay be hard to spot, but the first line of the stack trace below should give\nyou a clue.\n\n",t)}}else if("html"===t.type)try{Xo(this.document.body,e)}catch(t){this.debug.error("Error when applying an html managed tag.\n\nThere was an error when applying the html managed tag using\nPostscribe (https://github.com/krux/postscribe/).\n\n",t)}else this.debug.error(`Unknown managed tag type "${t.type}". The type\nmay only be "html" or "js".`)}))}processDefinition(t){this.debug.log("Processing managed tags...",t),this.removeOverlayAndShowManagedTags(t,!0),this.config.isSpaReloadingEnabled("tags")&&this.url.onChange("onUrlChangeRemoveOverlayAndShowManagedTags",(()=>{this.removeOverlayAndShowManagedTags(t,!1)}))}removeOverlayAndShowManagedTags(t,e){if(e){const e=this.document.getElementById("__exponea__overlay__"),i=!e&&this.config.getOptions().modify.overlay&&!!window[u].__;this.filterAndShowManagedTags(t,i),e&&e.parentElement&&e.parentElement.removeChild(e)}else this.filterAndShowManagedTags(t,!1)}queryNonConstantManagedTagsAndShow(t){let e=qn(this.config.getOptions().customer);this.queue.enqueue({name:ro.ManagedTagsShow,noBulk:!0,prepareData:()=>(this.debug.log("Getting non-constant managed tags"),e&&e.cookie||(e=qn(this.config.getOptions().customer)),{data:{company_id:this.config.getToken(),customer_ids:e,current_url:this.location.href}}),processResponse:e=>{this.removeOverlayAndShowManagedTags(e.data,t)},processError:t=>{this.debug.error("Error getting non-constant managed tags",t)}})}filterAndShowManagedTags(t,e){const i=ts(Zo.ManagedTag,this.debug);this.showManagedTags(t.filter(i("overlay",(t=>!e||!t.uses_overlay))).filter(i("page",(t=>!("trigger"in t)||Yo.matches(this.location.href,t.trigger)))))}showManagedTags(t){t.forEach((t=>this.showManagedTag(t)))}}Di([Yn(),Mi("design:type",Function),Mi("design:paramtypes",[]),Mi("design:returntype",void 0)],es.prototype,"queryNonConstantManagedTagsAndShowOnUrlChange",null),Di([Yn(),Mi("design:type",Function),Mi("design:paramtypes",[Object]),Mi("design:returntype",Promise)],es.prototype,"showManagedTag",null);class is{constructor(t,e,i,r,n,o){this.reporter=t,this.window=e,this.serviceWorkerManager=i,this.storageUtils=r,this.config=n,this.logger=o,this.webExperienceObject=this.getWebExperienceObject()}initialize(){const t=this.config.getNewExperimentsOptions();if(t&&"sync"===t.mode&&this.serviceWorkerManager.isAvailable()&&this.storageUtils.isStorageAvailable("localStorage")){const t=this.serviceWorkerManager.isRegistered().then((e=this.serviceWorkerManager,i=this.storageUtils,function(t){if(!t)return i.removeFromStorage("localStorage",p),e.register().then((()=>{rs(i)}));rs(i)})).catch((t=>{this.logger.error('Failed to initialize the "sync" mode for the new experiments because of:',t),this.logger.error('The SDK will now use the new experiments in "async" mode. Note that the service worker is only required for the "sync" mode. If you don\'t want to use it, consider switching to the "async" mode. Read more in https://docs.exponea.com/docs/integrating-and-using-experiments.')}));this.reporter.reportPromiseError(t)}var e,i}areAlreadyApplied(){return!(!this.webExperienceObject||!this.webExperienceObject.skipExperiments)}getWebExperienceObject(){const t=this.window[u],e=t&&t.webxp,i=this.window[_];return e||i}}function rs(t){t.writeToStorage("localStorage",p,!0)}function ns(t,e,i){return"attachEvent"in t&&"function"==typeof t?t.attachEvent("on"+e,i):t.addEventListener(e,i,!1)}Di([Yn(),Mi("design:type",Function),Mi("design:paramtypes",[]),Mi("design:returntype",void 0)],is.prototype,"initialize",null);const os={click:!0,key:!0,move:!0,scroll:!0},ss={click:["click","mousedown","pointerdown","touchstart"],move:["mousemove","pointermove"],key:["keydown"],scroll:["wheel","touchmove","scroll"]};class as{constructor(t,e={},i){this.window=t,this.activityCallback=i,this.listenersRegistered=!1,this.options=Object.assign({},os,e)}registerActionListeners(){this.listenersRegistered||(bo(ss,((t,e)=>{t.forEach((t=>{ns(this.window,t,(()=>{this.options[e]&&(this.lastActivity=e,this.activityCallback&&this.activityCallback(e))}))}))})),this.listenersRegistered=!0)}setOptions(t){this.options=Object.assign({},this.options,t)}getLastUserActivity(){return this.lastActivity}resetActivity(){this.lastActivity=void 0}}class cs{constructor(t,e,i,r,n,o,s,a,c,u,h,l){this.reporter=t,this.config=e,this.timestamp=i,this.eventTracker=r,this.window=n,this.location=o,this.document=s,this.debug=a,this.cookies=c,this.storageUtils=u,this.unloader=h,this.url=l,this.activityHandler=new as(this.window,this.config.getActivityHandlerOptions(),(t=>this.resumePinging(t)))}sendPing(t=!1,e){const i=this.config.getOptions().ping;if(!i||!i.enabled)return this.stopPinging();const r=this.shouldCheckActivity(i.activity);if(t&&r&&!this.activityHandler.getLastUserActivity())return this.debug.log("No user activity detected so not pinging"),void this.stopPinging();const n=this.getPingParams(e);n&&(this.debug.log("Sending session ping"),this.eventTracker.track("session_ping",n)),this.onSessionPing(),this.activityHandler.resetActivity()}initializeWebUnloadTracking(){this.config.getOptions().track.unloads&&this.unloader.addListener((()=>{this.eventTracker.track("web_unload",this.getPingParams()||{})}))}restartPinging(){this.stopPinging();const t=this.config.getOptions().ping;t&&t.enabled&&(this.debug.log("Session ping is enabled"),this.activityHandler.registerActionListeners(),this.sendPing(!1,"page_load"),this.intervalId=this.window.setInterval((()=>this.sendPing(!0)),1e3*t.interval))}setOptions(t){this.debug.log("Changing ping configuration: ",t),this.config.extendOptions({ping:t}),this.setActivityHandlerOptions()}onSessionPing(t=(new Date).getTime()){const e=this.getLastSessionPing();this.storageUtils.isStorageAvailable("localStorage")&&((null===e||e<t-12e5)&&this.onSessionStart(t),this.setLastSessionPing(t))}getPingParams(t){const e=this.config.getOptions(),i=this.getLastActivity(t);if(!this.shouldSendActivity(i))return;let n={};e.utm_params&&(n=this.url.getParams(e.utm_params)),Object.assign(n,e.ping.properties),n.referrer=this.document.referrer,n.location=this.location.href,n.path=this.location.pathname,i&&(n.activity=i);const o=this.cookies.getCookie(r);return o&&(n.cookie=o),n}getLastSessionStart(){return this.timestamp.getStoredTimestamp(c)}setActivityHandlerOptions(){this.activityHandler.setOptions(this.config.getActivityHandlerOptions())}onSessionStart(t=(new Date).getTime()){this.setLastSessionStart(t)}setLastSessionPing(t){this.timestamp.storeTimestamp(a,t)}setLastSessionStart(t){this.timestamp.storeTimestamp(c,t)}stopPinging(){this.intervalId&&(this.window.clearInterval(this.intervalId),this.intervalId=void 0)}resumePinging(t){const e=this.config.getOptions().ping;e&&e.enabled&&!this.intervalId&&(this.debug.log("Resuming session ping"),this.activityHandler.registerActionListeners(),this.sendPing(!1,t),this.intervalId=this.window.setInterval((()=>this.sendPing(!0)),1e3*e.interval))}getLastSessionPing(){return this.timestamp.getStoredTimestamp(a)}shouldCheckActivity(t){return"boolean"==typeof t?t:Object.values(t).some((t=>!!t))}shouldSendActivity(t){const e=this.config.getOptions().ping.activity;if("boolean"==typeof e)return!0;switch(t){case void 0:case"page_load":return!0;case"click":return!!e.click;case"scroll":return!!e.scroll;case"key":return!!e.key;case"move":return!!e.move;default:return!1}}getLastActivity(t){return t||(this.activityHandler&&this.activityHandler.getLastUserActivity()?this.activityHandler.getLastUserActivity():void 0)}}var us;function hs(t,e=""){return function(i,r,n){const o=n.value,s=e+String(r);return n.value=function(){return function(t,e,i){const r=function(t,e){const i=[];for(let r=0;r<t.length&&e(t[r]);r++)i.push(t[r]);return i}(t,(t=>!t.optional)).length;if(i.length<r)throw new Uo(`Invalid number of arguments when calling ${String(e)}, expected ${r} but got ${i.length}`)}(t,s,arguments),function(t,e,i){Array.from(i).forEach(((i,r)=>{const n=t[r];if(!n){if(r>=t.length)return;throw new Uo(`Missing definition for argument ${r} of ${e} inthe @${hs.name} decorator!`)}if(void 0===i){if(n.optional)return;throw new Uo(`Missing argument ${r} - ${n.name} when calling ${e}, `+ds(n)+" but got "+typeof i)}const o=typeof i;let s;switch(o){case"boolean":case"number":case"bigint":case"string":case"symbol":case"function":s=o;break;case"object":s=Array.isArray(i)?"array":i instanceof HTMLElement?"element":null===i?"null":"object";break;default:throw ls(e,r,n,typeof i,i)}if("type"in n){if(s!==n.type)throw ls(e,r,n,s,i)}else if(!n.oneOf.some((t=>t===s)))throw ls(e,r,n,s,i)}))}(t,s,arguments),o.apply(this,arguments)},n}}function ls(t,e,i,r,n){return new Uo(`Invalid type of argument ${e} - ${i.name} when calling ${t}, `+ds(i)+` but got ${r}: `+function(t,e){let i=String(t);"object"===e&&(i=JSON.stringify(t));"array"===e&&(i=`[${i}]`);if("element"===e){i=`HTMLElement ${t.tagName.toLowerCase()}`}i.length>128&&(i=i.substring(0,128)+"...");return i}(n,r))}function ds(t){return"type"in t?`expected ${t.type}`:`expected one of ${t.oneOf.join(", ")}`}Di([Yn(),Mi("design:type",Function),Mi("design:paramtypes",[Object,String]),Mi("design:returntype",void 0)],cs.prototype,"sendPing",null),function(t){t.Error="error",t.PermissionDenied="permission-denied",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.Default="default",t.Unsupported="unsupported"}(us||(us={}));class ps{constructor(t,e){this.pushWebApi=t,this.pushSafariApi=e,this._=[]}subscribe(t=(()=>{})){this.pushWebApi.isAvailable()?this.pushWebApi.subscribe(t):this.pushSafariApi.isAvailable()?this.pushSafariApi.subscribe(t):t(us.Unsupported)}unsubscribe(t=(()=>{})){this.pushWebApi.isAvailable()?this.pushWebApi.unsubscribe(t):this.pushSafariApi.isAvailable()?this.pushSafariApi.unsubscribe(t):t(us.Unsupported)}isAvailable(t){const e=this.pushWebApi.isAvailable()||this.pushSafariApi.isAvailable();return t&&t(e),e}isSubscribed(t){this.pushWebApi.isAvailable()?this.pushWebApi.isSubscribed(t):this.pushSafariApi.isAvailable()?this.pushSafariApi.isSubscribed(t):t(!1,!1)}}Di([hs([{name:"callback",type:"function",optional:!0}],"notifications."),Mi("design:type",Function),Mi("design:paramtypes",[Function]),Mi("design:returntype",void 0)],ps.prototype,"subscribe",null),Di([hs([{name:"callback",type:"function",optional:!0}],"notifications."),Mi("design:type",Function),Mi("design:paramtypes",[Function]),Mi("design:returntype",void 0)],ps.prototype,"unsubscribe",null),Di([hs([{name:"callback",type:"function",optional:!0}],"notifications."),Mi("design:type",Function),Mi("design:paramtypes",[Function]),Mi("design:returntype",Boolean)],ps.prototype,"isAvailable",null),Di([hs([{name:"callback",type:"function"}],"notifications."),Mi("design:type",Function),Mi("design:paramtypes",[Function]),Mi("design:returntype",void 0)],ps.prototype,"isSubscribed",null);class gs{constructor(t,e,i,r,n){this.window=t,this.config=e,this.customer=i,this.location=r,this.storageUtils=n}subscribe(t,e={}){var i,r;const n=Object.assign({},this.config.getOptions().customer),o=this.getWebServiceUrl(),s=null===(i=this.config.getOptions().push.safari)||void 0===i?void 0:i.websitePushID;if(!s||!(null===(r=this.window.safari)||void 0===r?void 0:r.pushNotification))return void t(us.Unsupported);const a=this.window.safari.pushNotification.permission(s);if(!a)return void t(us.Error);const{permission:c}=a;"denied"!==c?this.window.safari.pushNotification.requestPermission(o,s,n,(({deviceToken:i,permission:r})=>{"granted"===r&&(this.storageUtils.writeToStorage("localStorage",d,!0),this.customer.updateCustomer(Object.assign({safari_push_notification:i},e))),t(this.getStatusForPermission(r))})):t(this.getStatusForPermission(c))}unsubscribe(t){this.storageUtils.writeToStorage("localStorage",d,!1),this.customer.updateCustomer({safari_push_notification:""},(()=>t(us.Unsubscribed)),(()=>t(us.Error)),!0)}handleDeniedSubscription(){this.isAvailable()&&this.isSafariSubscriptionEqual("denied")&&this.isPushTokenStoredInExponea((t=>{t&&this.unsubscribe((()=>{}))}))}isAvailable(t=this.location){var e,i;return!(!(null===(e=this.window.safari)||void 0===e?void 0:e.pushNotification)||!(null===(i=this.config.getOptions().push.safari)||void 0===i?void 0:i.websitePushID)||"https:"!==t.protocol&&"localhost"!==t.hostname&&"127.0.0.1"!==t.hostname)}isSubscribed(t){this.isPushTokenStoredInExponea((e=>{t(this.isSafariSubscriptionEqual("granted")&&e,this.isSafariSubscriptionEqual("denied"))}))}isPushTokenStoredInExponea(t){setTimeout((()=>{try{t(!!this.storageUtils.readBooleanFromStorage("localStorage",d))}catch(e){t(!1)}}))}isSafariSubscriptionEqual(t){var e,i;const r=null===(e=this.window.safari)||void 0===e?void 0:e.pushNotification,n=null===(i=this.config.getOptions().push.safari)||void 0===i?void 0:i.websitePushID;if(!r||!n)return!1;return r.permission(n).permission===t}getWebServiceUrl(){const{target:t}=this.config.getOptions(),e=this.config.getToken();let i=`${t.replace(/\/$/,"")}/integrations/push/projects/${e}/safari`;return/^\/\//.test(i)&&(i="https:"+i),i}getStatusForPermission(t){switch(t){case"granted":return us.Subscribed;case"denied":return us.PermissionDenied;default:return us.Default}}}class ms{constructor(t,e,i,r,n,o,s,a){this.window=t,this.location=e,this.debug=i,this.logger=r,this.config=n,this.customer=o,this.queue=s,this.serviceWorkerManager=a,this._setVapidKey=()=>{},this.vapidKeyPromise=new Promise((t=>this._setVapidKey=t))}initialize(){this.isAvailable()&&this.requestVapidKey()}subscribe(t,e={},i=Notification){"granted"===i.permission?this.subscribeServiceWorker(t,e):i.requestPermission((i=>{"granted"===i?this.subscribeServiceWorker(t,e):t("default"===i?us.Default:us.PermissionDenied)}))}unsubscribe(t){this.serviceWorkerManager.isReady().then((t=>t.pushManager.getSubscription())).then((t=>{if(t)return t.unsubscribe().then((t=>{if(!t)throw new Error("Failed to unsubscribe");this.notifyServer(!1)}))})).then((()=>t(us.Unsubscribed))).catch((()=>t(us.Error)))}isAvailable(t=this.location){const e=this.window;return"Notification"in e&&"PushManager"in e&&this.serviceWorkerManager.isAvailable()&&"showNotification"in e.ServiceWorkerRegistration.prototype&&("https:"===t.protocol||"localhost"===t.hostname||"127.0.0.1"===t.hostname)}isSubscribed(t,e=Notification){const{permission:i}=e,r="denied"===i;"granted"===i&&this.serviceWorkerManager.isAvailable()?this.serviceWorkerManager.register().then((()=>this.serviceWorkerManager.isReady())).then((t=>t.pushManager.getSubscription())).then((t=>{if(!t)throw new Error("Missing push notification subscription");return t})).then((()=>{t(!0,r)})).catch((e=>{this.logger.error("Failed to check whether the user is subscribed:",e),t(!1,r)})):t(!1,r)}notifyServer(t,e={}){if(t){const{data:i,vapidKey:r}=t;e[g]=i,e[m]=r||""}else e[g]="",e[m]="";this.customer.updateCustomer(e,void 0,void 0,!0)}subscribeServiceWorker(t,e){this.serviceWorkerManager.register().then((()=>this.serviceWorkerManager.isReady())).then((t=>this.vapidKeyPromise.then((t=>{if(void 0===t)return{vapidKey:void 0,vapidKeyUint8Array:void 0};try{return{vapidKey:t,vapidKeyUint8Array:fs(t)}}catch(t){throw this.debug.error(new Error("Could not convert vapid key to Uint8Array. Maybe it is not in the Base64 format?")),t}})).then((({vapidKey:e,vapidKeyUint8Array:i})=>t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:i}).then((t=>({subscription:t,vapidKey:e}))))))).then((({subscription:i,vapidKey:r})=>{const n=Object.assign(Object.assign({},i.toJSON()),{vapidKey:!!r});this.notifyServer({data:n,vapidKey:r},e),t(us.Subscribed)})).catch((e=>{this.logger.error("Failed to subscribe the push notifications because of:",e),t(us.Error)}))}requestVapidKey(){this.queue.enqueue({name:Vr.PushNotificationsVapidKey,prepareData:()=>({data:{company_id:this.config.getToken()}}),processResponse:({data:{vapidKey:t}})=>{this.debug.log(`Vapid key for browser push notifications is ${t}`),this._setVapidKey(t)},processError:()=>{this._setVapidKey(void 0)}})}}function fs(t){const e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),i=atob(e),r=new Uint8Array(i.length);for(let t=0;t<i.length;++t)r[t]=i.charCodeAt(t);return r}class bs{constructor(t,e,i,r,n,o,s,a,c,u,h,l){this.reporter=t,this.config=e,this.queue=i,this.debug=r,this.timestamp=n,this.automaticTracking=o,this.window=s,this.eventTracker=a,this.customer=c,this.liveEventHandler=u,this.storageUtils=h,this.url=l}initialize(){this.config.getOptions().track.auto&&(this.liveEventHandler.initialize(),this._getTrackingDefinition())}_getTrackingDefinition(){this.debug.log("attempting to get tracking definition");const t=this._getCachedTrackingDefinition();t?this._trackByRules(t):this._fetchTrackingDefinitionAndTrackByRules()}_getCachedTrackingDefinition(){const t=this.storageUtils.readStringFromStorage("sessionStorage",o);if(!t)return this.debug.log("tracking definition not found in session storage"),null;this.debug.log("tracking definition found in session storage",t);let e=null;try{e=JSON.parse(t)}catch(t){this.debug.error("failed parsing cached tracked definition")}if(e){if(e.expires>this.timestamp.getUnixTimestamp())return e.data;this.debug.warn("tracking definition from session storage is expired")}return null}_fetchTrackingDefinitionAndTrackByRules(){this.queue.enqueue({name:Vr.Tracking,prepareData:()=>(this.debug.log("fetching automatic tracking definition"),{data:{company_id:this.config.getToken()}}),processResponse:t=>{const{data:e}=t;this._storeTrackingDefinitionIntoCache(e),this._trackByRules(e)},processError:t=>{this.debug.error("Error getting automatic tracking definition",t)}})}_trackByRules(t){this._doTrackByRules(t),this.config.isSpaReloadingEnabled("automatic_tracking")&&this.url.onChange("QueryTracking.doTrackByRulesOnUrlChange",(()=>{this.liveEventHandler.clearLiveEventListeners(),this._doTrackByRules(t)}))}_doTrackByRules(t){t.filter((t=>Yo.matches(this.window.location.href,t.trigger))).forEach((t=>{"visit"===t.trigger.type?this._doTrackAction(t.action,null):"click"===t.trigger.type?this._doBindOnClickHandlers(t.trigger.selector,t.action):"submit"===t.trigger.type&&this._doBindOnSubmitHandlers(t.trigger.selector,t.action)}))}_doBindOnClickHandlers(t,e){this.liveEventHandler.addLiveEventListener("click",t,(t=>{this._doTrackAction(e,t,{immediate:!qo})}))}_doBindOnSubmitHandlers(t,e){this.liveEventHandler.addLiveEventListener("submit",t,(t=>{this._doTrackAction(e,t,{immediate:!qo})}))}_storeTrackingDefinitionIntoCache(t){this.storageUtils.writeToStorage("sessionStorage",o,JSON.stringify({expires:this.timestamp.getUnixTimestamp()+3600,data:t}))}_doTrackAction(t,e,i={}){"track"===t.type?this.automaticTracking.materializeProperties(t.properties,e,this.reporter.reportError((e=>{this.eventTracker.track(t.event_type,e,i)}),"trackEvent")):"identify"===t.type?this.automaticTracking.materializeIds(t.as_who,e,this.reporter.reportError((t=>{this.customer.identifyCustomer(t,{},void 0,void 0,i.immediate)}),"identifyCustomer")):"update"===t.type&&this.automaticTracking.materializeProperties(t.properties,e,this.reporter.reportError((t=>{this.customer.updateCustomer(t,void 0,void 0,i.immediate)}),"updateCustomer"))}}Di([Yn(),Mi("design:type",Function),Mi("design:paramtypes",[]),Mi("design:returntype",void 0)],bs.prototype,"initialize",null);var ys=Object.prototype,vs=ys.hasOwnProperty,ws=pn((function(t,e){t=Object(t);var i=-1,r=e.length,n=r>2?e[2]:void 0;for(n&&xn(e[0],e[1],n)&&(r=1);++i<r;)for(var o=e[i],s=Vi(o),a=-1,c=s.length;++a<c;){var u=s[a],h=t[u];(void 0===h||Ot(h,ys[u])&&!vs.call(t,u))&&(t[u]=o[u])}return t}));const ks={track:!1,callback:!0,retry:!0};class _s{constructor(t,e,i,r,n,o=o){this.options=t,this.reporter=e,this.timestamp=i,this.config=r,this.featureFlags=n,this.window=o,this.enqueuedAt=this.timestamp.getUnixTimestamp()}get targetUrl(){return this.getCommandTargetUrl()}get name(){return this.options.name}processResponse(t,e,i){const r=this.options.processResponse;r&&this.reporter.reportError((()=>r(t,e,i)),"httpRequest")()}processError(t,e={}){if((e=ws(e,ks)).track&&this.reporter.sendErrorReport(t,"httpRequest",this.enqueuedAt),e.callback&&this.options.processError){const e=this.options.processError;this.reporter.reportError((()=>e(t)),"httpRequest")()}}prepareData(t){const e=this.options.prepareData;if(!e)return{state:void 0};try{return e(t)}catch(t){this.reporter.sendErrorReport(t,"prepareData"),this.processError(t,{retry:!1})}}getCommandTargetUrl(){if(Es(this)){let t=Ss(`${this.config.getOptions().target}/${this.name}`,this.config);return this.featureFlags.flags.ewx_279_invalid_integration_monitor&&this.name===ro.WebOptimization&&!this.config.getOptions().new_experiments&&function(t){return!!(t&&t.webxpClient&&t.webxpClient.init)}(this.window)&&(t+="?ii=1"),t}return Ss(`${this.config.getOptions().target}/bulk`,this.config)}}function Ss(t,e){const i=e.getToken(),r=e.getOptions().customer.cookie||"";return t.replace(/<project_id>/g,i).replace(/<cookie>/g,r)}function Ts(t){return!t.options.noBulk}function Es(t){return!!t.options.noBulk}function xs(t){return!!t.options.action}const Cs=2,Os=36e5,As=100;function Ps(t,e=5e3,i=Cs){return js(t,e,i)}function js(t,e=5e3,i,r=0){return function(){return r++,void setTimeout((function(){let n=e*i;n>Os&&(n=Os);if(r>=As)return void t();const o=js(t,n,i,r);t(o)}),e)}}class Ls{constructor(t){this.capacity=t,this.takenTokens=0}takeToken(){if(this.takenTokens===this.capacity)throw new Error("There is no free token to take");this.takenTokens++}releaseToken(){if(!this.takenTokens)throw new Error("There are no taken tickets");this.takenTokens--}hasFreeToken(){return this.takenTokens<this.capacity}}const zs="Command queue retry limit reached!",Is=Object.freeze({maxCommandsInQueue:1e3,maxCommandsProcessedInParallel:500,maxCommandsInBulkRequest:50,processDebounceTime:100}),Bs=Object.freeze({first:!1,process:Kn.defer});class Fs{constructor(t,e,i,r,n,o,s,a,c={},u=s.navigator){this.reporter=t,this.config=e,this.http=i,this.debug=r,this.timestamp=n,this.unloader=o,this.window=s,this.featureFlags=a,this.navigator=u,this.commandsList=[],this.isProcessingBlockingCommands=!1,this.numberOfEnqueuedCommandsIgnored=0,this.options=Object.freeze(Object.assign({},Is,c)),this.unloader.addAfterListener((()=>{this.sendBulkWithBeacon()})),this.tokenSystem=new Ls(this.options.maxCommandsProcessedInParallel),this.debounceProcess=Yr((()=>this.process()),this.options.processDebounceTime)}get length(){return this.commandsList.length}enqueue(t,e={}){if(e=Object.assign({},Bs,e),this.debug.log("Enqueuing command "+t.name),this.isQueueExceeded())return this.debounceProcess(),!1;const i=new _s(t,this.reporter,this.timestamp,this.config,this.featureFlags,this.window);return e.first?this.commandsList.unshift(i):this.commandsList.push(i),e.process===Kn.immediate?this.process():e.process===Kn.defer?this.debounceProcess():this.debug.debug("Queue is not processing the enqueued command because 'process' is false"),!0}execute(t){this.debug.log("Executing command "+t.name);const e=new _s(t,this.reporter,this.timestamp,this.config,this.featureFlags,this.window),i=Ps((t=>{Ms(e,this.tokenSystem,this.debug,this.sendSingle.bind(this),t)}),this.options.processDebounceTime,1);t.allowedToFail?this.sendSingle(e,void 0):Ms(e,this.tokenSystem,this.debug,this.sendSingle.bind(this),i)}clear(){this.commandsList=[]}registerPostBulkCallback(t){this.postBulkCallback=t}sendBulkWithBeacon(){if(0===this.commandsList.length)return;const t=this.commandsList.filter(Ts);this.debug.log("Queue is sending "+t.length+"/"+this.commandsList.length+" commands with beacon",t);var e;if(this.commandsList=this.commandsList.filter((e=Ts,t=>!e(t))),0===t.length)return;const i=this.config.getOptions().target+"/bulk",{bulkData:r}=Ds(t,this.timestamp),n={beacon:!0,commands:r},o=new Blob([JSON.stringify(n)],{type:"application/json"});this.navigator.sendBeacon(i,o)||this.debug.warn("Beacon data has not been queued for transfer!")}process(){if(this.commandsList.length<=0)return void this.debug.debug("Queue is empty, there are no commands to process");if(this.isProcessingBlockingCommands)return this.debug.debug("Queue is currently processing blocking commands and has to wait"),void this.debounceProcess();this.debug.debug("Processing queue commands"),this.debug.debug(`There are ${this.length} enqueued commands`);const t=[];for(let e=this.commandsList.shift();e;e=this.commandsList.shift()){if(xs(e))try{e.options.action()}catch(t){throw this.reporter.sendErrorReport(t,"Queue action"),t}else if(Es(e)){const i=Us(e,this.tokenSystem,this.sendSingle.bind(this));i&&t.push(i)}else{const i=Ns(e,this.commandsList,this.tokenSystem,this.debug,this.options,(()=>this.isProcessingBlockingCommands=!0),this.sendBulk.bind(this));t.push(...i)}if(this.isProcessingBlockingCommands){this.debug.debug("Queue is now blocked and it cannot continue processing commands"),t.push(...this.commandsList);break}}this.debug.debug("Queue commands have been processed"),this.debug.debug(`There are ${t.length} commands that will be processed in the next batch after a timeout`,t),this.commandsList=t,this.commandsList.length>0&&this.debounceProcess()}sendBulk(t,i){if(!t.length)return;const r=`${this.config.getOptions().target}/bulk`,{bulkData:n,commandStates:o}=Ds(t,this.timestamp),s={sdk:"js-client",sdk_version:e,sdk_snippet_version:Mo(this.window),commands:n};this.debug.log(`Queue is sending ${t.length} commands in bulk`,t),this.http.post(r,s).then((e=>{const i=e.body;this.postBulkCallback&&this.postBulkCallback(),t.forEach(((t,e)=>{t.options.isBlocking&&(this.isProcessingBlockingCommands=!1);const r=i.results[e];"ok"===r.status?t.processResponse(r,o[e],{start_time:i.start_time,end_time:i.end_time}):t.processError(new Error(r.errors.join(", ")),{retry:!1}),this.tokenSystem.releaseToken()}))})).catch((e=>{this.debug.warn("Queue bulk request failed with errors:",e),Rs(e)&&e.response.status<500?t.forEach((t=>{t.processError(e,{retry:!1}),this.tokenSystem.releaseToken()})):(t.forEach((t=>t.processError(e,{callback:!1}))),i?(this.debug.log("Retrying the request...",t),i()):t.forEach((t=>t.processError(new Error(zs)))))}))}sendSingle(t,e){const i=this.timestamp.getTimestamp(),r=t.prepareData(i);r&&(this.debug.log("Queue is sending a single command "+t.name,t),function(t,e,i){if(function(t){return!Es(t)||t.options.httpMethod!==Lo.get}(e))return t.post(e.targetUrl,i.data);return t.get(e.targetUrl)}(this.http,t,r).then((e=>{t.options.isBlocking&&(this.isProcessingBlockingCommands=!1),t.processResponse(e.body,r.state),this.tokenSystem.releaseToken()})).catch((i=>{if(this.debug.warn("Queue single command request failed with errors:",i),Rs(i)&&i.response.status<500){const e=new Error(function(t){const e=t.response.body;if("string"==typeof e)return e;return Object.entries(e.errors||{}).map((([t,e])=>`${t}: ${e.join(", ")}`)).join("; ")}(i));t.processError(e,{retry:!1}),this.tokenSystem.releaseToken()}else t.processError(i,{callback:!1}),e?(this.debug.log("Retrying the request...",t),e()):t.processError(new Error(zs))})))}isQueueExceeded(){const t=this.commandsList.length>=this.options.maxCommandsInQueue;return t?(this.numberOfEnqueuedCommandsIgnored+=1,1===this.numberOfEnqueuedCommandsIgnored&&this.debug.warn("Maximum queue length has been exceeded, further commands will be ignored")):this.numberOfEnqueuedCommandsIgnored>0&&(this.debug.debug(`Queue has been processed and it can receive commands again. There were ${this.numberOfEnqueuedCommandsIgnored} commands that were ignored.`),this.numberOfEnqueuedCommandsIgnored=0),t}}function Rs(t){return t instanceof Co}function Ds(t,e){const i=[],r=[],n=e.getTimestamp();for(const e of t){const t=e.prepareData(n);t&&(i.push({name:e.name,data:t.data}),r.push(t.state))}return{bulkData:i,commandStates:r}}function Ms(t,e,i,r,n){if(Us(t,e,r)){if(!n){const e=`Max retry count reached for ${t.name}`;return i.error(e),void t.processError(new Error(e))}i.log(`Retry ${t.name} execution later because there were no free tokens...`),n()}}function Us(t,e,i){if(!e.hasFreeToken())return t;e.takeToken();const r=Ps((e=>{i(t,e)}));return i(t,t.options.allowedToFail?void 0:r),null}function Ns(t,e,i,r,n,o,s){const a=[],c=[],u=[];for(;t;t=e.shift())if(Es(t))c.push(t);else if(i.hasFreeToken()){if(i.takeToken(),a.push(t),t.options.isBlocking){o(),r.log("Queue encountered a blocking command"),r.log("Further requests will not be made until this one finishes");break}if(a.length>=n.maxCommandsInBulkRequest)break}else u.push(t);e.unshift(...c);const h=a.every((t=>!!t.options.allowedToFail)),l=Ps((t=>s(a,t)));return s(a,h?void 0:l),u}class Ws{constructor(t,e,i){this.config=t,this.queue=e,this.debug=i}fetch(t,e){let i;i=tn(t)?this.migrateOldGetRecommendationSignature.apply(this,e):t,this.queue.enqueue({name:ro.Recommendation,noBulk:!0,prepareData:()=>(this.debug.log("Get recommendations: ",i.recommendationId),{data:this.processGetRecommendationOptions(i)}),processResponse:t=>{Xn((()=>{i.callback(t.data)}))}})}processGetRecommendationOptions(t){const e=this.config.getOptions(),i={project_id:this.config.getToken(),customer_ids:e.customer,engine_id:t.recommendationId,anti:!!t.anti,similarity:!!t.similarity,anonymous:!!t.anonymous,consider_known_items:!!t.considerKnowItems,fill_with_random:t.fillWithRandom,catalog_filter:t.catalogFilter,catalog_attributes_whitelist:t.catalogAttributesWhitelist,category_names:t.categoryNames};if(t.size&&(i.size=t.size),t.strategy&&(i.strategy=t.strategy),t.item)i.items={},i.items[t.item]=1;else if(Array.isArray(t.items)&&t.items.length>0){i.items={};for(let e=0;e<t.items.length;e++)i.items[t.items[e]]=1}else vt(t.items)&&!Xr(t.items)&&(i.items=t.items);return t.noTrack&&(i.no_track=t.noTrack),i}migrateOldGetRecommendationSignature(t,e,i,r,n){return{recommendationId:t,callback:e,size:i,strategy:r,item:n}}}class qs{constructor(t,e=window.performance){this.config=t,this.performance=e,this.data=null,this.updatedAt=0}get(){return this.isFresh()?this.data:null}set(t){this.data=t,this.updatedAt=this.performance.now()}clear(){this.data=null,this.updatedAt=this.performance.now()}isFresh(){return this.performance.now()-this.updatedAt<this.config.getOptions().exposed_segments.ttl}}class $s{constructor(t,e,i,r,n=window.performance){this.reporter=t,this.config=e,this.initializeState=i,this.queue=r,this.performance=n,this._=[],this.inProgress=!1,this.discoverySubscribers=new Map,this.contentSubscribers=new Map,this.merchandisingSubscribers=new Map,this.discoverySubscriberId=0,this.contentSubscriberId=0,this.merchandisingSubscriberId=0,this.lastSegmentNotificationValue=null,this.cache=new qs(this.config,this.performance)}getSegments(t,e,i,r={force:!1}){const n=function(i){e(function(e){return e[t]}(i))};r.force&&this.cache.clear();const o=this.cache.get();o?n(o):(this.prefetch(!0),this.segmentsPromise&&this.segmentsPromise.then(n,i))}prefetch(t=!1){(this.config.getOptions().exposed_segments.prefetch||t)&&!1===this.inProgress&&(this.inProgress=!0,this.segmentsPromise=this.segmentsQueuePromise(),this.segmentsPromise.then((t=>{this.cache.set(t)}),(()=>{this.cache.clear()})),this.segmentsPromise.finally((()=>{this.inProgress=!1})))}flush(){this.cache.clear()}subscribe(t,e,i){if("discovery"===t){const t=++this.discoverySubscriberId;return this.discoverySubscribers.set(t,{successCallback:e,errorCallback:i}),{unsubscribe:()=>{this.discoverySubscribers.delete(t)}}}if("content"===t){const t=++this.contentSubscriberId;return this.contentSubscribers.set(t,{successCallback:e,errorCallback:i}),{unsubscribe:()=>{this.contentSubscribers.delete(t)}}}if("merchandising"===t){const t=++this.merchandisingSubscriberId;return this.merchandisingSubscribers.set(t,{successCallback:e,errorCallback:i}),{unsubscribe:()=>{this.merchandisingSubscribers.delete(t)}}}throw new Error(`Unsupported subscription category: ${t}.`)}notify(){return Ui(this,0,void 0,(function*(){if(this.config.getOptions().exposed_segments.notify)try{this.segmentsPromise=this.segmentsQueuePromise();const t=yield this.segmentsPromise,e=this.lastSegmentNotificationValue;this.notifySuccessSubscribers("discovery",e,t),this.notifySuccessSubscribers("content",e,t),this.notifySuccessSubscribers("merchandising",e,t),this.lastSegmentNotificationValue=t}catch(t){this.notifyErrorSubscribers("discovery",t),this.notifyErrorSubscribers("content",t),this.notifyErrorSubscribers("merchandising",t),this.lastSegmentNotificationValue=null}}))}notifySuccessSubscribers(t,e,i){let r;if("content"===t)r=this.contentSubscribers;else if("discovery"===t)r=this.discoverySubscribers;else{if("merchandising"!==t)throw new Error(`Unsupported subscription category: ${t}.`);r=this.merchandisingSubscribers}if(function(t,e,i){if(!e)return!0;if(!i&&!e)return!1;if(!i&&e)return!0;const r=e[t]||[],n=i[t]||[];if(n.length!==r.length)return!0;return n.some((t=>{const e=r.find((e=>e.segmentation_id===t.segmentation_id));return!e||!(!e||t.id===e.id)}))}(t,e,i))for(const[e,n]of r)n.successCallback(i[t])}notifyErrorSubscribers(t,e){let i;if("content"===t)i=this.contentSubscribers;else if("discovery"===t)i=this.discoverySubscribers;else{if("merchandising"!==t)throw new Error(`Unsupported subscription category: ${t}.`);i=this.merchandisingSubscribers}for(const[t,r]of i)r.errorCallback&&r.errorCallback(e)}segmentsQueuePromise(){return new Promise(((t,e)=>{this.reporter.reportPromiseError(this.initializeState.whenInitialized()).then((()=>{this.queue.enqueue({name:ro.Segments,noBulk:!0,httpMethod:Lo.get,processResponse:t,processError:e},{process:Kn.immediate})}))}))}}Di([Yn(),Mi("design:type",Function),Mi("design:paramtypes",[String,Function,Function,Object]),Mi("design:returntype",void 0)],$s.prototype,"getSegments",null),Di([Yn(),Mi("design:type",Function),Mi("design:paramtypes",[Boolean]),Mi("design:returntype",void 0)],$s.prototype,"prefetch",null),Di([Yn(),Mi("design:type",Function),Mi("design:paramtypes",[]),Mi("design:returntype",void 0)],$s.prototype,"flush",null),Di([Yn(),Mi("design:type",Function),Mi("design:paramtypes",[String,Function,Function]),Mi("design:returntype",Object)],$s.prototype,"subscribe",null),Di([Yn(),Mi("design:type",Function),Mi("design:paramtypes",[]),Mi("design:returntype",Promise)],$s.prototype,"notify",null);class Hs{constructor(t,e,i){this.window=t,this.debug=e,this.config=i}get serviceWorker(){return this.window.navigator.serviceWorker}get serviceWorkerPath(){return this.config.getOptions().service_worker_path}isAvailable(){return"serviceWorker"in this.window.navigator&&"ServiceWorkerRegistration"in this.window}register(){return this.serviceWorker.register(this.serviceWorkerPath,{updateViaCache:"none"}).catch((t=>{throw this.debug.error(`Failed to the register service worker on '${this.serviceWorkerPath}' because of:`,t),t}))}isReady(){return this.serviceWorker.ready}isRegistered(){return this.serviceWorker.getRegistration(this.serviceWorkerPath).then((t=>!!t))}}class Vs{constructor(t,e,i){this.logger=t,this.localStorage=e,this.sessionStorage=i,this.isAvailable={localStorage:Gs(e),sessionStorage:Gs(i)}}writeToStorage(t,e,i){if(!this.isStorageAvailable(t))return!1;try{return vt(i)?this.getStorage(t).setItem(e,JSON.stringify(i)):this.getStorage(t).setItem(e,String(i)),!0}catch(t){return this.logger.error("Couldn't write to local storage, some features may be broken.",t),!1}}removeFromStorage(t,e){return!!this.isStorageAvailable(t)&&(this.getStorage(t).removeItem(e),!0)}readStringFromStorage(t,e){if(!this.isStorageAvailable(t))return null;try{return this.getStorage(t).getItem(e)}catch(t){return null}}readNumberFromStorage(t,e){const i=this.readStringFromStorage(t,e);if(!i)return null;const r=parseInt(i,10);return isNaN(r)?null:r}readBooleanFromStorage(t,e){const i=this.readStringFromStorage(t,e);return null===i?null:"true"===i}isStorageAvailable(t){return this.isAvailable[t]}getStorage(t){return this[t]}}function Gs(t){try{const e=`__${u}_storage_test__`;return t.setItem(e,e),t.removeItem(e),!0}catch(t){return!1}}class Ks{constructor(t,e,i,r){this.timestamp=t,this.queue=e,this.cookies=i,this.debug=r,this.timeInitialized=!1}isTimeInitialized(){return this.timeInitialized}queryTime(t){if(this.timeInitialized)return;let e=this.cookies.getCookie(n);if("string"==typeof e&&(this.debug.log("getting time offset from cookie",e),e=Number(e),!isNaN(e)))return this.debug.log("timestamp is valid number, choosing"),this.timestamp.timestampOffset=e,this.timeInitialized=!0,void this.cookies.setCookie(n,e.toString(),"time");this.debug.log("no time offset stored, getting from server");const i=this.timestamp,r=this.cookies;this.queue.enqueue({name:Vr.Time,prepareData:()=>{const t=i.getTimestamp(),e={clientTS:t};return this.debug.log("getting server timestamp",e),{data:e,state:{clientTS:t}}},processResponse:(e,o,s)=>{const a=o.clientTS,c=i.getTimestamp();if(s&&s.start_time&&s.end_time){const t=c-a-(s.end_time-s.start_time);i.timestampOffset=s.end_time+t/2-c}else{this.debug.log("received time response",e);const t=e.time,r=c-(c-a)/2;i.timestampOffset=t-r}this.debug.log(`time offset is ${i.timestampOffset} `),r.setCookie(n,i.timestampOffset.toString(),"time"),t&&t()}},{first:!0})}}class Qs{constructor(t){this.storageUtils=t,this.lastUsedTimestamp=null,this.timestampOffsetValue=0}get timestampOffset(){return this.timestampOffsetValue}set timestampOffset(t){this.timestampOffsetValue=t}getUnixTimestamp(){return(new Date).getTime()/1e3}storeTimestamp(t,e){this.storageUtils.writeToStorage("localStorage",t,e)}getStoredTimestamp(t){return this.storageUtils.readNumberFromStorage("localStorage",t)}getTimestamp(){let t=this.getUnixTimestamp();return null!=this.lastUsedTimestamp&&this.lastUsedTimestamp>=t&&(t=this.lastUsedTimestamp+.001),this.lastUsedTimestamp=t,t}getTimestampWithOffset(){return this.getTimestamp()+this.timestampOffsetValue}}const Js={_keyStr:"1BGFYekyHP0tx4OKnQCIoUfMbhRaVEqrzLN._su96W5g3AcvXpZDlJdj78-mSi2wT",decode:function(t){let e="";t=t.replace(/[^A-Za-z0-9\._-]/g,"");let i=0;for(;i<t.length;){const r=this._keyStr.indexOf(t.charAt(i++)),n=this._keyStr.indexOf(t.charAt(i++)),o=this._keyStr.indexOf(t.charAt(i++)),s=this._keyStr.indexOf(t.charAt(i++)),a=r<<2|n>>4,c=(15&n)<<4|o>>2,u=(3&o)<<6|s;e+=String.fromCharCode(a),64!==o&&(e+=String.fromCharCode(c)),64!==s&&(e+=String.fromCharCode(u))}return Js._utf8_decode(e)},_utf8_decode:function(t){let e="",i=0;const r="UTF-8 character cannot continue with: ";for(;i<t.length;){const n=t.charCodeAt(i);if(n<128)e+=String.fromCodePoint(n),i++;else if(n>191&&n<224){const o=t.charCodeAt(i+1);if(o<128||o>191)throw RangeError(r+o);e+=String.fromCodePoint((31&n)<<6|63&o),i+=2}else if(n>223&&n<240){const o=t.charCodeAt(i+1),s=t.charCodeAt(i+2);if(o<128||o>191)throw RangeError(r+o);if(s<128||s>191)throw RangeError(r+s);e+=String.fromCodePoint((15&n)<<12|(63&o)<<6|63&s),i+=3}else{if(!(n>239&&n<248))throw RangeError("UTF-8 character cannot start with: "+n);{const o=t.charCodeAt(i+1),s=t.charCodeAt(i+2),a=t.charCodeAt(i+3);if(o<128||o>191)throw RangeError(r+o);if(s<128||s>191)throw RangeError(r+s);if(a<128||a>191)throw RangeError(r+a);e+=String.fromCodePoint((7&n)<<18|(63&o)<<12|(63&s)<<6|63&a),i+=4}}}return e}};class Zs{constructor(t,e){this.debug=t,this.location=e}getCustomerIdentityFromUrl(){const t=this.getTransferIdentityToken();if(!t)return null;let e;this.debug.log("found iitt token in URL",t);try{e=Js.decode(t)}catch(t){return this.debug.error("iiit token is not valid base64 string"),null}this.debug.log("decoded token is",e);const i=e.indexOf(":");if(i<0)return this.debug.log("iit token is not valid"),null;const r={};return r[e.substring(0,i)]=e.substring(i+1),this.debug.log("resulting transferred customer ID is",r),r}getTransferIdentityFirstClickToken(){return this.getParameterValueFromUrl("xnpe_tifc")}getTransferIdentityToken(){return this.getParameterValueFromUrl("iitt")}getParameterValueFromUrl(t){const e=this.location.href.match(new RegExp("[?&]+"+t+"=([^&]*)","gi"));if(!e)return;const i=e[e.length-1].match(/[?&]+[^=]+=([^&]*)/i);return i?i[1]:void 0}}class Xs{constructor(t,e){this.reporter=t,this.window=e,this.callbacks=[],this.afterCallbacks=[]}initialize(){this.window.addEventListener("pagehide",(()=>{Ys(this.reporter,this.callbacks),Ys(this.reporter,this.afterCallbacks)}))}addListener(t){this.callbacks.push(t)}addAfterListener(t){this.afterCallbacks.push(t)}}function Ys(t,e){e.forEach((e=>{t.reportError(e,"unloaderCallback")()}))}class ta{constructor(t,e,i,r,n,o){this.reporter=t,this.config=e,this.location=i,this.history=r,this.window=n,this.logger=o,this.onChangeListeners=new Set}getParams(t){return function(t,e){const i={},r={};return t.forEach((t=>{r[t]=!0})),e.replace(/[?&]+([^=&]+)=([^&]*)/gi,((t,e,n)=>{if(e in r)try{i[e]=decodeURIComponent(n)}catch(t){}return""})),i}(t,this.location.href)}getAllQueryParams(){return function(t){const e={};return new URL(t).searchParams.forEach(((t,i)=>{e[i]=decodeURIComponent(t)})),e}(this.location.href)}onChange(t,e){if(this.onChangeListeners.has(t))return;this.onChangeListeners.add(t);const i=Yr(this.reporter.reportError(e,t),10);!function(t,e,i,r,n){if(!(!0===t.spa_reloading||t.spa_reloading&&!1!==t.spa_reloading.on_url_change))return;let o=i.href.replace(i.hash,"");if(!r.pushState)return;const s=r.pushState;r.pushState=(...t)=>{s.apply(r,t),o=ea(i,o,n)},ns(e,"popstate",(()=>{o=ea(i,o,n)}))}(this.config.getOptions(),this.window,this.location,this.history,i),function(t,e,i,r,n){if(!("object"==typeof t.spa_reloading&&!1!==t.spa_reloading.on_hash_change||!0===t.spa_reloading&&t.track_hash_changes))return;if(!("onhashchange"in e))return void r.warn("Browser is missing the HashChangeEvent support. The spa_reloading.on_hash_change option won't work.");ns(e,"hashchange",(o=i.hash,s=n,()=>{i.hash!==o&&(o=i.hash,s())}));var o,s}(this.config.getOptions(),this.window,this.location,this.logger,i)}}function ea(t,e,i){const r=t.href.replace(t.hash,"");return e!==r&&i(),r}class ia{constructor(t,e,i,r,n,o,s,a){this.reporter=t,this.config=e,this.linkTracker=i,this.eventTracker=r,this.window=n,this.debug=o,this.documentContentLoaded=s,this.unloader=a,this.activity={start:null,last:null},this._activityHandler=new as(this.window)}trackExitsWithDataAttribute(){const t=this.config.getOptions().track;t&&(!0===t.exits||en(t.exits))&&this.reporter.reportPromiseError(this.documentContentLoaded.whenLoaded()).then((()=>{let e=t.exits;en(e)||(e=t=>{const e=t,i={location:e.href,current_location:window.location.href};return e.getAttribute("id")&&(i.element_id=e.getAttribute("id")),e.getAttribute("name")&&(i.element_name=e.getAttribute("name")),{type:"web_exit",properties:i}});const i=Fi("a[data-exponea-track]");for(let t=0;t<i.length;t++)this.debug.log("Registering web exit link tracking for",i[t]),this.linkTracker.trackLink(i[t],e)}))}startActivityTracking(){const t=this.config.getOptions().track;t&&t.activity&&(this.debug.log("Activity tracking enabled"),this._activityHandler.registerActionListeners(),this.window.setInterval((()=>this.checkLastActivity()),1e3),this.unloader.addListener((()=>{this.trackActivityEvent(new Date,!0)})))}checkLastActivity(){if(this._activityHandler.getLastUserActivity()&&this._setUserWasActive(),this._activityHandler.resetActivity(),null==this.activity.last)return;const t=new Date;t.getTime()-this.activity.last.getTime()>6e4&&(this.trackActivityEvent(t),this.activity={start:null,last:null})}trackActivityEvent(t,e=!1){const i=this.config.getOptions().track;if(!e||this.activity.last&&this.activity.start||(this.activity.last=new Date,this.activity.start=this.activity.last),!i||!i.activity||null==this.activity.start||null==this.activity.last)return;const r=this.activity.start.getTime()/1e3,n=this.activity.last.getTime()/1e3;this.debug.log("Tracking user activity event"),this.eventTracker.track("user_active",{start_client_timestamp:r,end_client_timestamp:n,now_client_timestamp:t.getTime(),duration:n-r},{},e)}_setUserWasActive(){this.activity.last=new Date,null==this.activity.start&&(this.activity.start=this.activity.last)}}var ra;!function(t){t.isDataLayerVariable=function(t){return"data_layer"===t.variable.type},t.isQueryParameterVariable=function(t){return"query"===t.variable.type},t.isJavaScriptVariable=function(t){return"global_variable"===t.variable.type},t.isCustomFunction=function(t){return"custom_function"===t.variable.type}}(ra||(ra={}));const na="dataLayer";var oa;function sa(t,e){return t.data.find((t=>t.id===e))}function aa(t,e,i){let r;return ra.isDataLayerVariable(t)?r=function(t,e){const i=e[na];if(!i)return;const r=t.variable.data_layer.name;if(r)for(let t=i.length-1;t>=0;t--){const e=Zr(i[t],r,void 0);if(e)return e}}(t,i):ra.isQueryParameterVariable(t)?r=function(t,e){const i=e.getAllQueryParams();if(0===Object.keys(i).length)return;const r=t.variable.query.key;if(!r)return;return i[r]}(t,e):ra.isJavaScriptVariable(t)?r=function(t,e){const i=t.variable.global_variable.name;if(!i)return;const r=Zr(e,i,void 0);return r||void 0}(t,i):ra.isCustomFunction(t)&&(r=function(t){const e=t.variable.custom_function.body;if(!e)return;let i,r;try{i=new Function(e)}catch(t){return}try{r=i()}catch(t){return}return r}(t)),r}!function(t){t.matches=function(t,e,i,r,n){return!n||n.every((n=>{let o;if(!r)return!1;try{const s=n.attribute.id,a=sa(r,s);if(!a)return!1;o=aa(a,e,t);const c={};return void 0!==o&&(c[s]=o),i(c,s,n.constraint)}catch(t){return!1}}))}}(oa||(oa={}));class ca{static matches(t,e){return!e.enabled||!(e.from_date&&e.from_date>t)&&!(e.to_date&&e.to_date<t)}}var ua={exports:{}};ua.exports=ga;var ha=ua.exports.isMobile=ga;ua.exports.default=ga;const la=/(android|bb\d+|meego).+mobile|armv7l|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|samsungbrowser.*mobile|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,da=/CrOS/,pa=/android|ipad|playbook|silk/i;function ga(t){t||(t={});let e=t.ua;if(e||"undefined"==typeof navigator||(e=navigator.userAgent),e&&e.headers&&"string"==typeof e.headers["user-agent"]&&(e=e.headers["user-agent"]),"string"!=typeof e)return!1;let i=la.test(e)&&!da.test(e)||!!t.tablet&&pa.test(e);return!i&&t.tablet&&t.featureDetect&&navigator&&navigator.maxTouchPoints>1&&-1!==e.indexOf("Macintosh")&&-1!==e.indexOf("Safari")&&(i=!0),i}class ma{static matches(t,e){if(!t)return!0;const i=ha({ua:e,tablet:!0,featureDetect:!0});return"mobile"===t.type?i:"desktop"!==t.type||!i}}class fa{static matches(t,e,i,r,n,o){if(!r||!i.isStorageAvailable("localStorage"))return!0;const s=o+n,a=e.getStoredTimestamp(s+"_last_show"),c=e.getStoredTimestamp(s+"_last_interaction"),u=t.getLastSessionStart();switch(r){case"only_once":return!a;case"until_visitor_interacts":return!c;case"once_per_visit":return!a||!u||a<u}return!0}}class ba{constructor(t,e,i,r,n,o,s,a,c,u,h,l,d,p){this.reporter=t,this.config=e,this.contextualBanditEventFilter=i,this.queue=r,this.timestamp=n,this.ping=o,this.tracker=s,this.location=a,this.debug=c,this.documentContentLoaded=u,this.initializeState=h,this.storageUtils=l,this.url=d,this.window=p,this.webLayerHiders=[],this.webLayers={personalized:[],nonPersonalized:[]},this.tracker.registerEventTrackingListener(function(t,e){return function(i,r){"banner"===i&&"banner_id"in r&&(r.interaction&&va(t,e,r.banner_id,"interaction","_last_interaction"),"show"===r.action&&va(t,e,r.banner_id,"show event","_last_show"))}}(this.debug,this.storageUtils))}showWebLayer(t,e){let i,r;this.debug.log(`Showing weblayer ${e}...`);try{i=new Function(t)}catch(t){return this.debug.error(`Syntax error in the web layer javascript code.\n\nThis is not an SDK error but rather an error in the web layer ${e}\njavascript code. Check the web layer javascript code for syntax errors, such\nerrors are usually highlighted in the UI. The first line of the stack trace\nbelow should give you a clue.\n\n`,t)}try{r=i()}catch(t){return this.debug.error(`Error when executing the web layer javascript code.\n\nThis is not an SDK error but rather an error in the web layer ${e}\njavascript code. Check the web layer javascript code for errors. This is not\na syntax error and may be hard to spot, but the first line of the stack trace\nbelow should give you a clue.\n\n`,t)}r.hasOwnProperty("contextual_personalization")&&this.updateContextualBanditEventFilter(r.contextual_personalization),"function"==typeof r&&r.hasOwnProperty("remove")&&"function"==typeof r.remove&&this.webLayerHiders.push(r.remove)}queryAndShowWebLayer(t,e={},i=!1,r){i||this.hideExistingWebLayers(),this.queryAndShowWebLayers([t],void 0,e,r,zo.manual)}hideExistingWebLayers(){for(const t of this.webLayerHiders)try{t()}catch(t){this.debug.error("Error from hide weblayer script",t)}this.webLayerHiders=[]}registerWebLayers(t){this.webLayers.personalized=t.filter(ya),this.webLayers.nonPersonalized=t.filter((t=>!ya(t)))}processDefinition(t,e,i,r){this.registerWebLayers(t),this.filterAndShowWebLayers(e,i,r),this.config.isSpaReloadingEnabled("banners")&&this.url.onChange(`onUrlChangeFilterAndShowWebLayers_${e}`,(()=>{this.filterAndShowWebLayers(e,i,r)}))}filterAndShowWebLayers(t,e,i){var r;const n=!!(null===(r=this.config.getOptions().experimental)||void 0===r?void 0:r.non_personalized_weblayers);t!==Io.nonPersonalized&&n||this.hideExistingWebLayers();const o=this.webLayers[t],s=this.filterWebLayersForCustomer(o,e);if(0===s.length)return void(i&&Xn(i));const a=s.map((({_id:t})=>t));if(t===Io.personalized)this.queryAndShowWebLayers(a,s,{},i,zo.automatic,e);else if(t===Io.nonPersonalized){const t=s.map((t=>{var e;return null!==(e=t.data)&&void 0!==e?e:"return {}"}));return this.showWebLayers(t,a).then((()=>{i&&Xn(i)}))}}filterWebLayersForCustomer(t,e){const i=ts(Zo.WebLayer,this.debug),r=Mn(this.debug);return t.filter(i("page",(t=>Yo.matches(this.location.href,t.trigger)))).filter(i("date",(t=>ca.matches(this.timestamp.getTimestamp(),t.date_filter)))).filter(i("device",(t=>ma.matches(t.device_target)))).filter(i("frequency",(t=>fa.matches(this.ping,this.timestamp,this.storageUtils,t.frequency,t._id,s)))).filter(i("conditions",(t=>{var i;return oa.matches(this.window,this.url,r,e,null===(i=t.variables_target)||void 0===i?void 0:i.conditions)})))}showWebLayers(t,e){return this.debug.log("Showing weblayers..."),this.reporter.reportPromiseError(this.documentContentLoaded.whenLoaded()).then((()=>{t.forEach(((t,i)=>this.showWebLayer(t,e[i])))}))}queryAndShowWebLayers(t,e,i={},r,n=zo.automatic,o){let s=qn(this.config.getOptions().customer);const a=e?function(t,e,i,r){if(!r)return;const n=function(t){let e=[];return t.forEach((t=>{(null==t?void 0:t.page_vars)&&(e=e.concat(t.page_vars))})),e}(t);if(!n.length)return;const o={};return n.forEach((t=>{const n=t.id,s=sa(r,n);if(!s)return;const a=aa(s,e,i);void 0!==a&&(o[n]=a)})),Xr(o)?void 0:o}(e,this.url,window,o):void 0;this.reporter.reportPromiseError(this.initializeState.whenInitialized()).then((()=>{this.queue.enqueue({name:ro.BannersShow,noBulk:!0,prepareData:()=>(this.debug.log("Get filtered weblayers by IDs",t),s&&s.cookie||(s=qn(this.config.getOptions().customer)),{data:{company_id:this.config.getToken(),customer_ids:s,banner_ids:t,params:i,initiator:n,page_vars:a}}),processResponse:({data:e})=>{this.showWebLayers(e,t).then((()=>{r&&Xn(r)}))},processError:t=>{r&&Xn(r.bind(void 0,t))}})}))}updateContextualBanditEventFilter(t){var e,i,r;const n=null===(e=t.optimization_target)||void 0===e?void 0:e.type,o=null===(i=t.optimization_target)||void 0===i?void 0:i.event_type,s=(null===(r=t.optimization_target)||void 0===r?void 0:r.event_filter)||[],a=t.reward_token,c=t.reward_value||1;"event_tracked"===n&&o&&a&&this.contextualBanditEventFilter.put(o,s,a,c)}}function ya(t){return void 0===t.uses_personalization||t.uses_personalization}function va(t,e,i,r,n){t.log(`Recording ${r} for weblayer ${i}`),e.writeToStorage("localStorage",s+i+n,(new Date).valueOf().toString())}Di([Yn(),Mi("design:type",Function),Mi("design:paramtypes",[String,String]),Mi("design:returntype",void 0)],ba.prototype,"showWebLayer",null);class wa{constructor(t){t&&Object.entries(t).forEach((([t,e])=>{this[`_${t}`]=e}))}get location(){return this._location||(this._location=window.location),this._location}get document(){return this._document||(this._document=window.document),this._document}get date(){return this._date||(this._date=Date),this._date}get localStorage(){return this._localStorage||(this._localStorage=window.localStorage),this._localStorage}get sessionStorage(){return this._sessionStorage||(this._sessionStorage=window.sessionStorage),this._sessionStorage}get history(){return this._history||(this._history=window.history),this._history}get window(){return this._window||(this._window=window),this._window}get console(){return this._console||(this._console=window.console),this._console}get math(){return this._math||(this._math=Math),this._math}get config(){return this._config||(this._config=new zn(this.logger)),this._config}get featureFlags(){return this._featureFlags||(this._featureFlags=new vo(this.debug,this.window)),this._featureFlags}get contextualBandit(){return this._contextualBandit||(this._contextualBandit=new In(this.config,this.http)),this._contextualBandit}get timestamp(){return this._timestamp||(this._timestamp=new Qs(this.storageUtils)),this._timestamp}get http(){return this._http||(this._http=new Ao(window)),this._http}get queue(){return this._queue||(this._queue=new Fs(this.reporter,this.config,this.http,this.debug,this.timestamp,this.unloader,this.window,this.featureFlags)),this._queue}get cookies(){return this._cookies||(this._cookies=new Jn(this.config,this.debug,this.logger,this.queue,this.location,this.document,this.segments,this.dataLayer)),this._cookies}get contextualBanditEventFilter(){return this._contextualBanditEventFilter||(this._contextualBanditEventFilter=new Nn(this.contextualBandit,this.debug)),this._contextualBanditEventFilter}get time(){return this._time||(this._time=new Ks(this.timestamp,this.queue,this.cookies,this.debug)),this._time}get eventTracker(){return this._eventTracker||(this._eventTracker=new eo(this.reporter,this.config,this.contextualBanditEventFilter,this.time,this.timestamp,this.queue,this.debug,this.document,this.location,this.initializeState,this.window,this.url,this.browserExtension)),this._eventTracker}get ping(){return this._ping||(this._ping=new cs(this.reporter,this.config,this.timestamp,this.eventTracker,this.window,this.location,this.document,this.debug,this.cookies,this.storageUtils,this.unloader,this.url)),this._ping}get dependencyLoader(){return this._dependencyLoader||(this._dependencyLoader=new so(this.config)),this._dependencyLoader}get customer(){return this._customer||(this._customer=new oo(this.reporter,this.config,this.queue,this.debug,this.initializeState,this.window,this.cookies,this.browserExtension,this.segments)),this._customer}get userActivityTracking(){return this._userActivityTracking||(this._userActivityTracking=new ia(this.reporter,this.config,this.linkTracker,this.eventTracker,this.window,this.debug,this.documentContentLoaded,this.unloader)),this._userActivityTracking}get experimentsEditor(){return this._experimentsEditor||(this._experimentsEditor=new fo(this.http,this.config,this.location,this.document,this.history,this.window,this.debug,this.storageUtils)),this._experimentsEditor}get experiments(){return this._experiments||(this._experiments=new po(this.reporter,this.config,this.queue,this.debug,this.newExperiments,this.url,this.window)),this._experiments}get abTest(){return this._abTest||(this._abTest=new Bi(this.cookies)),this._abTest}get recommendations(){return this._recommendations||(this._recommendations=new Ws(this.config,this.queue,this.debug)),this._recommendations}get webLayers(){return this._webLayers||(this._webLayers=new ba(this.reporter,this.config,this.contextualBanditEventFilter,this.queue,this.timestamp,this.ping,this.eventTracker,this.location,this.debug,this.documentContentLoaded,this.initializeState,this.storageUtils,this.url,this.window)),this._webLayers}get managedTags(){return this._managedTags||(this._managedTags=new es(this.reporter,this.config,this.queue,this.location,this.document,this.debug,this.url,this.documentContentLoaded)),this._managedTags}get linkTracker(){return this._linkTracker||(this._linkTracker=new Vo(this.reporter,this.eventTracker,this.debug,this.documentContentLoaded)),this._linkTracker}get unloader(){return this._unloader||(this._unloader=new Xs(this.reporter,this.window)),this._unloader}get campaignClicks(){return this._campaignClicks||(this._campaignClicks=new an(this.location,this.queue,this.config,this.timestamp,this.time,this.debug,this.window,this.document)),this._campaignClicks}get notifications(){return this._notifications||(this._notifications=new ps(this.pushWebApi,this.pushSafariApi)),this._notifications}get pushWebApi(){return this._pushWebApi||(this._pushWebApi=new ms(this.window,this.location,this.debug,this.logger,this.config,this.customer,this.queue,this.serviceWorkerManager)),this._pushWebApi}get pushSafariApi(){return this._pushSafariApi||(this._pushSafariApi=new gs(this.window,this.config,this.customer,this.location,this.storageUtils)),this._pushSafariApi}get debug(){return this._debug||(this._debug=new S(this.config,this.location,this.logger,this.storageUtils)),this._debug}get reporter(){return this._reporter||(this._reporter=new lo(this.debug,this.config,this.http)),this._reporter}get initializer(){return this._initializer||(this._initializer=new No(this.reporter,this.debug,this.config,this.time,this.cookies,this.ping,this.customer,this.userActivityTracking,this.experimentsEditor,this.experiments,this.webLayers,this.managedTags,this.campaignClicks,this.eventTracker,this.queryTracking,this.window,this.unloader,this.initializeState,this.queue,this.pushWebApi,this.pushSafariApi,this.transferIdentity,this.http,this.logger,this.newExperiments,this.featureFlags,this.browserExtension)),this._initializer}get queryTracking(){return this._queryTracking||(this._queryTracking=new bs(this.reporter,this.config,this.queue,this.debug,this.timestamp,this.automaticTracking,this.window,this.eventTracker,this.customer,this.liveEventHandler,this.storageUtils,this.url)),this._queryTracking}get automaticTracking(){return this._automaticTracking||(this._automaticTracking=new Ri(this.reporter,this.documentContentLoaded)),this._automaticTracking}get liveEventHandler(){return this._liveEventHandler||(this._liveEventHandler=new Go(this.reporter,this.document)),this._liveEventHandler}get documentContentLoaded(){return this._documentContentLoaded||(this._documentContentLoaded=new ao(this.window,this.document)),this._documentContentLoaded}get initializeState(){return this._initializeState||(this._initializeState=new Wo),this._initializeState}get transferIdentity(){return this._transferIdentity||(this._transferIdentity=new Zs(this.debug,this.location)),this._transferIdentity}get html(){return this._html||(this._html=new wo(this.config,this.debug,this.documentContentLoaded,this.queue)),this._html}get enhancedEcommerce(){return this._enhancedEcommerce||(this._enhancedEcommerce=new co.Tracker(this.debug,this.eventTracker)),this._enhancedEcommerce}get serviceWorkerManager(){return this._serviceWorkerManager||(this._serviceWorkerManager=new Hs(this.window,this.debug,this.config)),this._serviceWorkerManager}get logger(){return this._logger||(this._logger=new Ko(this.console,h)),this._logger}get storageUtils(){return this._storageUtils||(this._storageUtils=new Vs(this.logger,this.localStorage,this.sessionStorage)),this._storageUtils}get newExperiments(){return this._newExperiments||(this._newExperiments=new is(this.reporter,this.window,this.serviceWorkerManager,this.storageUtils,this.config,this.logger)),this._newExperiments}get url(){return this._url||(this._url=new ta(this.reporter,this.config,this.location,this.history,this.window,this.logger)),this._url}get browserExtension(){return this._browserExtension||(this._browserExtension=new Hr.Handler(this.window,this.debug)),this._browserExtension}get segments(){return this._segments||(this._segments=new $s(this.reporter,this.config,this.initializeState,this.queue)),this._segments}get dataLayer(){return this._dataLayer||(this._dataLayer=new Gn(this.debug,this.window,this.config)),this._dataLayer}}const ka=["anonymize","initialize","identify","getSegments","update","track","trackLink","trackEnhancedEcommerce","getHtml","showHtml","showBanner","showWebLayer","ping","getAbTest","loadDependency","getRecommendation","reloadWebLayers","_preInitialize","_initializeConfig","_bootstrapEditor","_insertExperiment","_revertExperiments","_rewardBandit"],_a=["version","isLoaded","isInitialized","configuration"],Sa=["isAvailable","isSubscribed","subscribe","unsubscribe"],Ta=["subscribe"];function Ea(t){return t[_]}class xa{constructor({config:t,dependencyLoader:e,cookies:i,eventTracker:r,initializer:n,initializeState:o,customer:s,experimentsEditor:a,notifications:c,recommendations:u,abTest:h,webLayers:l,linkTracker:d,ping:p,reporter:g,contextualBandit:m,queue:f,debug:b,html:y,enhancedEcommerce:v,browserExtension:w,segments:k,logger:_,window:S}){this._=[],this.config=t,this.dependencyLoader=e,this.cookies=i,this.eventTracker=r,this.initializer=n,this.initializeState=o,this.customer=s,this.experimentsEditor=a,this.notifications=c,this.recommendations=u,this.abTest=h,this.webLayers=l,this.linkTracker=d,this.pingService=p,this.reporter=g,this.contextualBandit=m,this.queue=f,this.debug=b,this.html=y,this.enhancedEcommerce=v,this.browserExtension=w,this.segments=k,this.logger=_,this.window=S,this.queue.registerPostBulkCallback((()=>{const t=this.config.getOptions().exposed_segments.segmentation_processing_delay;new Promise((e=>{setTimeout(e,t)})).then((()=>{this.segments.flush(),this.segments.prefetch(),this.segments.notify()}))})),this.window.setInterval((()=>{null!==this.config.getOptions().token&&this.reporter.reportPromiseError(Bo(this.queue)).then((t=>{this.webLayers.registerWebLayers(t.webLayers)}))}),6e5)}get version(){return e}get isLoaded(){return!0}get isInitialized(){return this.initializeState.isInitialized()}get configuration(){return Gr(this.config.getOptions())}get initializedState(){return this.initializeState}initialize(t){return this.initializer.initialize(t)}_preInitialize(t){this.initializer.extendOptions(t),this.reporter.reportPromiseError(Bo(this.queue)).then((t=>this.webLayers.processDefinition(t.webLayers,Io.nonPersonalized,t.vars)))}_initializeConfig(t){this.initializer.extendOptions(t)}track(t,e,i,r,n){return this.eventTracker.track(t,e,{successCallback:i,errorCallback:r,immediate:n})}identify(t,e,i,r,n,o,s){return this.customer.identifyCustomer(t,e,i,r,n,o,s)}update(t){return this.customer.updateCustomer(t)}anonymize(){const t=this.cookies.setFreshTrackingCookie();this.config.setNewCustomerIds({cookie:t}),this.browserExtension.sendPayload({type:"ids",ids:{cookie:t}}),this.debug.log("sending new anonymized cookie to server"),this.cookies.sendCustomerCookieToServer(t),this.notifications.unsubscribe((()=>{})),this.segments.notify()}getAbTest(t,e,i){const r=`${l}${t}__`,n=this.cookies.getCookie(r),o=this.abTest.getAbTest(t,e);if(n||this.eventTracker.track("ab test",{name:t,variant:o}),!i)return o;Xn((()=>i(o)))}showBanner(t,e,i=!1,r){return this.showWebLayer(t,e,i,r)}showWebLayer(t,e,i=!1,r){return this.webLayers.queryAndShowWebLayer(t,e,i,r)}getRecommendation(t){return this.recommendations.fetch(t,arguments)}getSegments(t,e,i,r={force:!1}){this.segments.getSegments(t,e,i,r)}trackLink(t,e,i){return this.linkTracker.trackLink(t,e,i)}loadDependency(t,e=(()=>{})){return this.ensureThatSdkIsInitialized(),this.dependencyLoader.loadDependency(t).then((()=>e())).catch((t=>e(t)))}ping(t){return void 0===t?this.pingService.sendPing():(this.pingService.setOptions(t),this.pingService.restartPinging())}reloadWebLayers(t){this.reporter.reportPromiseError(Bo(this.queue)).then((t=>{var e;(null===(e=this.config.getOptions().experimental)||void 0===e?void 0:e.non_personalized_weblayers)&&this.webLayers.processDefinition(t.webLayers,Io.nonPersonalized,t.vars),this.webLayers.processDefinition(t.webLayers,Io.personalized,t.vars)})).then((()=>{t&&Xn(t)})).catch((e=>{t&&Xn((()=>t(e)))}))}_bootstrapEditor(){return this.experimentsEditor.bootstrapEditor()}_insertExperiment(t,e){const i=Ea(this.window);if(i&&i.applyModifications)return this._applyModificationsWhenMethodAvailable(t,i,e);const r=this.initializer.isWebxpClientReady.then((()=>i&&i.applyModifications?this._applyModificationsWhenMethodAvailable(t,i,e):(this.logger.error(`Unable to initialize experiment ${t.params.experiment_id}. Function applyModifications is not available.`),()=>{})),(t=>(this.logger.error("Unable to initialize experiments:",t),()=>{})));return()=>{r.then((t=>{"function"!=typeof t?this.logger.error("Unable to generate revert function"):t()}))}}_revertExperiments(){const t=Ea(this.window);if(t&&t.revert)try{return t.revert()}catch(t){this.debug.error("Error from revert experiment script",t)}}_rewardBandit(t,e,i,r){this.contextualBandit.rewardBandit(t,e,i,r)}trackEnhancedEcommerce(t,e="all"){this.enhancedEcommerce.trackEnhancedEcommerce(t,e)}getHtml(t,e){this.html.getHtml(t,e)}showHtml(t,e){this.html.showHtml(t,e)}ensureThatSdkIsInitialized(){if(!this.initializeState.isInitialized())throw new Error("You have to call initialize before any other Exponea SDK method can be called")}_applyModificationsWhenMethodAvailable(t,e,i){let r;try{r=e.applyModifications?e.applyModifications(t,!1):()=>{}}catch(t){return this.debug.error("Error applying experiment",t),()=>{}}return i&&this.eventTracker.track("experiment",{action:"show",experiment_id:t.params.experiment_id,experiment_name:t.params.experiment_name,variant_id:t.params.variant_id,variant_name:t.params.variant_name,location:window.location.href,path:window.location.pathname}),r}}function Ca(t,e){t.forEach((t=>e(t)))}Di([hs([{name:"options",oneOf:["boolean","object"]}]),Mi("design:type",Function),Mi("design:paramtypes",[Object]),Mi("design:returntype",void 0)],xa.prototype,"initialize",null),Di([hs([{name:"options",oneOf:["boolean","object"]}]),Mi("design:type",Function),Mi("design:paramtypes",[Object]),Mi("design:returntype",void 0)],xa.prototype,"_preInitialize",null),Di([hs([{name:"options",oneOf:["boolean","object"]}]),Mi("design:type",Function),Mi("design:paramtypes",[Object]),Mi("design:returntype",void 0)],xa.prototype,"_initializeConfig",null),Di([hs([{name:"eventType",type:"string"},{name:"eventProperties",type:"object",optional:!0},{name:"successCallback",type:"function",optional:!0},{name:"errorCallback",type:"function",optional:!0},{name:"immediate",type:"boolean",optional:!0}]),Yn(),function(t,e,i){const r=i.value;return i.value=function(){const t=!this.isInitialized;!function(t){return!0===t.compliance.opt_in||!0===t.compliance.opt_in.ignore_stored_command}(this.config.getOptions())?r.apply(this,arguments):this.reporter.reportPromiseError(this.initializedState.whenInitialized()).then((()=>{t||r.apply(this,arguments)}))},i},Mi("design:type",Function),Mi("design:paramtypes",[String,Object,Function,Function,Boolean]),Mi("design:returntype",void 0)],xa.prototype,"track",null),Di([hs([{name:"customerIds",oneOf:["object","string","number"]},{name:"customerProperties",type:"object",optional:!0},{name:"successCallback",type:"function",optional:!0},{name:"errorCallback",type:"function",optional:!0},{name:"immediate",type:"boolean",optional:!0}]),Yn(),function(t,e,i){const r=i.value;return i.value=function(){const t=!this.isInitialized;!function(t){return!0===t.compliance.opt_in||!0===t.compliance.opt_in.ignore_stored_command}(this.config.getOptions())?r.apply(this,arguments):this.reporter.reportPromiseError(this.initializedState.whenInitialized()).then((()=>{t||r.apply(this,arguments)}))},i},Mi("design:type",Function),Mi("design:paramtypes",[Object,Object,Function,Function,Boolean,Function,Function]),Mi("design:returntype",void 0)],xa.prototype,"identify",null),Di([hs([{name:"customerProperties",type:"object"}]),Yn(),function(t,e,i){const r=i.value;return i.value=function(){const t=!this.isInitialized;!function(t){return!0===t.compliance.opt_in||!0===t.compliance.opt_in.ignore_stored_command}(this.config.getOptions())?r.apply(this,arguments):this.reporter.reportPromiseError(this.initializedState.whenInitialized()).then((()=>{t||r.apply(this,arguments)}))},i},Mi("design:type",Function),Mi("design:paramtypes",[Object]),Mi("design:returntype",void 0)],xa.prototype,"update",null),Di([hs([]),function(t,e,i){const r=i.value;return i.value=function(){const t=!this.isInitialized;!function(t){return!0===t.compliance.opt_in||!0===t.compliance.opt_in.ignore_stored_command}(this.config.getOptions())?r.apply(this,arguments):this.reporter.reportPromiseError(this.initializedState.whenInitialized()).then((()=>{t||r.apply(this,arguments)}))},i},Mi("design:type",Function),Mi("design:paramtypes",[]),Mi("design:returntype",void 0)],xa.prototype,"anonymize",null),Di([hs([{name:"abTestName",type:"string"},{name:"variants",type:"object"},{name:"callback",type:"function",optional:!0}]),Yn(),function(t,e,i){const r=i.value;return i.value=function(){const t=!this.isInitialized;!function(t){return!0===t.compliance.opt_in||!0===t.compliance.opt_in.ignore_stored_command}(this.config.getOptions())?r.apply(this,arguments):this.reporter.reportPromiseError(this.initializedState.whenInitialized()).then((()=>{t||r.apply(this,arguments)}))},i},Mi("design:type",Function),Mi("design:paramtypes",[String,Object,Function]),Mi("design:returntype",Object)],xa.prototype,"getAbTest",null),Di([hs([{name:"id",type:"string"},{name:"params",type:"object",optional:!0},{name:"noHiding",type:"boolean",optional:!0},{name:"callback",type:"function",optional:!0}]),Yn(),function(t,e,i){const r=i.value;return i.value=function(){const t=!this.isInitialized;!function(t){return!0===t.compliance.opt_in||!0===t.compliance.opt_in.ignore_stored_command}(this.config.getOptions())?r.apply(this,arguments):this.reporter.reportPromiseError(this.initializedState.whenInitialized()).then((()=>{t||r.apply(this,arguments)}))},i},Mi("design:type",Function),Mi("design:paramtypes",[String,Object,Object,Function]),Mi("design:returntype",void 0)],xa.prototype,"showBanner",null),Di([hs([{name:"id",type:"string"},{name:"params",type:"object",optional:!0},{name:"noHiding",type:"boolean",optional:!0},{name:"callback",type:"function",optional:!0}]),Yn(),function(t,e,i){const r=i.value;return i.value=function(){const t=!this.isInitialized;!function(t){return!0===t.compliance.opt_in||!0===t.compliance.opt_in.ignore_stored_command}(this.config.getOptions())?r.apply(this,arguments):this.reporter.reportPromiseError(this.initializedState.whenInitialized()).then((()=>{t||r.apply(this,arguments)}))},i},Mi("design:type",Function),Mi("design:paramtypes",[String,Object,Object,Function]),Mi("design:returntype",void 0)],xa.prototype,"showWebLayer",null),Di([hs([{name:"options",type:"object"}]),Yn(),function(t,e,i){const r=i.value;return i.value=function(){const t=!this.isInitialized;!function(t){return!0===t.compliance.opt_in||!0===t.compliance.opt_in.ignore_stored_command}(this.config.getOptions())?r.apply(this,arguments):this.reporter.reportPromiseError(this.initializedState.whenInitialized()).then((()=>{t||r.apply(this,arguments)}))},i},Mi("design:type",Function),Mi("design:paramtypes",[Object]),Mi("design:returntype",void 0)],xa.prototype,"getRecommendation",null),Di([hs([{name:"exposedCategory",type:"string"},{name:"successCallback",type:"function"},{name:"errorCallback",type:"function",optional:!0},{name:"options",type:"object",optional:!0}]),Yn(),function(t,e,i){const r=i.value;return i.value=function(){const t=!this.isInitialized;!function(t){return!0===t.compliance.opt_in||!0===t.compliance.opt_in.ignore_stored_command}(this.config.getOptions())?r.apply(this,arguments):this.reporter.reportPromiseError(this.initializedState.whenInitialized()).then((()=>{t||r.apply(this,arguments)}))},i},Mi("design:type",Function),Mi("design:paramtypes",[String,Function,Function,Object]),Mi("design:returntype",void 0)],xa.prototype,"getSegments",null),Di([hs([{name:"element",oneOf:["string","element"]},{name:"eventType",type:"string"},{name:"eventProperties",type:"object",optional:!0}]),Yn(),function(t,e,i){const r=i.value;return i.value=function(){const t=!this.isInitialized;!function(t){return!0===t.compliance.opt_in||!0===t.compliance.opt_in.ignore_stored_command}(this.config.getOptions())?r.apply(this,arguments):this.reporter.reportPromiseError(this.initializedState.whenInitialized()).then((()=>{t||r.apply(this,arguments)}))},i},Mi("design:type",Function),Mi("design:paramtypes",[Object,String,Object]),Mi("design:returntype",void 0)],xa.prototype,"trackLink",null),Di([hs([{name:"dependencyNameOrArray",oneOf:["string","array"]},{name:"callback",type:"function",optional:!0}]),Yn(),Mi("design:type",Function),Mi("design:paramtypes",[Object,Function]),Mi("design:returntype",void 0)],xa.prototype,"loadDependency",null),Di([hs([{name:"pingOptions",type:"object",optional:!0}]),Yn(),function(t,e,i){const r=i.value;return i.value=function(){const t=!this.isInitialized;!function(t){return!0===t.compliance.opt_in||!0===t.compliance.opt_in.ignore_stored_command}(this.config.getOptions())?r.apply(this,arguments):this.reporter.reportPromiseError(this.initializedState.whenInitialized()).then((()=>{t||r.apply(this,arguments)}))},i},Mi("design:type",Function),Mi("design:paramtypes",[Object]),Mi("design:returntype",void 0)],xa.prototype,"ping",null),Di([hs([{name:"callback",type:"function",optional:!0}]),Yn(),function(t,e,i){const r=i.value;return i.value=function(){const t=!this.isInitialized;!function(t){return!0===t.compliance.opt_in||!0===t.compliance.opt_in.ignore_stored_command}(this.config.getOptions())?r.apply(this,arguments):this.reporter.reportPromiseError(this.initializedState.whenInitialized()).then((()=>{t||r.apply(this,arguments)}))},i},Mi("design:type",Function),Mi("design:paramtypes",[Function]),Mi("design:returntype",void 0)],xa.prototype,"reloadWebLayers",null),Di([hs([]),Mi("design:type",Function),Mi("design:paramtypes",[]),Mi("design:returntype",Promise)],xa.prototype,"_bootstrapEditor",null),Di([hs([{name:"experiment",type:"object"},{name:"trackEvent",type:"boolean",optional:!0}]),Mi("design:type",Function),Mi("design:paramtypes",[Object,Boolean]),Mi("design:returntype",Function)],xa.prototype,"_insertExperiment",null),Di([hs([]),Mi("design:type",Function),Mi("design:paramtypes",[]),Mi("design:returntype",void 0)],xa.prototype,"_revertExperiments",null),Di([hs([{name:"banditRewardToken",type:"string"},{name:"banditRewardValue",type:"number"},{name:"successCallback",type:"function",optional:!0},{name:"errorCallback",type:"function",optional:!0}]),Yn(),Mi("design:type",Function),Mi("design:paramtypes",[String,Number,Function,Function]),Mi("design:returntype",void 0)],xa.prototype,"_rewardBandit",null),Di([hs([{name:"ecommerceObject",type:"object"},{name:"kind",type:"string",optional:!0}]),Yn(),Mi("design:type",Function),Mi("design:paramtypes",[Object,String]),Mi("design:returntype",void 0)],xa.prototype,"trackEnhancedEcommerce",null);var Oa;const Aa=new Ko(console,h);if(La=navigator.userAgent,new RegExp("Googlebot\\/|Googlebot-Mobile|Googlebot-Image|Googlebot-News|Googlebot-Video|AdsBot-Google([^-]|$)|AdsBot-Google-Mobile|Feedfetcher-Google|Mediapartners-Google|Mediapartners \\(Googlebot\\)|APIs-Google|Google-InspectionTool|Storebot-Google|GoogleOther|bingbot|Slurp|[wW]get|LinkedInBot|Python-urllib|python-requests|aiohttp|httpx|libwww-perl|httpunit|Nutch|Go-http-client|phpcrawl|msnbot|jyxobot|FAST-WebCrawler|FAST Enterprise Crawler|BIGLOTRON|Teoma|convera|seekbot|Gigabot|Gigablast|exabot|ia_archiver|GingerCrawler|webmon |HTTrack|grub\\.org|UsineNouvelleCrawler|antibot|netresearchserver|speedy|fluffy|findlink|msrbot|panscient|yacybot|AISearchBot|ips-agent|tagoobot|MJ12bot|woriobot|yanga|buzzbot|mlbot|yandex\\.com\\/bots|purebot|Linguee Bot|CyberPatrol|voilabot|Baiduspider|citeseerxbot|spbot|twengabot|postrank|Turnitin|scribdbot|page2rss|sitebot|linkdex|Adidxbot|ezooms|dotbot|Mail\\.RU_Bot|discobot|heritrix|findthatfile|europarchive\\.org|NerdByNature\\.Bot|sistrix crawler|Ahrefs(Bot|SiteAudit)|fuelbot|CrunchBot|IndeedBot|mappydata|woobot|ZoominfoBot|PrivacyAwareBot|Multiviewbot|SWIMGBot|Grobbot|eright|Apercite|semanticbot|Aboundex|domaincrawler|wbsearchbot|summify|CCBot|edisterbot|SeznamBot|ec2linkfinder|gslfbot|aiHitBot|intelium_bot|facebookexternalhit|Yeti|RetrevoPageAnalyzer|lb-spider|Sogou|lssbot|careerbot|wotbox|wocbot|ichiro|DuckDuckBot|lssrocketcrawler|drupact|webcompanycrawler|acoonbot|openindexspider|gnam gnam spider|web-archive-net\\.com\\.bot|backlinkcrawler|coccoc|integromedb|content crawler spider|toplistbot|it2media-domain-crawler|ip-web-crawler\\.com|siteexplorer\\.info|elisabot|proximic|changedetection|arabot|WeSEE:Search|niki-bot|CrystalSemanticsBot|rogerbot|360Spider|psbot|InterfaxScanBot|CC Metadata Scaper|g00g1e\\.net|GrapeshotCrawler|urlappendbot|brainobot|fr-crawler|binlar|SimpleCrawler|Twitterbot|cXensebot|smtbot|bnf\\.fr_bot|A6-Indexer|ADmantX|Facebot|OrangeBot\\/|memorybot|AdvBot|MegaIndex|SemanticScholarBot|ltx71|nerdybot|xovibot|BUbiNG|Qwantify|archive\\.org_bot|Applebot|TweetmemeBot|crawler4j|findxbot|S[eE][mM]rushBot|yoozBot|lipperhey|Y!J|Domain Re-Animator Bot|AddThis|Screaming Frog SEO Spider|MetaURI|Scrapy|Livelap[bB]ot|OpenHoseBot|CapsuleChecker|collection@infegy\\.com|IstellaBot|DeuSu\\/|betaBot|Cliqzbot\\/|MojeekBot\\/|netEstate NE Crawler|SafeSearch microdata crawler|Gluten Free Crawler\\/|Sonic|Sysomos|Trove|deadlinkchecker|Slack-ImgProxy|Embedly|RankActiveLinkBot|iskanie|SafeDNSBot|SkypeUriPreview|Veoozbot|Slackbot|redditbot|datagnionbot|Google-Adwords-Instant|adbeat_bot|WhatsApp|contxbot|pinterest\\.com\\/bot|electricmonk|GarlikCrawler|BingPreview\\/|vebidoobot|FemtosearchBot|Yahoo Link Preview|MetaJobBot|DomainStatsBot|mindUpBot|Daum\\/|Jugendschutzprogramm-Crawler|Xenu Link Sleuth|Pcore-HTTP|moatbot|KosmioBot|[pP]ingdom|AppInsights|PhantomJS|Gowikibot|PiplBot|Discordbot|TelegramBot|Jetslide|newsharecounts|James BOT|Bark[rR]owler|TinEye|SocialRankIOBot|trendictionbot|Ocarinabot|epicbot|Primalbot|DuckDuckGo-Favicons-Bot|GnowitNewsbot|Leikibot|LinkArchiver|YaK\\/|PaperLiBot|Digg Deeper|dcrawl|Snacktory|AndersPinkBot|Fyrebot|EveryoneSocialBot|Mediatoolkitbot|Luminator-robots|ExtLinksBot|SurveyBot|NING\\/|okhttp|Nuzzel|omgili|PocketParser|YisouSpider|um-LN|ToutiaoSpider|MuckRack|Jamie's Spider|AHC\\/|NetcraftSurveyAgent|Laserlikebot|^Apache-HttpClient|AppEngine-Google|Jetty|Upflow|Thinklab|Traackr\\.com|Twurly|Mastodon|http_get|DnyzBot|botify|007ac9 Crawler|BehloolBot|BrandVerity|check_http|BDCbot|ZumBot|EZID|ICC-Crawler|ArchiveBot|^LCC |filterdb\\.iss\\.net\\/crawler|BLP_bbot|BomboraBot|Buck\\/|Companybook-Crawler|Genieo|magpie-crawler|MeltwaterNews|Moreover|newspaper\\/|ScoutJet|(^| )sentry\\/|StorygizeBot|UptimeRobot|OutclicksBot|seoscanners|Hatena|Google Web Preview|MauiBot|AlphaBot|SBL-BOT|IAS crawler|adscanner|Netvibes|acapbot|Baidu-YunGuanCe|bitlybot|blogmuraBot|Bot\\.AraTurka\\.com|bot-pge\\.chlooe\\.com|BoxcarBot|BTWebClient|ContextAd Bot|Digincore bot|Disqus|Feedly|Fetch\\/|Fever|Flamingo_SearchEngine|FlipboardProxy|g2reader-bot|G2 Web Services|imrbot|K7MLWCBot|Kemvibot|Landau-Media-Spider|linkapediabot|vkShare|Siteimprove\\.com|BLEXBot\\/|DareBoost|ZuperlistBot\\/|Miniflux\\/|Feedspot|Diffbot\\/|SEOkicks|tracemyfile|Nimbostratus-Bot|zgrab|PR-CY\\.RU|AdsTxtCrawler|Datafeedwatch|Zabbix|TangibleeBot|google-xrawler|axios|Amazon CloudFront|Pulsepoint|CloudFlare-AlwaysOnline|Google-Structured-Data-Testing-Tool|WordupInfoSearch|WebDataStats|HttpUrlConnection|Seekport Crawler|ZoomBot|VelenPublicWebCrawler|MoodleBot|jpg-newsbot|outbrain|W3C_Validator|Validator\\.nu|W3C-checklink|W3C-mobileOK|W3C_I18n-Checker|FeedValidator|W3C_CSS_Validator|W3C_Unicorn|Google-PhysicalWeb|Blackboard|ICBot\\/|BazQux|Twingly|Rivva|Experibot|awesomecrawler|Dataprovider\\.com|GroupHigh\\/|theoldreader\\.com|AnyEvent|Uptimebot\\.org|Nmap Scripting Engine|2ip\\.ru|Clickagy|Caliperbot|MBCrawler|online-webceo-bot|B2B Bot|AddSearchBot|Google Favicon|HubSpot|Chrome-Lighthouse|HeadlessChrome|CheckMarkNetwork\\/|www\\.uptime\\.com|Streamline3Bot\\/|serpstatbot\\/|MixnodeCache\\/|^curl|SimpleScraper|RSSingBot|Jooblebot|fedoraplanet|Friendica|NextCloud|Tiny Tiny RSS|RegionStuttgartBot|Bytespider|Datanyze|Google-Site-Verification|TrendsmapResolver|tweetedtimes|NTENTbot|Gwene|SimplePie|SearchAtlas|Superfeedr|feedbot|UT-Dorkbot|Amazonbot|SerendeputyBot|Eyeotabot|officestorebot|Neticle Crawler|SurdotlyBot|LinkisBot|AwarioSmartBot|AwarioRssBot|RyteBot|FreeWebMonitoring SiteChecker|AspiegelBot|NAVER Blog Rssbot|zenback bot|SentiBot|Domains Project\\/|Pandalytics|VKRobot|bidswitchbot|tigerbot|NIXStatsbot|Atom Feed Robot|[Cc]urebot|PagePeeker\\/|Vigil\\/|rssbot\\/|startmebot\\/|JobboerseBot|seewithkids|NINJA bot|Cutbot|BublupBot|BrandONbot|RidderBot|Taboolabot|Dubbotbot|FindITAnswersbot|infoobot|Refindbot|BlogTraffic\\/\\d\\.\\d+ Feed-Fetcher|SeobilityBot|Cincraw|Dragonbot|VoluumDSP-content-bot|FreshRSS|BitBot|^PHP-Curl-Class|Google-Certificates-Bridge|centurybot|Viber|e\\.ventures Investment Crawler|evc-batch|PetalBot|virustotal|(^| )PTST\\/|minicrawler|Cookiebot|trovitBot|seostar\\.co|IonCrawl|Uptime-Kuma|SeekportBot|FreshpingBot|Feedbin|CriteoBot|Snap URL Preview Service|Better Uptime Bot|RuxitSynthetic|Google-Read-Aloud|Valve\\/Steam|OdklBot\\/|GPTBot|ChatGPT-User|YandexRenderResourcesBot\\/|LightspeedSystemsCrawler|ev-crawler\\/|BitSightBot\\/|woorankreview\\/|Google-Safety|AwarioBot|DataForSeoBot|Linespider|WellKnownBot|A Patent Crawler|StractBot|search\\.marginalia\\.nu|YouBot|Nicecrawler|Neevabot|BrightEdge Crawler|SiteCheckerBotCrawler|TombaPublicWebCrawler|CrawlyProjectCrawler|KomodiaBot|KStandBot|CISPA Webcrawler|MTRobot|hyscore\\.io|AlexandriaOrgBot|2ip bot|Yellowbrandprotectionbot|SEOlizer|vuhuvBot|INETDEX-BOT|Synapse|t3versionsBot|deepnoc|Cocolyzebot|hypestat|ReverseEngineeringBot|sempi\\.tech|Iframely|MetaInspector|node-fetch|lkxscan|python-opengraph|OpenGraphCheck|developers\\.google\\.com\\/\\+\\/web\\/snippet|SenutoBot|MaCoCu|NewsBlur|inoreader|NetSystemsResearch|PageThing|WordPress\\/|PhxBot|ImagesiftBot|Expanse|InternetMeasurement|^BW\\/|GeedoBot|Audisto Crawler|PerplexityBot\\/|[cC]laude[bB]ot|Monsidobot|GroupMeBot","i").test(La))Aa.log("Crawler detected, not initializing SDK");else if(function(t,e){return"Internet Explorer"===rn(t,e,t.navigator.userAgent,t.navigator.vendor)}(window,document))Aa.log("Unsupported browser detected, not initializing SDK");else if(null===(Oa=window[u])||void 0===Oa?void 0:Oa.version)Aa.log("The SDK is already available on the window, maybe the SDK file is downloaded twice?");else{const e=new wa;e.debug.log("Creating SDK instance");const i=new xa(e),r=i.notifications,n=i.segments,o=function(t=window){return t[u]||(t[u]={_:[]},t[u].notifications={_:[]},t[u].segments={_:[]}),t[u].notifications||(t[u].notifications={_:[]}),t[u].segments||(t[u].segments={_:[]}),t[u]}(),s=o.notifications,a=o.segments;x(o,i,e.debug),C(ka,o,i),Pa=o,ja=i,_a.forEach((t=>{Object.defineProperty(Pa,t,{get:()=>ja[t],configurable:!1,enumerable:!1})})),x(s,r,e.debug),C(Sa,s,r),x(a,n,e.debug),C(Ta,a,n),window.br_datalayer=window.br_datalayer||[];!function(t,e,i=!0){if(!Array.isArray(t))return void E.warn("Error in dataLayer helper occurred: dataLayer is not an array, so it cannot be used for Bloomreach events.");const r=t.push;if(t.push=(...i)=>{const n=r.apply(t,i);try{Ca(i,e)}catch(t){E.warn(`Error in dataLayer.push listener occurred: ${t}`)}return n},i)try{t.forEach((t=>Ca([t],e)))}catch(t){E.warn(`Error in dataLayer forEach method occurred: ${t}`)}}(window.br_datalayer,function(e){return function(i){if(function(t){return!!(t&&"object"==typeof t&&(null==t?void 0:t.event)&&t.event.startsWith("br."))}(i))switch(i.event){case t.Anonymize:e.anonymize();break;case t.GetAbTest:e.getAbTest(i.abTestName,i.variants,i.callback);break;case t.GetHtml:e.getHtml(i.nodeName,i.callback);break;case t.GetRecommendation:e.getRecommendation(i.options);break;case t.Identify:e.identify(i.customerIds,i.customerProperties,i.successCallback,i.errorCallback,i.immediate,i.linkCookieSuccessCallback,i.linkCookieErrorCallback);break;case t.LoadDependency:e.loadDependency(i.dependencyNameOrArray,i.callback);break;case t.Notifications_isAvailable:e.notifications.isAvailable(i.callback);break;case t.Notifications_isSubscribed:e.notifications.isSubscribed(i.callback);break;case t.Notifications_subscribe:e.notifications.subscribe(i.callback);break;case t.Notifications_unsubscribe:e.notifications.unsubscribe(i.callback);break;case t.Ping:e.ping(i.pingOptions);break;case t.ReloadWebLayers:e.reloadWebLayers(i.callback);break;case t.Segments_getSegments:e.getSegments(i.exposedCategory,i.successCallback,i.errorCallback,i.options);break;case t.Segments_subscribe:e.segments.subscribe(i.exposedCategory,i.successCallback,i.errorCallback);break;case t.ShowHtml:e.showHtml(i.selector,i.nodeName);break;case t.ShowWebLayer:e.showWebLayer(i.id,i.params,i.noHiding,i.callback);break;case t.Start:e.initialize(i.options);break;case t.Track:e.track(i.eventType,i.eventProperties,i.successCallback,i.errorCallback,i.immediate);break;case t.TrackEnhancedECommerce:e.trackEnhancedEcommerce(i.ecommerceObject,i.kind);break;case t.TrackLink:e.trackLink(i.element,i.eventType,i.eventProperties);break;case t.Update:e.update(i.customerProperties);break;default:E.warn("DataLayer event triggered: nothing to do")}}}(i))}var Pa,ja,La}();
//# sourceMappingURL=exponea.min.js.map
